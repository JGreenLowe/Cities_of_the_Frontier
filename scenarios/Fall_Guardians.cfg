#textdomain wesnoth-Wild_Frontiers

#define DIRECTION_CONE X1 Y1 X2 Y2 VAR
    [store_relative_direction]
        [source]
            x,y={X1},{Y1}
        [/source]
        [destination]
            x,y={X2},{Y2}
        [/destination]
        mode=1
        variable=direction
    [/store_relative_direction]
    #{VARIABLE direction "n"}
    [if]
        {VARIABLE_CONDITIONAL direction equals "n"}
        [or]
            {VARIABLE_CONDITIONAL direction equals "s"}
        [/or]
        [then]
            [store_nearest_locations]
                x,y={X1},{Y1}
                radius=9999
                [filter_location]
                    x,y={X2},{Y2}
                [/filter_location]
                variable=nearest_location
            [/store_nearest_locations]

            {VARIABLE farthest_radius 9}
            {VARIABLE_OP nearest_radius sub 2}
            [store_locations]
                [and]
                    x,y={X1},{Y1}
                    radius=$nearest_radius
                [/and]
                include_borders=no
                variable=src_locations
            [/store_locations]
            [store_locations]
                [and]
                    x,y={X2},{Y2}
                    radius=$farthest_radius
                [/and]
                [and]
                    find_in=src_locations
                [/and]
                variable={VAR}
            [/store_locations]
            {CLEAR_VARIABLE src_locations}
            {CLEAR_VARIABLE nearest_location}
            {CLEAR_VARIABLE nearest_radius}
            {CLEAR_VARIABLE farthest_radius}
        [/then]
        [else]
            [store_nearest_locations]
                x,y={X1},{Y1}
                radius=9999
                [filter_location]
                    x,y={X2},{Y2}
                [/filter_location]
                variable=nearest_location
            [/store_nearest_locations]

            {VARIABLE farthest_radius 9}
            {VARIABLE_OP nearest_radius sub $farthest_radius}
            [store_locations]
                [and]
                    x,y={X1},{Y1}
                    radius=$nearest_radius
                [/and]
                include_borders=no
                variable=src_locations
            [/store_locations]
            [store_locations]
                [and]
                    x,y={X2},{Y2}
                    radius=$farthest_radius
                [/and]
                [and]
                    find_in=src_locations
                [/and]
                variable={VAR}
            [/store_locations]

            [while]
                {VARIABLE_CONDITIONAL farthest_radius greater_than 2}
                [do]
                    {VARIABLE_OP farthest_radius sub 1}
                    {VARIABLE_OP nearest_radius add 1}
                    [store_locations]
                        [and]
                            x,y={X1},{Y1}
                            radius=$nearest_radius
                        [/and]
                        include_borders=no
                        variable=src_locations
                    [/store_locations]
                    [store_locations]
                        [and]
                            [and]
                                x,y={X2},{Y2}
                                radius=$farthest_radius
                            [/and]
                            [and]
                                find_in=src_locations
                            [/and]
                        [/and]
                        [or]
                            find_in={VAR}
                        [/or]
                        variable={VAR}
                    [/store_locations]
                [/do]
            [/while]
            {CLEAR_VARIABLE src_locations}
            {CLEAR_VARIABLE nearest_location}
            {CLEAR_VARIABLE nearest_radius}
            {CLEAR_VARIABLE farthest_radius}
        [/else]
    [/if]
    {CLEAR_VARIABLE direction}
    #[foreach]
    #    array={VAR}
    #    [do]
    #        [terrain]
    #            terrain=Rr
    #            [and]
    #                x,y=$this_item.x,$this_item.y
    #            [/and]
    #        [/terrain]
    #    [/do]
    #[/foreach]
#enddef

#define SPAWN_CONE SIDE TYPES NUM VAR
    [random_placement]
        num_items={NUM}
        variable=random_placement_location
        allow_less=yes
        min_distance=1
        [filter_location]
            find_in={VAR}
            include_borders=no
        [/filter_location]
        [command]
            [set_variable]
                name=random_types
                rand={TYPES}
            [/set_variable]
            [unit]
                side={SIDE}
                type=$random_types
                x=$random_placement_location.x
                y=$random_placement_location.y
                generate_name=yes
                random_traits=yes
                random_gender=yes
                upkeep=full
                ai_special=guardian
                passable=yes
                placement=map
            [/unit]
            {CLEAR_VARIABLE random_types}
        [/command]
    [/random_placement]
    {CLEAR_VARIABLE random_placement_location}
#enddef

#define SPAWN_LOCATION SIDE TYPES VAR
    [foreach]
        array={VAR}
        [do]
            [set_variable]
                name=random_types
                rand={TYPES}
            [/set_variable]
            [unit]
                side={SIDE}
                type=$random_types
                x=$this_item.x
                y=$this_item.y
                generate_name=yes
                random_traits=yes
                random_gender=yes
                upkeep=full
                ai_special=guardian
                passable=yes
                placement=map
            [/unit]
            {CLEAR_VARIABLE random_types}
        [/do]
    [/foreach]
#enddef

#define SPAWN_CIRCLE SIDE TYPES X Y
    [store_locations]
        [not]
            x,y={X},{Y}
        [/not]
        [and]
            x,y={X},{Y}
            radius=1
        [/and]
        variable=circle_locations
    [/store_locations]
    {SPAWN_LOCATION {SIDE} {TYPES} circle_locations}
    {CLEAR_VARIABLE circle_locations}
#enddef

#define PLACE_HOSTAGE TYPES X Y
    {VARIABLE_OP objective_goal add 1}
    [set_variable]
        name=random_types
        rand={TYPES}
    [/set_variable]
    [store_unit_type]
        type=$random_types
    [/store_unit_type]
    {CLEAR_VARIABLE random_types}
    {PLACE_IMAGE "$unit_type.image|~RC(magenta>red)" {X} {Y}}
    {PLACE_IMAGE items/cage.png {X} {Y}}
    [event]
        name=moveto
        first_time_only=yes
        delayed_variable_substitution=no
        [filter]
            side=1
            x,y={X},{Y}
        [/filter]
        [remove_item]
            x,y={X},{Y}
            image="$unit_type.image|~RC(magenta>red)"
        [/remove_item]
        [unit]
            side=1
            animate=yes
            passable=yes
            placement=map
            random_traits=yes
            type=$unit_type.id
            role=friend
            x,y={X},{Y}
        [/unit]
        [fire_event]
            name=amla_extra_event
            [primary_unit]
                role=friend
            [/primary_unit]
        [/fire_event]
        [unhide_unit]
        [/unhide_unit]
        [message]
            role=friend
            message=_"About time."
        [/message]
        [message]
            speaker=unit
            message=_"YOU CAN TALK?!"
        [/message]
        [modify_unit]
            [filter]
                role=friend
            [/filter]
            role=""
        [/modify_unit]
        [remove_item]
            x,y={X},{Y}
            image=items/cage.png
        [/remove_item]
        {VARIABLE_OP objective_goal sub 1}
        [fire_event]
            name=check_objectives
        [/fire_event]
    [/event]
    {CLEAR_VARIABLE unit_type}
#enddef

#define PLACE_GOLD_CHEST X Y
    {VARIABLE_OP objective_goal add 1}
    [set_variable]
        name=random_gold
        rand=250..500
    [/set_variable]
    {PLACE_IMAGE (items/chest.png) {X} {Y}}
    [event]
        name=moveto
        first_time_only=yes
        delayed_variable_substitution=no
        [filter]
            side=1
            x,y={X},{Y}
        [/filter]
        [sound]
            name=open-chest.wav
        [/sound]
        [remove_item]
            x,y={X},{Y}
            image=items/chest.png
        [/remove_item]
        {PLACE_IMAGE (items/chest-open.png) {X} {Y}}
        [gold]
            side=1
            amount=$random_gold
        [/gold]
        [sound]
            name=gold.ogg
        [/sound]
        {VARIABLE_OP objective_goal sub 1}
        [fire_event]
            name=check_objectives
        [/fire_event]
    [/event]
    {CLEAR_VARIABLE random_gold}
#enddef

[scenario]
    name= _ "Fall Guardians"
    id=Fall_Guardians
    next_scenario=Fall_Guardians

    [story]
        [part]
            story= _ "You answer the call for aid... Time to restore order."
        [/part]
    [/story]

    map_generation=default
    [generator]
        name=default
        map_width=24
        map_height=24
        iterations=720
        hill_size=6
        max_lakes=40
        villages=25
        players=2
        castle_size=2
        min_lake_height=500
        lake_size=150
        river_frequency=20

        temperature_iterations=2000
        temperature_size=4

        roads=4
        road_windiness=3

        #list of common terrain types which come in at
        #different heights, from highest to lowest
        [height]
            height=600
            terrain=Mm
        [/height]
        [height]
            height=500
            terrain=Hhd
        [/height]
        [height]
            height=100
            terrain=Gd
        [/height]
        [height]
            height=5
            terrain=Ww
        [/height]
        [height]
            height=0
            terrain=Wo
        [/height]

        #water at cold temperatures becomes ice
        [convert]
            min_height=50
            max_temperature=150
            from=Ww, Wo, Ss
            to=Ai
        [/convert]

        #at low temperatures, snow appears
        [convert]
            min_height=50
            max_temperature=150
            from=Gd, Ds
            to=Aa
        [/convert]

        #hills at low temperatures get snow on them
        [convert]
            max_temperature=200
            from=Hhd
            to=Ha
        [/convert]

        #mountains at low temperatures get snow on them
        [convert]
            max_temperature=200
            from=Mm
            to=Ms
        [/convert]

        #forest appears at moderate temperatures
        [convert]
            min_temperature=250
            max_temperature=400
            from=Gd
            to=Aa^Fpa
        [/convert]

        #forest appears at moderate temperatures
        [convert]
            min_temperature=250
            max_temperature=500
            from=Gd
            to=Gll^Fp
        [/convert]

        #road costs
        [road_cost]
            terrain=Gd
            cost=10
            convert_to=Re
        [/road_cost]

        [road_cost]
            terrain=Gll^Fp
            cost=20
            convert_to=Re
        [/road_cost]

        [road_cost]
            terrain=Aa^Fpa
            cost=20
            convert_to=Re
        [/road_cost]

        [road_cost]
            terrain=Ww
            cost=50
            convert_to_bridge=Ww^Bw|, Ww^Bw/, Ww^Bw\
            #convert_to=C
        [/road_cost]

        [road_cost]
            terrain=Hhd
            cost=25
            convert_to=Re
        [/road_cost]

        [road_cost]
            terrain=Ha
            cost=25
            convert_to=Re
        [/road_cost]

        [road_cost]
            terrain=Mm
            cost=40
            convert_to=Re
        [/road_cost]

        #road going through snow
        [road_cost]
            terrain=Aa
            cost=10
            convert_to=Re
        [/road_cost]

        # MIN_COST_ROAD
        [road_cost]
            terrain=Re
            cost=2
            convert_to=Re
        [/road_cost]
        [road_cost]
            terrain=Rr
            cost=2
            convert_to=Rr
        [/road_cost]
        [road_cost]
            terrain=Ww^Bw|
            cost=2
            convert_to=Ww^Bw|
        [/road_cost]
        [road_cost]
            terrain=Ww^Bw/
            cost=2
            convert_to=Ww^Bw/
        [/road_cost]
        [road_cost]
            terrain=Ww^Bw\
            cost=2
            convert_to=Ww^Bw\
        [/road_cost]
        [road_cost]
            terrain=Ch
            cost=2
            convert_to=Ch
        [/road_cost]

        [village]
            terrain=Gd
            convert_to=Gd^Vh
            adjacent_liked=Gd, Ww, Ww, Ww, Ww, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gs^Ve, Gd^Vh, Hhd, Gll^Fp
            rating=6
        [/village]

        #villages in forest are Elvish
        [village]
            terrain=Gs^Fp
            convert_to=Gg^Ve
            rating=4
            adjacent_liked=Gd, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gs^Ve, Gd^Vh, Hhd, Gs^Fp, Gll^Fp, Gll^Fp
        [/village]

        [village]
            terrain=Aa^Fpa
            convert_to=Aa^Vha
            rating=4
            adjacent_liked=Gd, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gs^Ve, Gd^Vh, Hhd, Aa^Fpa, Aa^Fpa, Aa^Fpa
        [/village]

        [village]
            terrain=Hhd
            convert_to=Hhd^Vhh
            rating=4
            adjacent_liked=Gd, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gs^Ve, Gd^Vh, Hhd, Gll^Fp
        [/village]

        [village]
            terrain=Ha
            convert_to=Ha^Vhha
            rating=4
            adjacent_liked=Gd, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gs^Ve, Gd^Vh, Ha, Gll^Fp
        [/village]

        [village]
            terrain=Mm
            convert_to=Mm^Vhh
            rating=3
            adjacent_liked=Gd, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gs^Ve, Gd^Vh, Hhd, Gll^Fp
        [/village]

        #villages in snow
        [village]
            terrain=Aa
            convert_to=Aa^Vha
            rating=4
            adjacent_liked=Gd, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gs^Ve, Gd^Vh, Hhd, Gll^Fp, Aa
        [/village]

        [castle]
            valid_terrain=Gd, Gll^Fp, Hhd, Aa^Fpa, Ha, Mm
            min_distance=12
        [/castle]

        [naming]
            {VILLAGE_NAMES}
        [/naming]

        [village_naming]
            {VILLAGE_NAMES}
        [/village_naming]
    [/generator]

    {DEFAULT_MUSIC_PLAYLIST}
    {DEFAULT_SCHEDULE}

    [event]
        name=prestart

        [terrain]
            terrain=Chr
            [and]
                [not]
                    terrain=C*
                [/not]
                [filter_adjacent_location]
                    terrain=K*
                [/filter_adjacent_location]
            [/and]
        [/terrain]

        [terrain]
            terrain=Ww
            [and]
                terrain=Wo*
                [filter_adjacent_location]
                    terrain=*^V*
                [/filter_adjacent_location]
            [/and]
        [/terrain]

        {WF_SCATTER_EMBELLISHMENTS G*,D*,R*,Uu*,Ur*,Aa ^Es 2}
        {WF_SCATTER_EMBELLISHMENTS Uu* ^Emf 2}
        {WF_SCATTER_EMBELLISHMENTS G*,R*,Aa ^Wm 0.25}
    [/event]

    {WF_ROAD_PATH Rr Rr}

    [side]
        side=1
        controller=human
        team_name=settlers
        user_team_name=_"Settlers"
        fog=no
        shroud=yes
        {FLAG_VARIANT loyalist}
        recruit= #Peasant_no_Advance,Woodsman_no_Advance,Ruffian_no_Advance,Peasant Workers
        gold=0					# side gold set in first scenario
        income=-2				# cancel out the base_income
        save_id=Hero
        persistent=yes
        no_leader=yes
        defeat_condition=no_leader_left
    [/side]

    [side]
        side=2
        controller=ai
        recruit=
        team_name=Rioters
        user_team_name=_"Rioters"
        gold=0
        income=0
        no_leader=yes
        hidden=yes
        defeat_condition=no_units_left
    [/side]

    random_start_time=no
    {TURNS 36 36 36}
    victory_when_enemies_defeated=yes

    [event]
        name=last breath
        [filter]
            id=Hero
        [/filter]
        [message]
            speaker=Hero
            message= _ "Gahahh..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=die,check_objectives,turn end,enemies defeated
        first_time_only=no

        [if]
            [not]
                [have_unit]
                    [filter_side]
                        [enemy_of]
                            side=1
                        [/enemy_of]
                    [/filter_side]
                [/have_unit]
            [/not]
            [and]
                {VARIABLE_CONDITIONAL objective_goal equals 0}
            [/and]
            [then]
                {CLEAR_VARIABLE objective_goal}
                [message]
                    speaker=Hero
                    message= _ "We are done here. Let's go back."
                [/message]
                [fire_event]
                    name=wf_victory
                [/fire_event]

                [endlevel]
                    result=victory
                    bonus=yes
                    carryover_percentage=100
                    linger_mode=no
                    next_scenario=$wf_vars.next_scenario
                [/endlevel]
            [/then]
        [/if]
    [/event]

    [event]
        name=prestart

        {VARIABLE quota.outlaws 1} # Needed for victory

        # Side 1 stuff
        [modify_side]
            side=1
            income=0
        [/modify_side]

        # Side gold
        [store_gold]
            side=1
            variable=stash_gold
        [/store_gold]
        {VARIABLE_OP stash_gold multiply -1}
        [gold]
            side=1
            amount=$stash_gold
        [/gold]
        {VARIABLE_OP stash_gold multiply -1}

        # Unstore the hero
        [store_starting_location]
            side=1
            variable=starting_one
        [/store_starting_location]

        [unstore_unit]
            variable=old_hero_store
            x,y=$starting_one.x,$starting_one.y
        [/unstore_unit]

        {CAPTURE_VILLAGES 1 $starting_one.x $starting_one.y 5}
        {CLEAR_VARIABLE starting_one}

        [gold]
            side=1
            amount={ON_DIFFICULTY 150 188 219} # *2 *1.5 *1.25
        [/gold]

        # Enemy sides stuff

        # Side 2
        [gold]
            side=2
            amount={ON_DIFFICULTY 75 125 175}
        [/gold]
        [if]
            {VARIABLE_CONDITIONAL relations.fief_factions equals $null}
            [or]
                {VARIABLE_CONDITIONAL relations.fief_factions equals ""}
            [/or]
            [then]
                {VARIABLE relations.fief_factions "Drakes,Knalgans,Loyalists,Rebels,Northerners,Undead"}
            [/then]
        [/if]
        {WF_RAND_CHOICE $relations.fief_factions}
        {VARIABLE rnd_outlaw $random_choice}
        {CLEAR_VARIABLE random_choice}
        {WF_RAND_JOIN relations.fief_factions}
        {CLEAR_VARIABLE random_choice_arr}
        [switch]
            variable=rnd_outlaw
            [case]
                value=Drakes
                [sound]
                    name="drake-hit-1.ogg"
                [/sound]
                {RANDOM_VAR rnd_type {FACTION_LEADER_DRAKES}}
                {VARIABLE recruit_type {FACTION_RECRUIT_DRAKES}}
            [/case]
            [case]
                value=Knalgans
                [sound]
                    name="thunderstick.ogg"
                [/sound]
                {RANDOM_VAR rnd_type {FACTION_LEADER_KNALGANS}}
                {VARIABLE recruit_type {FACTION_RECRUIT_KNALGANS}}
            [/case]
            [case]
                value=Loyalists
                [sound]
                    name="horse-canter.wav"
                [/sound]
                {RANDOM_VAR rnd_type {FACTION_LEADER_LOYALISTS}}
                {VARIABLE recruit_type {FACTION_RECRUIT_LOYALISTS}}
            [/case]
            [case]
                value=Northerners
                [sound]
                    name="troll-die-2.ogg"
                [/sound]
                {RANDOM_VAR rnd_type {FACTION_LEADER_NORTHERNERS}}
                {VARIABLE recruit_type {FACTION_RECRUIT_NORTHERNERS}}
            [/case]
            [case]
                value=Rebels
                [sound]
                    name="horse-elf-canter.wav"
                [/sound]
                {RANDOM_VAR rnd_type {FACTION_LEADER_REBELS}}
                {VARIABLE recruit_type {FACTION_RECRUIT_REBELS}}
            [/case]
            [case]
                value=Undead
                [sound]
                    name="wail-sml.wav"
                [/sound]
                {RANDOM_VAR rnd_type {FACTION_LEADER_UNDEAD}}
                {VARIABLE recruit_type {FACTION_RECRUIT_UNDEAD}}
            [/case]
        [/switch]

        [modify_side]
            side=2
            hidden=no
            recruit=$recruit_type
            user_team_name=$rnd_outlaw
        [/modify_side]

        [store_starting_location]
            side=1
            variable=side1_location
        [/store_starting_location]
        [store_starting_location]
            side=2
            variable=side2_location
        [/store_starting_location]

        # Remove the enemy keep
        [terrain]
            terrain=Gd
            [and]
                x,y=$side2_location.x,$side2_location.y
                radius=1
            [/and]
        [/terrain]

        {DIRECTION_CONE $side1_location.x $side1_location.y $side2_location.x $side2_location.y side2_locations}
        {SPAWN_CONE 2 $recruit_type 6 side2_locations}
        {CLEAR_VARIABLE side2_locations}
        {SPAWN_CIRCLE 2 $rnd_type $side2_location.x $side2_location.y}
        {CLEAR_VARIABLE rnd_type}
        {CLEAR_VARIABLE recruit_type}
        {CLEAR_VARIABLE rnd_outlaw}

        {PLACE_HOSTAGE "Direwolf,Giant Spider,Sea Serpent,Cuttle Fish,Water Serpent,Yeti,Gryphon,WF_Gorer,Giant Mudcrawler,Giant Scorpion" $side2_location.x $side2_location.y}
        [store_locations]
            terrain=Gd,Hhd,Ha,Aa^Fpa,Gll^Fp
            x,y=$side2_location.x,$side2_location.y
            radius=8
            [not]
                [filter]
                [/filter]
            [/not]
            include_borders=no
            variable=side2_locations
        [/store_locations]
        {RANDOM_VAR rnd_i 0.."$($side2_locations.length-1)"}

        {PLACE_GOLD_CHEST $side2_location[$rnd_i].x $side2_location[$rnd_i].y}
        {CLEAR_VARIABLE rnd_i}
        {CLEAR_VARIABLE side1_location}
        {CLEAR_VARIABLE side2_location}
    [/event]

    [event]
        name=start

        [unit]
            passable=yes
            placement=leader
            random_traits=yes
            side=1
            type=Elvish Archer
        [/unit]
        [unit]
            passable=yes
            placement=leader
            random_traits=yes
            side=1
            type=Elvish Scout
        [/unit]
        [unit]
            passable=yes
            placement=leader
            random_traits=yes
            side=1
            type=Elvish Fighter
        [/unit]
        [unit]
            passable=yes
            placement=leader
            random_traits=yes
            side=1
            type=Elvish Fighter
        [/unit]

        [message]
            side=1
            type=Elvish Archer
            message=_"Winter is coming, and these criminals want to unleash some wild beast on us."
        [/message]

        [message]
            id=Hero
            message=_"Lay down your arms and surrender."
        [/message]

        [message]
            side=2
            message=_"Never!"
        [/message]

        [objectives]
            side=1
            [objective]
                description= _ "Kill all enemy units"
                condition=win
            [/objective]
            [objective]
                description= _ "Release the wild beast"
                condition=win
            [/objective]
            [objective]
                description= _ "Loot the chest"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Hero"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}

            [gold_carryover]
                bonus=yes
                carryover_percentage=100
            [/gold_carryover]
        [/objectives]
        {CLEAR_VARIABLE store_enemies}
        {CLEAR_VARIABLE objective_arr}
    [/event]

    [event]
        name=time over
        [message]
            speaker=Hero
            message= _ "Aaah! They have unleashed the wild beast upon us!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=wf_victory

        # restore gold
        [gold]
            side=1
            amount=$stash_gold
        [/gold]
        {CLEAR_VARIABLE stash_gold}

        # heal/unpoison Hero
        [heal_unit]
            [filter]
                id=Hero
            [/filter]
            amount=full
            moves=full
            restore_attacks=yes
            restore_statuses=yes
            animate=no
        [/heal_unit]
        [clear_variable]
            name=heal_amount
        [/clear_variable]

        # Save the upgraded hero
        [store_unit]
            variable=new_hero_store
            mode=always_clear
            kill=yes # otherwise they will also appear on recall list
            [filter]
                id=Hero
            [/filter]
        [/store_unit]
        {VARIABLE new_hero_store.x $old_hero_store.x}
        {VARIABLE new_hero_store.y $old_hero_store.y}
        #{CLEAR_VARIABLE new_hero_store.status.poisoned}
        #{CLEAR_VARIABLE new_hero_store.status.slowed}
        #{CLEAR_VARIABLE new_hero_store.status.uncovered}

        #Append new hero to original map units
        [set_variables]
            name=unit_store
            mode=append
            to_variable=new_hero_store
        [/set_variables]

        {CLEAR_VARIABLE old_hero_store}
        {CLEAR_VARIABLE new_hero_store}

        # Save the recruited units
        [store_unit]
            variable=crew_store
            mode=always_clear
            kill=yes # otherwise they will also appear on recall list
            [filter]
                side=1
            [/filter]
        [/store_unit]
        [for]
            array=crew_store
            reverse=yes
            [do]
                {VARIABLE crew_store[$i].x recall}
                {VARIABLE crew_store[$i].y recall}
                #{CLEAR_VARIABLE crew_store[$i].status.poisoned}
                #{CLEAR_VARIABLE crew_store[$i].status.slowed}
                #{CLEAR_VARIABLE crew_store[$i].status.uncovered}
                [set_variables]
                    name=unit_store
                    mode=append
                    to_variable=crew_store[$i]
                [/set_variables]
            [/do]
        [/for]

        {CLEAR_VARIABLE crew_store}
        {CLEAR_VARIABLE quota}
    [/event]

    [event]
        # Event added just in case of :n in debug mode.
        name=victory

        # This variable gets cleared in wf_victory.
        # This way we know if this victory was fired because of :n
        [if]
            {VARIABLE_CONDITIONAL quota.outlaws not_equals $null}
            [then]
                {NARRATOR_SAYS _"Debug mode :n"}
                [fire_event]
                    name=wf_victory
                [/fire_event]
                [endlevel]
                    result=victory
                    bonus=no
                    carryover_percentage=100
                    linger_mode=no
                    next_scenario=$wf_vars.next_scenario
                [/endlevel]
            [/then]
        [/if]
    [/event]

    [event]
        name=last breath
        id=enemy_cost
        first_time_only=no

        [gold]
            side=$second_unit.side
            amount="$(floor($unit.cost * 13 / 100.0))"
        [/gold]
    [/event]

    {AMLA_EXTRA}
    {HEAL_RECALL}
    [event]
        name=side 1 turn refresh
        first_time_only=no

        {FIRE_EVENT heal_recall_list}
    [/event]

    {WF_RAND_CHOICE_EVENT}
    {WF_SEASON_DEBUG autumn}
[/scenario]

#undef DIRECTION_CONE
#undef SPAWN_CONE
#undef SPAWN_LOCATION
#undef SPAWN_CIRCLE
#undef PLACE_HOSTAGE
#undef PLACE_GOLD_CHEST
