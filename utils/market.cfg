#textdomain wesnoth-Wild_Frontiers

#define MARKET_MOVETO
    [event]
        name=moveto
        id=moveto_market
        first_time_only=no
        [filter]
            side=9
            type=Caravan
            x,y=$x1,$y1
            [filter_location]
                terrain=*^Wm
                x,y=$x1,$y1
            [/filter_location]
        [/filter]

        {WF_MARKET_ITEMS}
        #market=starting bonus 1 | caravan market 2 | disabled not for sale 3
        {WF_MARKET_ITEMS_APPEND_MARKET caravan_market_items 1}
        {WF_MARKET_ITEMS_APPEND_MARKET caravan_market_items 2}
        {WF_MARKET_ITEMS_RANDOM_INDEX caravan_market_items rnd_i1 rnd_label1}
        {WF_MARKET_ITEMS_RANDOM_INDEX caravan_market_items rnd_i2 rnd_label2}
        {WF_MARKET_ITEMS_RANDOM_INDEX caravan_market_items rnd_i3 rnd_label3}
        {CLEAR_VARIABLE caravan_market_items}
        {CLEAR_VARIABLE wf_market_items}

        {RANDOM_VAR rnd_price1 "70..80"}
        {VARIABLE rnd_pay1 $rnd_price1}
        {VARIABLE_OP rnd_pay1 multiply -1}

        {RANDOM_VAR rnd_price2 "70..80"}
        {VARIABLE rnd_pay2 $rnd_price2}
        {VARIABLE_OP rnd_pay2 multiply -1}

        {RANDOM_VAR rnd_price3 "70..80"}
        {VARIABLE rnd_pay3 $rnd_price3}
        {VARIABLE_OP rnd_pay3 multiply -1}

        [message]
            speaker=unit
            message=_"May we interest you in one of these, milord.
$rnd_label1| for $rnd_price1| gold.
$rnd_label2| for $rnd_price2| gold.
$rnd_label3| for $rnd_price3| gold."
        [/message]

        [fire_event]
            name=wf_market
            [primary_unit]
                x=$unit.x
                y=$unit.y
            [/primary_unit]
            #[secondary_unit]
            #    x=$x2
            #    y=$y2
            #[/secondary_unit]
            [primary_attack]
                index1=$rnd_i1
                label1=$rnd_label1
                price1=$rnd_price1
                pay1=$rnd_pay1

                index2=$rnd_i2
                label2=$rnd_label2
                price2=$rnd_price2
                pay2=$rnd_pay2

                index3=$rnd_i3
                label3=$rnd_label3
                price3=$rnd_price3
                pay3=$rnd_pay3

                x=$x1
                y=$y1
            [/primary_attack]
        [/fire_event]
        [kill]
            side=9
            animate=no
            id=$unit.id
            fire_event=no
        [/kill]
        {CLEAR_VARIABLE rnd_i1}
        {CLEAR_VARIABLE rnd_price1}
        {CLEAR_VARIABLE rnd_pay1}
        {CLEAR_VARIABLE rnd_label1}

        {CLEAR_VARIABLE rnd_i2}
        {CLEAR_VARIABLE rnd_price2}
        {CLEAR_VARIABLE rnd_pay2}
        {CLEAR_VARIABLE rnd_label2}

        {CLEAR_VARIABLE rnd_i3}
        {CLEAR_VARIABLE rnd_price3}
        {CLEAR_VARIABLE rnd_pay3}
        {CLEAR_VARIABLE rnd_label3}
    [/event]
#enddef

#define COWARD_CARAVAN
    side=9
    ai_type=coward
    ca_id=coward_caravan
    ca_score=250000
    [filter]
        side=9
        type=Caravan
        [not]
            ability=frozen
        [/not]
        [not]
            ability=fallback
        [/not]
        [not]
            ability=coward
        [/not]
        [not]
            ability=tavern
        [/not]
    [/filter]
#enddef

#define GOTO_CARAVAN_FILTER
    [filter]
        side=9
        type=Caravan
        [not]
            ability=frozen
        [/not]
        [not]
            ability=fallback
        [/not]
        [not]
            ability=coward
        [/not]
        [not]
            ability=tavern
        [/not]
    [/filter]
    [filter_location]
        terrain=*^Wm
    [/filter_location]
#enddef

#define GOTO_CARAVAN
    side=9
    ai_type=wf_goto
    ca_id=goto_caravan
    ca_score=300000
    {GOTO_CARAVAN_FILTER}
    avoid_enemies=1
#enddef
#define GOTO_CARAVAN_STRAIGHT
    side=9
    ai_type=goto
    ca_id=goto_caravan_straight
    ca_score=275000
    {GOTO_CARAVAN_FILTER}
    use_straight_line=yes
#enddef

#define MARKET_CARAVAN SEASON
    [event]
        name=prestart
        [micro_ai]
            action=add
            {GOTO_CARAVAN}
        [/micro_ai]
        [micro_ai]
            action=add
            {GOTO_CARAVAN_STRAIGHT}
        [/micro_ai]
        [micro_ai]
            action=add
            {COWARD_CARAVAN}
            distance=6
            attack_if_trapped=no
        [/micro_ai]
    [/event]

    {MARKET_MOVETO}

    [event]
        name=side 9 turn 1 end
        id=market_caravan_turn
        first_time_only=yes

        [if]
            #[filter_condition]
            [have_location]
                terrain=*^Wm
                count=1
            [/have_location]
            #[have_unit]
            #    side=9
            #    type=Caravan
            #    search_recall_list=no
            #    count=0
            #[/have_unit]
            #[/filter_condition]
            [then]
                {FIRE_EVENT spawn_market_caravan}
                [if]
                    {VARIABLE_CONDITIONAL wf_vars.armor_caravan boolean_equals yes}
                    [then]
                        {FIRE_EVENT spawn_market_caravan}
                    [/then]
                [/if]
                [remove_event]
                    id=spawn_market_caravan
                [/remove_event]
            [/then]
            [else]
                [remove_event]
                    id=spawn_market_caravan
                [/remove_event]
            [/else]
        [/if]
    [/event]

    [event]
        name=spawn_market_caravan
        id=spawn_market_caravan
        first_time_only=no

        {RANDOM_VAR rnd_dir 0,1,2,3}	# 0=east, 1=north, 2=west, 3=south
        [switch]
            variable=rnd_dir
            [case]
                value=0
                {VARIABLE market_name "Eastern Goods"}
                {VARIABLE market_role "east_goods"}
            [/case]
            [case]
                value=1
                {VARIABLE market_name "Northern Goods"}
                {VARIABLE market_role "north_goods"}
            [/case]
            [case]
                value=2
                {VARIABLE market_name "Western Goods"}
                {VARIABLE market_role "west_goods"}
            [/case]
            [case]
                value=3
                {VARIABLE market_name "Southern Goods"}
                {VARIABLE market_role "south_goods"}
            [/case]
        [/switch]

        {FIND_NEAREST_HEX market_start $map_signs[$rnd_dir].x $map_signs[$rnd_dir].y (
            {NOT_FILTER}
            terrain=!,W*,*^Y*,*^V*,K*,C*
        ) }

        [unit]
            name=$market_name
            passable=yes
            placement=map
            random_traits=no
            role=$market_role
            side=9
            type=Caravan
            x=$market_start.x
            y=$market_start.y
            {IS_LOYAL}
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            to_variable=market_unit
        [/unit]

        [unstore_unit]
            variable=market_unit
            find_vacant=yes
            check_passability=yes
            animate=yes
            text=$market_name
            # fire_event=yes
        [/unstore_unit]

        [if]
            {VARIABLE_CONDITIONAL wf_vars.armor_caravan boolean_equals yes}
            [then]
                [modify_unit]
                    [filter]
                        id=$market_unit.id
                    [/filter]
                    [object]
                        # TRAIT_RESILIENT
                        [effect]
                            apply_to=hitpoints
                            increase_total=4
                            heal_full=yes
                        [/effect]
                        [effect]
                            apply_to=new_attack
                            name=sword
                            description=_"sword"
                            type=blade
                            range=melee
                            damage=10
                            number=4
                            [specials]
                                {WEAPON_SPECIAL_MAGICAL}
                            [/specials]
                            icon="attacks/sword-holy.png"
                        [/effect]
                        [effect]
                            apply_to=new_animation
                            [attack_anim]
                                [filter_attack]
                                    name=sword
                                [/filter_attack]
                                start_time=-200
                                horse_sound_start_time=-200
                                offset=0~0.6:200,0.6~0:200
                                [horse_sound_frame]
                                    sound=horse-canter.wav
                                [/horse_sound_frame]
                                {SOUND:HIT_AND_MISS {SOUND_LIST:SWORD_SWISH} {SOUND_LIST:MISS} -100}
                            [/attack_anim]
                        [/effect]
                        [effect]
                            apply_to=new_attack
                            name=bow
                            description=_"bow"
                            type=pierce
                            range=ranged
                            damage=10
                            number=4
                            [specials]
                                {WEAPON_SPECIAL_MAGICAL}
                            [/specials]
                            icon="attacks/bow-elven.png"
                        [/effect]
                        [effect]
                            apply_to=new_animation
                            [attack_anim]
                                [filter_attack]
                                    name=bow
                                [/filter_attack]
                                start_time=-250
                                missile_start_time=-150

                                [missile_frame]
                                    duration=150
                                    image="projectiles/missile-n.png"
                                    image_diagonal="projectiles/missile-ne.png"
                                [/missile_frame]
                                {SOUND:HIT_AND_MISS bow-puny.ogg bow-puny-miss.ogg -225}
                            [/attack_anim]
                        [/effect]
                    [/object]
                [/modify_unit]
            [/then]
        [/if]

        {WF_SCROLL_UNIT (id=$market_unit.id)}

        [message]
            speaker=$market_unit.id
            message=_"Pray grant us safe passage to your windmill, milord. For our cargo carries the finest imports."
        [/message]

        {CLEAR_VARIABLE market_unit}
        {CLEAR_VARIABLE market_name}
        {CLEAR_VARIABLE market_role}
        {CLEAR_VARIABLE rnd_dir}
    [/event]

    {WF_MARKET_EVENTS}
#enddef

#define WF_MARKET_EVENTS
    [event]
        name=wf_market
        id=wf_market
        first_time_only=no
        delayed_variable_substitution=no

        [remove_event]
            id=moveto_sale_item_$weapon.x|_$weapon.y|
        [/remove_event]
        [remove_item]
            x,y=$weapon.x,$weapon.y
            image=items/chest-open.png
        [/remove_item]
        [item]
            x,y=$weapon.x,$weapon.y
            image=items/chest-open.png
        [/item]
        [label]
            x,y=$weapon.x,$weapon.y
            text="$weapon.label1|
$weapon.label2|
$weapon.label3|"
        [/label]

        {WF_MARKET_ITEMS}

        [event]
            name=moveto
            id=moveto_sale_item_$weapon.x|_$weapon.y|
            first_time_only=no
            delayed_variable_substitution=no
            [filter]
                side=1
                x,y=$weapon.x,$weapon.y
            [/filter]

            {WF_MARKET_ITEMS}

            [message]
                speaker=unit
                message=_"$wf_market_items[$weapon.index1].message
$wf_market_items[$weapon.index2].message
$wf_market_items[$weapon.index3].message"
            [/message]

            {VARIABLE unit_has_item1 no}
            {VARIABLE unit_has_item2 no}
            {VARIABLE unit_has_item3 no}
            [foreach]
                array=unit.modifications.object
                [do]
                    [if]
                        {VARIABLE_CONDITIONAL this_item.name equals $wf_market_items[$weapon.index1].object.name}
                        [then]
                            {VARIABLE unit_has_item1 yes}
                        [/then]
                    [/if]
                    [if]
                        {VARIABLE_CONDITIONAL this_item.name equals $wf_market_items[$weapon.index2].object.name}
                        [then]
                            {VARIABLE unit_has_item2 yes}
                        [/then]
                    [/if]
                    [if]
                        {VARIABLE_CONDITIONAL this_item.name equals $wf_market_items[$weapon.index3].object.name}
                        [then]
                            {VARIABLE unit_has_item3 yes}
                        [/then]
                    [/if]
                [/do]
            [/foreach]

            [store_gold]
                side=1
                variable=wf_vars.side1_gold
            [/store_gold]

            [message]
                speaker=unit
                message=_"Take one of:"
                [option]
                    [show_if]
                        {VARIABLE_CONDITIONAL unit_has_item1 boolean_equals no}
                        [variable]
                            name=wf_vars.side1_gold
                            greater_than_equal_to=$weapon.price1
                        [/variable]
                    [/show_if]
                    label=_"$wf_market_items[$weapon.index1].name| for $weapon.price1| gold?"
                    [command]
                        [gold]
                            side=1
                            amount=$weapon.pay1
                        [/gold]
                        [sound]
                            name=gold.ogg
                        [/sound]
                        [store_gold]
                            side=1
                            variable=wf_vars.side1_gold
                        [/store_gold]
                        [if]
                            {VARIABLE_CONDITIONAL wf_vars.side1_gold less_than 100}
                            [then]
                                {FIRE_EVENT low_gold}
                            [/then]
                        [/if]
                        [insert_tag]
                            name=object
                            variable=wf_market_items[$weapon.index1].object
                        [/insert_tag]
                        [remove_unit_overlay]
                            x,y=$weapon.x,$weapon.y
                            image=misc/pickable-overlay.png
                        [/remove_unit_overlay]
                        [unit_overlay]
                            x,y=$weapon.x,$weapon.y
                            image=misc/pickable-overlay.png
                        [/unit_overlay]
                        [remove_item]
                            x,y=$weapon.x,$weapon.y
                            image=items/chest-open.png
                        [/remove_item]
                        [label]
                            x,y=$weapon.x,$weapon.y
                            text=""
                        [/label]
                        [remove_event]
                            id=moveto_sale_item_$weapon.x|_$weapon.y|
                        [/remove_event]
                    [/command]
                [/option]
                [option]
                    [show_if]
                        {VARIABLE_CONDITIONAL unit_has_item2 boolean_equals no}
                        [variable]
                            name=wf_vars.side1_gold
                            greater_than_equal_to=$weapon.price2
                        [/variable]
                    [/show_if]
                    label=_"$wf_market_items[$weapon.index2].name| for $weapon.price2| gold?"
                    [command]
                        [gold]
                            side=1
                            amount=$weapon.pay2
                        [/gold]
                        [sound]
                            name=gold.ogg
                        [/sound]
                        [store_gold]
                            side=1
                            variable=wf_vars.side1_gold
                        [/store_gold]
                        [if]
                            {VARIABLE_CONDITIONAL wf_vars.side1_gold less_than 100}
                            [then]
                                {FIRE_EVENT low_gold}
                            [/then]
                        [/if]
                        [insert_tag]
                            name=object
                            variable=wf_market_items[$weapon.index2].object
                        [/insert_tag]
                        [remove_unit_overlay]
                            x,y=$weapon.x,$weapon.y
                            image=misc/pickable-overlay.png
                        [/remove_unit_overlay]
                        [unit_overlay]
                            x,y=$weapon.x,$weapon.y
                            image=misc/pickable-overlay.png
                        [/unit_overlay]
                        [remove_item]
                            x,y=$weapon.x,$weapon.y
                            image=items/chest-open.png
                        [/remove_item]
                        [label]
                            x,y=$weapon.x,$weapon.y
                            text=""
                        [/label]
                        [remove_event]
                            id=moveto_sale_item_$weapon.x|_$weapon.y|
                        [/remove_event]
                    [/command]
                [/option]
                [option]
                    [show_if]
                        {VARIABLE_CONDITIONAL unit_has_item3 boolean_equals no}
                        [variable]
                            name=wf_vars.side1_gold
                            greater_than_equal_to=$weapon.price3
                        [/variable]
                    [/show_if]
                    label=_"$wf_market_items[$weapon.index3].name| for $weapon.price3| gold?"
                    [command]
                        [gold]
                            side=1
                            amount=$weapon.pay3
                        [/gold]
                        [sound]
                            name=gold.ogg
                        [/sound]
                        [store_gold]
                            side=1
                            variable=wf_vars.side1_gold
                        [/store_gold]
                        [if]
                            {VARIABLE_CONDITIONAL wf_vars.side1_gold less_than 100}
                            [then]
                                {FIRE_EVENT low_gold}
                            [/then]
                        [/if]
                        [insert_tag]
                            name=object
                            variable=wf_market_items[$weapon.index3].object
                        [/insert_tag]
                        [remove_unit_overlay]
                            x,y=$weapon.x,$weapon.y
                            image=misc/pickable-overlay.png
                        [/remove_unit_overlay]
                        [unit_overlay]
                            x,y=$weapon.x,$weapon.y
                            image=misc/pickable-overlay.png
                        [/unit_overlay]
                        [remove_item]
                            x,y=$weapon.x,$weapon.y
                            image=items/chest-open.png
                        [/remove_item]
                        [label]
                            x,y=$weapon.x,$weapon.y
                            text=""
                        [/label]
                        [remove_event]
                            id=moveto_sale_item_$weapon.x|_$weapon.y|
                        [/remove_event]
                    [/command]
                [/option]
                [option]
                    label=_"Not now"
                    [command]
                    [/command]
                [/option]
            [/message]

            {CLEAR_VARIABLE unit_has_item1}
            {CLEAR_VARIABLE unit_has_item2}
            {CLEAR_VARIABLE unit_has_item3}
            {CLEAR_VARIABLE wf_market_items}
        [/event]
        {CLEAR_VARIABLE wf_market_items}
    [/event]
#enddef

#define WF_MARKET_ITEMS
    # Effects lifted from: Heroes
    #market=starting bonus 1 | caravan market 2 | disabled not for sale 3
    [set_variables]
        name=wf_market_items
        mode=replace
        [literal]
            name="Ring of Swiftness"
            message="Ring of Swiftness: This ring grants +2 movement points."
            market=1
            [object]
                name=_"Ring of Swiftness"
                image=items/ring-gold.png
                description=_"This ring grants +2 movement points."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        [dummy]
                            id=swift
                            name=_"swift"
                            female_name= _ "female^swift"
                            description=_"This unit's movement is increased by +2 points."
                        [/dummy]
                    [/abilities]
                [/effect]
                [effect]
                    apply_to=movement
                    increase=2
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Staff of Horror"
            message="Staff of Horror: Saps the life energy of nearby enemy and decreases their damage by 25%."
            market=1
            [object]
                name=_"Staff of Horror"
                image=items/staff.png
                description=_"Decreases the damage of nearby enemy units by 25%"
                [effect]
                    apply_to=new_ability
                    [abilities]
                        [leadership]
                            id=magic sap
                            value=-25
                            cumulative=no
                            name= _ "magic sap"
                            female_name= _ "female^magic sap"
                            description= _ "This unit saps the life energy of nearby enemy units and decreases their damage by 25%."
                            affect_self=no
                            affect_enemies=yes
                            affect_allies=no
                            [affect_adjacent]
                                [filter]
                                [/filter]
                            [/affect_adjacent]
                        [/leadership]
                    [/abilities]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Heart of the Wose"
            message="Heart of the Wose: This item grants +8 regeneration and curing ability."
            market=1
            [object]
                name=_"Heart of the Wose"
                image=items/ball-green.png
                description=_"The Heart of the Wose grants the +8 regeneration ability."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_REGENERATES}
                        {ABILITY_CURES}
                    [/abilities]
                [/effect]
                #[effect]
                #    apply_to=halo
                #    halo=halo/elven/elven-shield-halo-100pct.png
                #[/effect]
            [/object]
        [/literal]
        [literal]
            name="Armor of the Thane"
            message="Armor of the Thane: Inspires nearby units to increase the damage by +25."
            market=1
            [object]
                name=_"Armor of the Thane"
                image=items/armor-golden.png
                description=_"Increases the damage of nearby units by +25"
                [effect]
                    apply_to=new_ability
                    [abilities]
                        [leadership]
                            id=inspire
                            value=25
                            cumulative=yes
                            name= _ "inspire"
                            description= _ "This unit can inspire adjacent friendly units, making them do 25% more damage."
                            affect_self=no
                            affect_enemies=no
                            affect_allies=yes
                            [affect_adjacent]
                                [filter]
                                [/filter]
                            [/affect_adjacent]
                        [/leadership]
                    [/abilities]
                [/effect]
                #[effect]
                #    apply_to=halo
                #    halo=halo/elven/elven-shield-halo-100pct.png
                #[/effect]
            [/object]
        [/literal]
        [literal]
            name="Winged Circlet"
            message="Winged Circlet: The bearer of the Winged Circlet needs 25% less experience to advance."
            market=3
            [object]
                name=_"Winged Circlet"
                image=icons/circlet_winged.png
                description=_"The bearer of the Winged Circlet needs 25% less experience to advance."
                [effect]
                    apply_to=max_experience
                    increase=-25%
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Rusty Arrows"
            message="Rusty Arrows: This modifier grants the poison special to ranged pierce attacks."
            market=1
            [object]
                name=_"Rusty Arrows"
                image=items/potion-poison.png
                description=_"Grants the poison special to ranged pierce attacks."
                [effect]
                    apply_to=attack
                    range=ranged
                    type=pierce
                    [set_specials]
                        mode=append
                        {WEAPON_SPECIAL_POISON}
                    [/set_specials]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Poison Vial"
            message="Poison Vial: This modifier grants the poison special to melee blade or pierce attacks."
            market=1
            [object]
                name=_"Poison Vial"
                image=items/potion-poison.png
                description=_"Grants the poison special to melee blade or pierce attacks."
                [effect]
                    apply_to=attack
                    range=melee
                    type=pierce
                    [set_specials]
                        mode=append
                        {WEAPON_SPECIAL_POISON}
                    [/set_specials]
                [/effect]
                [effect]
                    apply_to=attack
                    range=melee
                    type=blade
                    [set_specials]
                        mode=append
                        {WEAPON_SPECIAL_POISON}
                    [/set_specials]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Eye of the Dragon"
            message="Eye of the Dragon: Grants another attack per turn."
            market=3
            [object]
                name=_"Eye of the Dragon"
                image=items/ball-blue.png
                description=_"Grants another attack per turn."
                [effect]
                    apply_to=max_attacks
                    increase=1
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Green Cloak"
            message="Green Cloak: This cloak grants the ambush ability."
            market=1
            [object]
                name=_"Green Cloak"
                image=items/cloak-green.png
                description=_"This cloak grants the ambush ability."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_AMBUSH}
                    [/abilities]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Black Cloak"
            message="Black Cloak: This cloak grants the nightstalk ability."
            market=1
            [object]
                name=_"Black Cloak"
                image=items/cloak-green.png
                description=_"This cloak grants the nightstalk ability."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_NIGHTSTALK}
                    [/abilities]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="White Cloak"
            message="White Cloak: This cloak grants the concealment ability."
            market=2
            [object]
                name=_"White Cloak"
                image=items/cloak-green.png
                description=_"This cloak grants the concealment ability."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_CONCEALMENT}
                    [/abilities]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Red Cloak"
            message="Red Cloak: This cloak grants the skirmisher ability."
            market=1
            [object]
                name=_"Red Cloak"
                image=items/cloak-green.png
                description=_"This cloak grants the skirmisher ability."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_SKIRMISHER}
                    [/abilities]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Notes of War XI"
            message="Notes of War XI: This book grants the leadership ability."
            market=1
            [object]
                name=_"Notes of War XI"
                image=items/book4.png
                description=_"This book grants the leadership ability."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_LEADERSHIP}
                    [/abilities]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Chain Armor"
            message="Chain Armor: This armor increases the attack parry bonus by 10%."
            market=3
            [object]
                name=_"Chain Armor"
                image=icons/armor-chain.png
                description=_"Increases the attack parry bonus by 10%"
                [effect]
                    apply_to=attack
                    increase_parry=10
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Breastplate"
            message="Breastplate: This item grants +30 hitpoints."
            market=3
            [object]
                name=_"Breastplate"
                image=icons/breastplate.png
                description=_"Grants +30 hitpoints"
                [effect]
                    apply_to=hitpoints
                    increase_total=30
                    heal_full=yes
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Bidhander"
            message="Bidhander: This modifier increases the damage of melee blade type attacks by +2 and grants the slow special."
            market=1
            [object]
                name=_"Bidhander"
                image=items/sword.png
                description=_"Increases the attack damage of melee blade type attacks by +2 and grants the slow special."
                [effect]
                    apply_to=attack
                    range=melee
                    type=blade
                    increase_damage=2
                    #increase_attacks=1
                    #set_description=bidhander
                [/effect]
                [effect]
                    apply_to=attack
                    type=blade
                    range=melee
                    [set_specials]
                        mode=append
                        {WEAPON_SPECIAL_SLOW}
                    [/set_specials]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Spear of Gobo"
            message="Spear of Gobo: This modifier increases the damage of melee pierce type attacks by +2 and grants the slow special."
            market=1
            [object]
                name=_"Spear of Gobo"
                image=items/spear-fancy.png
                description=_"Increases the attack damage of melee pierce type attacks by +2 and grants the slow special."
                [effect]
                    apply_to=attack
                    range=melee
                    type=pierce
                    increase_damage=2
                    #increase_attacks=1
                    #set_description=gobo spear
                [/effect]
                [effect]
                    apply_to=attack
                    type=pierce
                    range=melee
                    [set_specials]
                        mode=append
                        {WEAPON_SPECIAL_SLOW}
                    [/set_specials]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Staff of Alduin"
            message="Staff of Alduin: This modifier increases the damage of ranged arcane type attacks by +2 and grants the slow special."
            market=3
            [object]
                name=_"Staff of Alduin"
                image=items/staff.png
                description=_"Increases the attack damage of ranged arcane type attacks by +2 and grants the slow special."
                [effect]
                    apply_to=attack
                    type=arcane
                    range=ranged
                    increase_damage=2
                    #increase_attacks=1
                [/effect]
                [effect]
                    apply_to=attack
                    type=arcane
                    range=ranged
                    [set_specials]
                        mode=append
                        {WEAPON_SPECIAL_SLOW}
                    [/set_specials]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Staff of Freezing Death"
            message="Staff of Freezing Death: This staff grants a new melee slowing cold attack."
            market=1
            [object]
                name=_"Staff of Freezing Death"
                image=items/staff-magic.png
                description=_"Grants a melee slowing cold attack"
                [effect]
                    apply_to=new_attack
                    name=staff_of_freezing_death
                    description=_"staff of freezing death"
                    type=cold
                    damage=8
                    number=3
                    range=melee
                    [specials]
                        {WEAPON_SPECIAL_SLOW}
                    [/specials]
                    icon=attacks/staff-magic.png
                [/effect]
                [effect]
                    apply_to=new_animation
                    [attack_anim]
                        [filter_attack]
                            name=staff_of_freezing_death
                        [/filter_attack]
                        start_time=-200
                        offset=0~0.6:200,0.6~0:200
                        {SOUND:HIT_AND_MISS staff.ogg staff-miss.ogg -125}
                    [/attack_anim]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Storm Trident"
            message="Storm Trident: This trident grants a new ranged fire attack."
            market=1
            [object]
                name=_"Storm Trident"
                image=items/storm-trident.png
                description=_"Grants a ranged fire attack"
                [effect]
                    apply_to=new_attack
                    name=storm_trident
                    description=_"storm trident"
                    type=fire
                    damage=11
                    number=3
                    range=ranged
                    [specials]
                        {WEAPON_SPECIAL_MAGICAL}
                    [/specials]
                    icon=attacks/lightning.png
                [/effect]
                {LIGHTNING_ANIMATION "storm_trident" 1}
                {LIGHTNING_ANIMATION "storm_trident" 2}
                {LIGHTNING_ANIMATION "storm_trident" 3}
            [/object]
        [/literal]
        [literal]
            name="Crystal Hammer"
            message="Crystal Hammer: This modifier increases the damage of melee impact type attacks by +2 and grants the slow special."
            market=1
            [object]
                name=_"Crystal Hammer"
                image=items/hammer-runic.png
                description=_"Increases the attack damage of melee impact type attacks by +2 and grants the slow special."
                [effect]
                    apply_to=attack
                    type=impact
                    range=melee
                    increase_damage=2
                    #increase_attacks=1
                [/effect]
                [effect]
                    apply_to=attack
                    type=impact
                    range=melee
                    [set_specials]
                        mode=append
                        {WEAPON_SPECIAL_SLOW}
                    [/set_specials]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Crystal Bow"
            message="Crystal Bow: This modifier increases the damage of ranged pierce type attacks by +2 and grants the slow special."
            market=1
            [object]
                name=_"Crystal Bow"
                image=items/bow-crystal.png
                description=_"Increases the attack damage of ranged pierce type attacks by +2 and grants the slow special."
                [effect]
                    apply_to=attack
                    type=pierce
                    range=ranged
                    increase_damage=2
                    #increase_attacks=1
                [/effect]
                [effect]
                    apply_to=attack
                    range=ranged
                    type=pierce
                    [set_specials]
                        mode=append
                        {WEAPON_SPECIAL_SLOW}
                    [/set_specials]
                [/effect]
            [/object]
        [/literal]
        #CotF
        [literal]
            name="Ring of Major Resistance"
            message="Ring of Major Resistance: This ring increases all of the wearer's resistance by 20%."
            market=1
            [object]
                name=_"Ring of Major Resistance"
                image=icons/ring_gold.png
                description=_"This ring increases all of the wearer's resistance by 20%."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        [dummy]
                            id=major_resistance
                            name=_"major resistance"
                            female_name= _ "female^major resistance"
                            description=_"This unit's resistances are all increased by 20% from their base values."
                        [/dummy]
                    [/abilities]
                [/effect]
                [effect]
                    apply_to=resistance
                    replace=no
                    [resistance]
                        blade=-20
                        pierce=-20
                        impact=-20
                        fire=-20
                        cold=-20
                        arcane=-20
                    [/resistance]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Ring of Blade Resistance"
            message="Ring of Blade Resistance: This ring increases the wearer's blade resistance by 30%."
            market=3
            [object]
                name=_"Ring of Blade Resistance"
                image=icons/ring_gold.png
                description=_"This ring increases the wearer's blade resistance by 30%."
                [effect]
                    apply_to=resistance
                    replace=no
                    [resistance]
                        blade=-30
                    [/resistance]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Ring of Impact Resistance"
            message="Ring of Impact Resistance: This ring increases the wearer's impact resistance by 30%."
            market=3
            [object]
                name=_"Ring of Impact Resistance"
                image=icons/ring_gold.png
                description=_"Ring of Impact Resistance: This ring increases the wearer's impact resistance by 30%."
                [effect]
                    apply_to=resistance
                    replace=no
                    [resistance]
                        impact=-30
                    [/resistance]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Ring of Pierce Resistance"
            message="Ring of Pierce Resistance: This ring increases the wearer's pierce resistance by 30%."
            market=3
            [object]
                name=_"Ring of Pierce Resistance"
                image=icons/ring_gold.png
                description=_"This ring increases the wearer's pierce resistance by 30%."
                [effect]
                    apply_to=resistance
                    replace=no
                    [resistance]
                        pierce=-30
                    [/resistance]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Ring of Weather Resistance"
            message="Ring of Weather Resistance: This ring increases the wearer's fire and cold resistances by 30%."
            market=3
            [object]
                name=_"Ring of Weather Resistance"
                image=icons/ring_gold.png
                description=_"This ring increases the wearer's fire and cold resistances by 30%."
                [effect]
                    apply_to=resistance
                    replace=no
                    [resistance]
                        fire=-30
                        cold=-30
                    [/resistance]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Ring of Arcane Resistance"
            message="Ring of Arcane Resistance: This ring increases the wearer's arcane resistance by 30%."
            market=3
            [object]
                name=_"Ring of Arcane Resistance"
                image=icons/ring_gold.png
                description=_"This ring increases the wearer's arcane resistance by 30%."
                [effect]
                    apply_to=resistance
                    replace=no
                    [resistance]
                        arcane=-30
                    [/resistance]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Ring of Magnetism"
            message="Ring of Magnetism: This ring greatly increases the wearer's accuracy."
            market=3
            [object]
                name=_"Ring of Magnetism"
                image=icons/ring_gold.png
                description=_"This ring greatly increases the wearer's accuracy."
                [effect]
                    apply_to=attack
                    remove_specials=magical,marksman
                [/effect]
                [effect]
                    apply_to=new_ability
                    [abilities]
                        [dummy]
                            id=magnetic
                            name=_"magnetic"
                            female_name=_"female^magnetic"
                            description=_"All of this unit's attacks have an extremely high chance to hit."
                        [/dummy]
                    [/abilities]
                [/effect]
                [effect]
                    apply_to=attack
                    [set_specials]
                        mode=append
                        [chance_to_hit]
                            id=magnetic
                            name=_"magnetic"
                            description=_"This attack always has a 90% chance to hit regardless of the defensive ability of the unit being attacked."
                            value=90
                            cumulative=no
                        [/chance_to_hit]
                    [/set_specials]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Potion of Strength"
            message="Potion of Strength: This potion grants the drinker incredible strength."
            market=3
            [object]
                name=_"Potion of Strength"
                image=icons/potion_green_medium.png
                description=_"This potion grants the drinker incredible strength."
                [effect]
                    apply_to=attack
                    range=melee
                    increase_damage=2
                [/effect]
                [effect]
                    apply_to=hitpoints
                    increase_total=5
                    heal_full=yes
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Potion of Illumination"
            message="Potion of Illumination: This potion causes drinker to glow with a warm inner light."
            market=3
            [object]
                name=_"Potion of Illumination"
                image=icons/potion_green_medium.png
                description=_"This potion causes drinker to glow with a warm inner light."
                [effect]
                    apply_to=remove_ability
                    [abilities]
                        [illuminates]
                            id=darkens
                        [/illuminates]
                    [/abilities]
                [/effect]
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_ILLUMINATES}
                    [/abilities]
                [/effect]
                [effect]
                    apply_to=halo
                    halo=halo/illuminates-aura.png
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Potion of Gloom"
            message="Potion of Gloom: This potion casts a dark gloom over the drinker."
            market=3
            [object]
                name=_"Potion of Gloom"
                image=icons/potion_green_medium.png
                description=_"This potion casts a dark gloom over the drinker."
                [effect]
                    apply_to=remove_ability
                    [abilities]
                        [illuminates]
                            id=illumination
                        [/illuminates]
                    [/abilities]
                [/effect]
                [effect]
                    apply_to=new_ability
                    [abilities]
                        [illuminates]
                            id=darkens
                            value=-25
                            min_value=-25
                            cumulative=no
                            name=_"darkens"
                            female_name=_"female^darkens"
                            description=_"This unit darkens the surrounding area, making lawful units fight worse, and chaotic units fight better."
                            affect_self=yes
                        [/illuminates]
                    [/abilities]
                [/effect]
                [effect]
                    apply_to=halo
                    halo=halo/darkens-aura.png
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Potion of Stoneskin"
            message="Potion of Stoneskin: This potion hardens the drinker's skin, but greatly reduces movement."
            market=3
            [object]
                name=_"Potion of Stoneskin"
                image=icons/potion_green_medium.png
                description=_"This potion hardens the drinker's skin, but greatly reduces movement."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        [dummy]
                            id=stoneskin
                            name=_"stoneskin"
                            female_name= _ "female^stoneskin"
                            description=_"This unit is highly resistant to all forms of attack, but its hardened skin makes movement difficult."
                        [/dummy]
                    [/abilities]
                [/effect]
                [effect]
                    apply_to=resistance
                    replace=yes
                    [resistance]
                        blade=20
                        pierce=20
                        impact=20
                        fire=20
                        cold=20
                        arcane=80
                    [/resistance]
                [/effect]
                [effect]
                    apply_to=movement
                    set=2
                [/effect]
                [effect]
                    apply_to=movement_costs
                    replace=yes
                    [movement_costs]
                        shallow_water=2
                        reef=2
                        swamp_water=2
                        flat=1
                        sand=2
                        forest=2
                        hills=2
                        mountains=1
                        village=1
                        castle=1
                        cave=2
                        frozen=2
                        fungus=2
                    [/movement_costs]
                [/effect]
                [effect]
                    apply_to=defense
                    replace=yes
                    [defense]
                        shallow_water=90
                        reef=90
                        swamp_water=90
                        flat=80
                        sand=80
                        forest=70
                        hills=70
                        mountains=70
                        village=60
                        castle=60
                        cave=70
                        frozen=90
                        fungus=80
                    [/defense]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Potion of Feather"
            message="Potion of Feather: This potion causes the drinker to lose weight."
            market=3
            [object]
                name=_"Potion of Feather"
                image=icons/potion_green_medium.png
                description=_"This potion causes the drinker to lose weight."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        [dummy]
                            id=feather
                            name=_"feather"
                            female_name=_"female^feather"
                            description=_"This unit is lightweight, greatly reducing its movement costs over rough terrain."
                        [/dummy]
                    [/abilities]
                [/effect]
                [effect]
                    apply_to=movement_costs
                    replace=yes
                    [movement_costs]
                        shallow_water=1
                        reef=1
                        swamp_water=1
                        flat=1
                        sand=1
                        forest=1
                        hills=1
                        mountains=1
                        village=1
                        castle=1
                        cave=1
                        frozen=1
                        fungus=1
                    [/movement_costs]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Potion of Animal Nature"
            message="Potion of Animal Nature: This potion reveals the drinker's hidden animal nature."
            market=1
            [object]
                name=_"Potion of Animal Nature"
                image=icons/potion_green_medium.png
                description=_"This potion reveals the drinker's hidden animal nature."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        [dummy]
                            id=animal
                            name=_"animal"
                            female_name=_"female^animal"
                            description=_"This unit gains several powerful attacks, at the cost of his or her humanity."
                        [/dummy]
                    [/abilities]
                [/effect]
                [effect]
                    apply_to=status
                    add=feral
                [/effect]
                [effect]
                    apply_to=new_attack
                    name=claws
                    description=_"claws"
                    type=blade
                    range=melee
                    damage=14
                    number=2
                    icon="attacks/claws-animal.png"
                    [specials]
                        {WEAPON_SPECIAL_POISON}
                    [/specials]
                [/effect]
                [effect]
                    apply_to=new_attack
                    name=fangs
                    description=_"fangs"
                    type=blade
                    range=melee
                    damage=14
                    number=2
                    icon="attacks/fangs-animal.png"
                    [specials]
                        {WEAPON_SPECIAL_DRAIN}
                    [/specials]
                [/effect]
                [effect]
                    apply_to=new_animation
                    [attack_anim]
                        [filter_attack]
                            name=claws
                        [/filter_attack]
                        start_time=-200
                        offset=0~0.6:200,0.6~0:200
                        {SOUND:HIT_AND_MISS claws.ogg {SOUND_LIST:MISS} -100}
                    [/attack_anim]
                [/effect]
                [effect]
                    apply_to=new_animation
                    [attack_anim]
                        [filter_attack]
                            name=fangs
                        [/filter_attack]
                        start_time=-200
                        offset=0~0.6:200,0.6~0:200
                        {SOUND:HIT_AND_MISS bite-small.ogg {SOUND_LIST:MISS} -100}
                    [/attack_anim]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Staff of Plague"
            message="Staff of Plague: This staff grants a new melee plaguing impact attack."
            market=1
            [object]
                name=_"Staff of Plague"
                image=items/staff.png
                description=_"Grants a melee plaguing impact attack"
                [effect]
                    apply_to=new_attack
                    name=staff_of_plague
                    description=_"staff of plague"
                    icon=attacks/staff-plague.png
                    type=impact
                    range=melee
                    damage=6
                    number=3
                    [specials]
                        {WEAPON_SPECIAL_PLAGUE}
                    [/specials]
                [/effect]
                [effect]
                    apply_to=new_animation
                    [attack_anim]
                        [filter_attack]
                            name=staff_of_plague
                        [/filter_attack]
                        start_time=-200
                        offset=0~0.6:200,0.6~0:200
                        {SOUND:HIT_AND_MISS staff.ogg staff-miss.ogg -125}
                    [/attack_anim]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Sword of Flame"
            message="Sword of Flame: A blade constructed from pure fire."
            market=3
            [object]
                name=_"Sword of Flame"
                image=items/flame-sword.png
                description=_"A blade constructed from pure fire."
                [effect]
                    apply_to=new_attack
                    name=sword_of_flame
                    description=_"sword of flame"
                    type=fire
                    range=melee
                    damage=10
                    number=4
                    icon="attacks/longsword.png"
                [/effect]
                [effect]
                    apply_to=new_animation
                    [attack_anim]
                        [filter_attack]
                            name=sword_of_flame
                        [/filter_attack]
                        start_time=-200
                        offset=0~0.6:200,0.6~0:200
                        {SOUND:HIT_AND_MISS {SOUND_LIST:SWORD_SWISH} {SOUND_LIST:MISS} -100}
                    [/attack_anim]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Axe of Ice"
            message="Axe of Ice: A short-handled axe crafted from enchanted ice."
            market=3
            [object]
                name=_"Axe of Ice"
                image=items/axe.png
                description=_"A short-handled axe crafted from enchanted ice."
                [effect]
                    apply_to=new_attack
                    name=axe_of_ice
                    description=_"axe of ice"
                    type=cold
                    range=melee
                    damage=14
                    number=3
                    icon="attacks/battleaxe.png"
                [/effect]
                [effect]
                    apply_to=new_animation
                    [attack_anim]
                        [filter_attack]
                            name=axe_of_ice
                        [/filter_attack]
                        start_time=-200
                        offset=0~0.6:200,0.6~0:200
                        {SOUND:HIT_AND_MISS axe.ogg {SOUND_LIST:MISS} -50}
                    [/attack_anim]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Arcane Bow"
            message="Arcane Bow: A bow that fires bolts of magical energy."
            market=3
            [object]
                name=_"Arcane Bow"
                image=items/bow-crystal.png
                description=_"A bow that fires bolts of magical energy."
                [effect]
                    apply_to=new_attack
                    name=arcane_bow
                    description=_"arcane bow"
                    type=arcane
                    range=ranged
                    damage=9
                    number=3
                    [specials]
                        {WEAPON_SPECIAL_MAGICAL}
                    [/specials]
                    icon="attacks/bow-elven-magic.png"
                [/effect]
                [effect]
                    apply_to=new_animation
                    [attack_anim]
                        [filter_attack]
                            name=arcane_bow
                        [/filter_attack]
                        start_time=-250
                        missile_start_time=-150

                        [missile_frame]
                            duration=150
                            image="projectiles/missile-n.png"
                            image_diagonal="projectiles/missile-ne.png"
                        [/missile_frame]

                        {SOUND:HIT_AND_MISS bow-puny.ogg bow-puny-miss.ogg -225}
                    [/attack_anim]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Marksman Bow"
            message="Marksman Bow: A bow that fires bolts with high accuracy."
            market=3
            [object]
                name=_"Marksman Bow"
                image=items/bow-elven.png
                description=_"A bow that fires bolts with high accuracy."
                [effect]
                    apply_to=new_attack
                    name=marksman_bow
                    description=_"marksman bow"
                    type=pierce
                    range=ranged
                    damage=9
                    number=3
                    [specials]
                        {WEAPON_SPECIAL_MARKSMAN}
                    [/specials]
                    icon="attacks/bow-elven.png"
                [/effect]
                [effect]
                    apply_to=new_animation
                    [attack_anim]
                        [filter_attack]
                            name=marksman_bow
                        [/filter_attack]
                        start_time=-250
                        missile_start_time=-150

                        [missile_frame]
                            duration=150
                            image="projectiles/missile-n.png"
                            image_diagonal="projectiles/missile-ne.png"
                        [/missile_frame]

                        {SOUND:HIT_AND_MISS bow-puny.ogg bow-puny-miss.ogg -225}
                    [/attack_anim]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Fire Bow"
            message="Fire Bow: A bow that fires bolts of fire energy."
            market=3
            [object]
                name=_"Fire Bow"
                image=items/bow-crystal.png
                description=_"A bow that fires bolts of fire energy."
                [effect]
                    apply_to=new_attack
                    name=fire_bow
                    description=_"fire bow"
                    type=fire
                    range=ranged
                    damage=9
                    number=3
                    [specials]
                        {WEAPON_SPECIAL_MAGICAL}
                    [/specials]
                    icon="attacks/bow-elven-magic.png"
                [/effect]
                [effect]
                    apply_to=new_animation
                    [attack_anim]
                        [filter_attack]
                            name=fire_bow
                        [/filter_attack]
                        start_time=-250
                        missile_start_time=-150

                        [missile_frame]
                            duration=150
                            image="projectiles/missile-n.png"
                            image_diagonal="projectiles/missile-ne.png"
                        [/missile_frame]

                        {SOUND:HIT_AND_MISS bow-puny.ogg bow-puny-miss.ogg -225}
                    [/attack_anim]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Cold Bow"
            message="Cold Bow: A bow that fires bolts of cold energy."
            market=3
            [object]
                name=_"Cold Bow"
                image=items/bow-crystal.png
                description=_"A bow that colds bolts of cold energy."
                [effect]
                    apply_to=new_attack
                    name=cold_bow
                    description=_"cold bow"
                    type=cold
                    range=ranged
                    damage=9
                    number=3
                    [specials]
                        {WEAPON_SPECIAL_MAGICAL}
                    [/specials]
                    icon="attacks/bow-elven-magic.png"
                [/effect]
                [effect]
                    apply_to=new_animation
                    [attack_anim]
                        [filter_attack]
                            name=cold_bow
                        [/filter_attack]
                        start_time=-250
                        missile_start_time=-150

                        [missile_frame]
                            duration=150
                            image="projectiles/missile-n.png"
                            image_diagonal="projectiles/missile-ne.png"
                        [/missile_frame]

                        {SOUND:HIT_AND_MISS bow-puny.ogg bow-puny-miss.ogg -225}
                    [/attack_anim]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Arcane Sword"
            message="Arcane Sword: A blade with magical energy."
            market=3
            [object]
                name=_"Arcane Sword"
                image=items/sword.png
                description=_"A blade with magical energy."
                [effect]
                    apply_to=new_attack
                    name=arcane_sword
                    description=_"arcane sword"
                    type=arcane
                    range=melee
                    damage=10
                    number=4
                    [specials]
                        {WEAPON_SPECIAL_MAGICAL}
                    [/specials]
                    icon="attacks/sword-holy.png"
                [/effect]
                [effect]
                    apply_to=new_animation
                    [attack_anim]
                        [filter_attack]
                            name=arcane_sword
                        [/filter_attack]
                        start_time=-200
                        offset=0~0.6:200,0.6~0:200
                        {SOUND:HIT_AND_MISS {SOUND_LIST:SWORD_SWISH} {SOUND_LIST:MISS} -100}
                    [/attack_anim]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Holy Water"
            message="Holy Water: Sprinkling this water on melee weapons grants them the <i>arcane</i> damage type."
            market=3
            [object]
                name=_"Holy Water"
                image=items/holy-water.png
                description=_"Sprinkling this water on melee weapons grants them the <i>arcane</i> damage type."
                [effect]
                    apply_to=attack
                    range=melee
                    set_type=arcane
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Sceptre of Fire"
            message="Sceptre of Fire: This sceptre grants a new ranged fire attack."
            market=1
            [object]
                name=_"Sceptre of Fire"
                image=items/sceptre-of-fire.png
                description=_"Grants a ranged fire attack"
                {SCEPTRE_OF_FIRE_EFFECT}
            [/object]
        [/literal]
        [literal]
            name="Orb of Steadfast"
            message="Orb of Steadfast: This orb doubles the resistance, up to a maximum of 50%, when defending."
            market=1
            [object]
                name=_"Orb of Steadfast"
                image=items/ball-magenta.png
                description=_"This orb doubles the resistance, up to a maximum of 50%, when defending."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_STEADFAST}
                    [/abilities]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Orb of Teleport"
            message="Orb of Teleport: This orb teleports the carrier between any two empty villages."
            market=1
            [object]
                name=_"Orb of Teleport"
                image=items/ball-magenta.png
                description=_"This orb teleports the carrier between any two empty villages."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_TELEPORT}
                    [/abilities]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="The Prince"
            message="The Prince: This modifier grants the backstab special to melee blade attacks."
            market=1
            [object]
                name=_"The Prince"
                image=items/book4.png
                description=_"This modifier grants the backstab special to melee blade attacks."
                [effect]
                    apply_to=attack
                    range=melee
                    type=blade
                    [set_specials]
                        mode=append
                        {WEAPON_SPECIAL_BACKSTAB}
                    [/set_specials]
                [/effect]
            [/object]
        [/literal]
        [literal]
            name="Ogre Perfume"
            message="Ogre Perfume: This scent will attract Ogres."
            market=3
            [object]
                name=_"Ogre Perfume"
                image=icons/potion_green_medium.png
                description=_"This scent will attract Ogres."
                [effect]
                    apply_to=new_ability
                    [abilities]
                        [dummy]
                            id=stench
                            name=_"ogre stench"
                            female_name=_"female^ogre stench"
                            description=_"This unit smells bad."
                        [/dummy]
                    [/abilities]
                [/effect]
                [effect]
                    apply_to=status
                    add=feral
                [/effect]
            [/object]
        [/literal]
    [/set_variables]
#enddef

#define WF_MARKET_ITEMS_INDEX
    [for]
        array=wf_market_items
        [do]
            {VARIABLE wf_market_items[$i].index $i}
        [/do]
    [/for]
#enddef

#define WF_MARKET_ITEMS_APPEND VAR INDEX
    [set_variables]
        name={VAR}
        mode=append
        to_variable=wf_market_items[{INDEX}]
    [/set_variables]
#enddef

#define WF_MARKET_ITEMS_APPEND_MARKET VAR MARKET
    [for]
        array=wf_market_items
        [do]
            [if]
                {VARIABLE_CONDITIONAL wf_market_items[$i].market numerical_equals {MARKET}}
                [then]
                    {VARIABLE wf_market_items[$i].index $i}
                    {WF_MARKET_ITEMS_APPEND {VAR} $i}
                [/then]
            [/if]
        [/do]
    [/for]
#enddef

#define WF_MARKET_ITEMS_RANDOM_INDEX VAR INDEX LABEL
    {RANDOM_VAR rnd_mi 0.."$(${VAR}.length-1)"}
    {VARIABLE {INDEX} ${VAR}[$rnd_mi].index}
    {VARIABLE {LABEL} ${VAR}[$rnd_mi].name}
    {CLEAR_VARIABLE ${VAR}[$rnd_mi]}
    {CLEAR_VARIABLE rnd_mi}
#enddef
