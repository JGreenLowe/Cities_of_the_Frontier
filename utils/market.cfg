#textdomain wesnoth-Wild_Frontiers

#define MARKET_MOVETO
	[event]
		name=moveto
		id=moveto_market
		first_time_only=no
		#delayed_variable_substitution=no
		[filter]
			side=9
			type=Caravan
			[filter_location]
				terrain=*^Wm
			[/filter_location]
		[/filter]
		[fire_event]
			name=wf_market
			[primary_unit]
				x=$unit.x
				y=$unit.y
			[/primary_unit]
			[secondary_unit]
				x=$x2
				y=$y2
			[/secondary_unit]
			[primary_attack]
				action="sale"
				x=$x1
				y=$y1
			[/primary_attack]
		[/fire_event]
		[message]
			speaker=unit
			message=_"May we interest you in the $quota.rnd_sale|, milord."
		[/message]
		[kill]
			side=9
			animate=no
			id=$unit.id
			fire_event=no
		[/kill]
	[/event]
#enddef

#define GOTO_CARAVAN
	side=9
	ai_type=goto
	ca_id=goto_caravan
	[filter]
		side=9
		type=Caravan
	[/filter]
	[filter_location]
		terrain=*^Wm
	[/filter_location]
	avoid_enemies=1
#enddef

#define MARKET_CARAVAN SEASON
	[event]
		name=prestart
		[micro_ai]
			action=add
			{GOTO_CARAVAN}
		[/micro_ai]
	[/event]

	{MARKET_MOVETO}

	[event]
		name=side 9 turn 1 end
		id=spawn_market_caravan
		first_time_only=yes
		[filter_condition]
			[have_location]
				terrain=*^Wm
				count=1
			[/have_location]
			[have_unit]
				side=9
				type=Caravan
				search_recall_list=no
				count=0
			[/have_unit]
		[/filter_condition]

		{RANDOM_VAR rnd_dir 0,1,2,3}	# 0=east, 1=north, 2=west, 3=south
		{FIND_NEAREST_HEX market_start $map_signs[$rnd_dir].x $map_signs[$rnd_dir].y (
			{NOT_FILTER}
			terrain=!,W*,*^Y*,*^V*,K*,C*
		) }

		[unit]
			side=9
			type=Caravan
			canrecruit=no
			x=$market_start.x
			y=$market_start.y
			placement=map
			passable=yes
			random_traits=yes
			name=Import Goods
			role=market_caravan
			{OBJECT_LOYAL}
			to_variable=market_unit
		[/unit]
		[unstore_unit]
			variable=market_unit
			find_vacant=yes
			check_passability=yes
			animate=yes
			text=Import Goods
			# fire_event=yes
		[/unstore_unit]
		[scroll_to_unit]
			id=$market_unit.id
			check_fogged=no
			highlight=yes
		[/scroll_to_unit]
		[message]
			speaker=$market_unit.id
			message=_"Pray grant us safe passage to your windmill, milord. For our cargo carries the finest imports."
		[/message]
		{CLEAR_VARIABLE market_unit}
		{CLEAR_VARIABLE rnd_dir}
	[/event]

	[event]
		name=wf_market
		first_time_only=no
		delayed_variable_substitution=no

		[remove_event]
			id=moveto_sale_item
		[/remove_event]
		[remove_item]
			x,y=$weapon.x,$weapon.y
			image=items/chest.png
		[/remove_item]
		[item]
			x,y=$weapon.x,$weapon.y
			image=items/chest.png
		[/item]

		{RANDOM_VAR quota.rnd_cost "70..80"}

		# Effects lifted from: Heroes
		{RANDOM_VAR quota.rnd_sale "Ring of Swiftness,Iron boots,Staff of Horror,Heart of the Wose,Flaming Sword,Armor of Regeneration,Armor of the Thane,Winged Circlet,Fire arrows,Eye of the Dragon,Green Cloak,Notes of War XI,Buckler,Giant Spear,Iron Armor,Chain Armor,Leather Armor,Breastplate,Longsword,Bidhander,Spear of the Gobo,Staff of Alduin,Staff of Freezing Death,Storm Trident,Bow,A stone,Crystal Bow,Elven Bow,Axe of the Centaur,Lixandryl"}

		[event]
			name=moveto
			id=moveto_sale_item
			first_time_only=no
			delayed_variable_substitution=no
			[filter]
				side=1
				x,y=$weapon.x,$weapon.y
			[/filter]

	# Sale item description cases {
	[switch]
		variable=quota.rnd_sale
	[case]
		value="Ring of Swiftness"
		[message]
			speaker=unit
			message=_"Ring of Swiftness: This ring grants +1 movement point."
		[/message]
	[/case]
	[case]
		value="Iron boots"
		[message]
			speaker=unit
			message=_"Iron boots: These boots grants +1 movement point."
		[/message]
	[/case]
	[case]
		value="Staff of Horror"
		[message]
			speaker=unit
			message=_"Staff of Horror: Saps the life energy of nearby enemy and decreases their damage by 25%"
		[/message]
	[/case]
	[case]
		value="Heart of the Wose"
		[message]
			speaker=unit
			message=_"Heart of the Wose: This item grants +8 regeneration ability."
		[/message]
	[/case]
	[case]
		value="Flaming Sword"
		[message]
			speaker=unit
			message=_"Flaming Sword: This modifier grants fire attack type to melee attacks."
		[/message]
	[/case]
	[case]
		value="Armor of Regeneration"
		[message]
			speaker=unit
			message=_"Armor of Regeneration: This golden armor grants a +8 regeneration ability."
		[/message]
	[/case]
	[case]
		value="Armor of the Thane"
		[message]
			speaker=unit
			message=_"Armor of the Thane: Inspires nearby units to increase the damage by +25"
		[/message]
	[/case]
	[case]
		value="Winged Circlet"
		[message]
			speaker=unit
			message=_"Winged Circlet: The bearer of the Winged Circlet needs 25% less experience to advance."
		[/message]
	[/case]
	[case]
		value="Fire arrows"
		[message]
			speaker=unit
			message=_"Fire arrows: This modifier grants a fire attack type to ranged attacks."
		[/message]
	[/case]
	[case]
		value="Eye of the Dragon"
		[message]
			speaker=unit
			message=_"Eye of the Dragon: Grants another attack per turn."
		[/message]
	[/case]
	[case]
		value="Green Cloak"
		[message]
			speaker=unit
			message=_"Green Cloak: This cloak grants the nightstalk ability."
		[/message]
	[/case]
	[case]
		value="Notes of War XI"
		[message]
			speaker=unit
			message=_"Notes of War XI: This book grants the leadership ability."
		[/message]
	[/case]
	[case]
		value="Buckler"
		[message]
			speaker=unit
			message=_"Buckler: Wearing the buckler grants +15 hitpoints."
		[/message]
	[/case]
	[case]
		value="Giant Spear"
		[message]
			speaker=unit
			message=_"Giant Spear: This modifier will increase the units pierce damage by +5."
		[/message]
	[/case]
	[case]
		value="Iron Armor"
		[message]
			speaker=unit
			message=_"Iron Armor: This armor grants +20 hitpoints"
		[/message]
	[/case]
	[case]
		value="Chain Armor"
		[message]
			speaker=unit
			message=_"Chain Armor: This armor increases the attack parry bonus by 10%"
		[/message]
	[/case]
	[case]
		value="Leather Armor"
		[message]
			speaker=unit
			message=_"Leather Armor: This armor grants +10 hitpoints"
		[/message]
	[/case]
	[case]
		value="Breastplate"
		[message]
			speaker=unit
			message=_"Breastplate: This item grants +30 hitpoints"
		[/message]
	[/case]
	[case]
		value="Longsword"
		[message]
			speaker=unit
			message=_"Longsword: This modifier increases the damage of blade type attacks by +2"
		[/message]
	[/case]
	[case]
		value="Bidhander"
		[message]
			speaker=unit
			message=_"Bidhander: This modifier increases the damage of blade type attacks by +3"
		[/message]
	[/case]
	[case]
		value="Spear of the Gobo"
		[message]
			speaker=unit
			message=_"Spear of the Gobo: This modifier increases the damage of pierce type attacks by +1 and grants the leadership ability."
		[/message]
	[/case]
	[case]
		value="Staff of Alduin"
		[message]
			speaker=unit
			message=_"Staff of Alduin: This modifier increases the damage of arcane type attacks by +2."
		[/message]
	[/case]
	[case]
		value="Staff of Freezing Death"
		[message]
			speaker=unit
			message=_"Staff of Freezing Death: This staff grants a new ranged slowing cold attack"
		[/message]
	[/case]
	[case]
		value="Storm Trident"
		[message]
			speaker=unit
			message=_"Storm Trident: This trident grants a new ranged fire attack"
		[/message]
	[/case]
	[case]
		value="Bow"
		[message]
			speaker=unit
			message=_"Bow: This modifier increases the damage of pierce type attacks by +2."
		[/message]
	[/case]
	[case]
		value="A stone"
		[message]
			speaker=unit
			message=_"A stone: The stone tablet grants the heal and regeneration ability.."
		[/message]
	[/case]
	[case]
		value="Crystal Bow"
		[message]
			speaker=unit
			message=_"Crystal Bow: This modifier increases the damage of pierce type attacks by +2 and grants the slow special."
		[/message]
	[/case]
	[case]
		value="Elven Bow"
		[message]
			speaker=unit
			message=_"Elven Bow: This modifier increases the damage of pierce type attacks by +4 and grants the marksman special."
		[/message]
	[/case]
	[case]
		value="Axe of the Centaur"
		[message]
			speaker=unit
			message=_"Axe of the Centaur: This modifier increases the damage of blade type attacks by +4 and grants +15 hitpoints."
		[/message]
	[/case]
	[case]
		value="Lixandryl"
		[message]
			speaker=unit
			message=_"Lixandryl: This modifier increases the damage of the bearer by +2, the number of attacks by +1 and sets the attack type to cold."
		[/message]
	[/case]
	[else]
		[message]
			speaker=unit
			message=_"Some gold."
		[/message]
	[/else]
	[/switch]
	# End Sale item description cases }

			[message]
				speaker=unit
				message=_"Buy $quota.rnd_sale| for $quota.rnd_cost| gold?"
				[option]
					label=_"Yes"
					[command]
						{VARIABLE_OP $quota.rnd_cost multiply -1}
						[gold]
							side=1
							amount=$quota.rnd_cost
						[/gold]
						[sound]
							name=gold.ogg
						[/sound]
						[switch]
							variable=quota.rnd_sale
	# Sale item cases {
	[case]
		value="Ring of Swiftness"
		[object]
			name=_"Ring of Swiftness"
			image=items/ring-gold.png
			description=_"This ring grants +1 movement point."
			[effect]
				apply_to=movement
				increase=1
			[/effect]
		[/object]
	[/case]
	[case]
		value="Iron boots"
		[object]
			name=_"Iron boots"
			image=icons/boots_elven.png
			description=_"These boots grants +1 movement point."
			[effect]
				apply_to=movement
				increase=1
			[/effect]
		[/object]
	[/case]
	[case]
		value="Staff of Horror"
		[object]
			name=_"Staff of Horror"
			image=items/staff.png
			description=_"Decreases the damage of nearby enemy units by 25%"
		[effect]
			apply_to=new_ability
			[abilities]
				[leadership]
					id=magic sap
					value=-25
					cumulative=no
					name= _ "magic sap"
					female_name= _ "female^magic sap"
					description= _ "This unit saps the life energy of nearby enemy units and decreases their damage by 25%."
					affect_self=no
					affect_enemies=yes
					affect_allies=no
					[affect_adjacent]
						[filter]
						[/filter]
					[/affect_adjacent]
				[/leadership]
			[/abilities]
		[/effect]
		[/object]
	[/case]
	[case]
		value="Heart of the Wose"
		[object]
			name=_"Heart of the Wose"
			image=items/ball-green.png
			description=_"The Heart of the Wose grants the +8 regeneration ability."
         [effect]
             apply_to=new_ability
             [abilities]
               {ABILITY_REGENERATES}
             [/abilities]
         [/effect]
		[/object]
	[/case]
	[case]
		value="Flaming Sword"
		[object]
			name=_"Flaming Sword"
			image=items/flame-sword.png
			description=_"This sword grants a fire attack type."
		[effect]
			apply_to=attack
			range=melee
			type=blade
			set_type=fire
			set_description=flaming sword
		[/effect]
		[effect]
			apply_to=halo
			halo=scenery/flames01.png:110,scenery/flames02.png:110,scenery/flames03.png:110,scenery/flames04.png:110,scenery/flames05.png:110,scenery/flames06.png:110,scenery/flames07.png:110,scenery/flames08.png:110,scenery/flames09.png:110,scenery/flames10.png:110,scenery/flames11.png:110,scenery/flames12.png:110,scenery/flames13.png:110,scenery/flames14.png:110,scenery/flames15.png:110
		[/effect]
		[/object]
	[/case]
	[case]
		value="Armor of Regeneration"
		[object]
			name=_"Armor of Regeneration"
			image=items/armor-golden.png
			description=_"This golden armor grants a +8 regeneration ability."
		[effect]
			apply_to=new_ability
			[abilities]
				{ABILITY_REGENERATES}
			[/abilities]
		[/effect]
		[effect]
			apply_to=halo
			halo=halo/elven/elven-shield-halo-100pct.png
		[/effect]
		[/object]
	[/case]
	[case]
		value="Armor of the Thane"
		[object]
			name=_"Armor of the Thane"
			image=items/armor-golden.png
			description=_"Increases the damage of nearby units by +25"
		[effect]
			apply_to=new_ability
			[abilities]
				[leadership]
					id=inspire
					value=25
					cumulative=no
					name= _ "inspire"
					description= _ "This unit can inspire our own units that are next to it, making them fight better.

			Adjacent own units of will do more damage in battle. When a unit adjacent to a unit with Inspire engages in combat, its attacks do 25% more damage."
					affect_self=no
					affect_enemies=no
					affect_allies=yes
					[affect_adjacent]
						[filter]
						[/filter]
					[/affect_adjacent]
				[/leadership]
			[/abilities]
		[/effect]
		[effect]
			apply_to=halo
			halo=halo/elven/elven-shield-halo-100pct.png
		[/effect]
		[/object]
	[/case]
	[case]
		value="Winged Circlet"
		[object]
			name=_"Winged Circlet"
			image=icons/circlet_winged.png
			description=_"The bearer of the Winged Circlet needs 25% less experience to advance."
		[effect]
			apply_to=max_experience
			increase=-25%
		[/effect]
		[/object]
	[/case]
	[case]
		value="Fire arrows"
		[object]
			name=_"Fire arrows"
			image=attacks/fireball.png
			description=_"Grants a fire attack type to ranged attacks."
		[effect]
			apply_to=attack
			range=ranged
			set_type=fire
		[/effect]
		[/object]
	[/case]
	[case]
		value="Eye of the Dragon"
		[object]
			name=_"Eye of the Dragon"
			image=items/ball-blue.png
			description=_"Grants another attack per turn."
		[effect]
			apply_to=max_attacks
			increase=1
		[/effect]
		[/object]
	[/case]
	[case]
		value="Green Cloak"
		[object]
			name=_"Green Cloak"
			image=items/cloak-green.png
			description=_"This cloak grants the nightstalk ability."
		[effect]
			apply_to=new_ability
			[abilities]
				{ABILITY_NIGHTSTALK}
			[/abilities]
		[/effect]
		[/object]
	[/case]
	[case]
		value="Notes of War XI"
		[object]
			name=_"Notes of War XI"
			image=items/book4.png
			description=_"This book grants the leadership ability."
		[effect]
			apply_to=new_ability
			[abilities]
				{ABILITY_LEADERSHIP}
			[/abilities]
		[/effect]
		[/object]
	[/case]
	[case]
		value="Buckler"
		[object]
			name=_"Buckler"
			image=icons/shield_steel.png
			description=_"Wearing the buckler grants +15 hitpoints."
		[effect]
			apply_to=hitpoints
			increase_total=15
			heal_full=yes
		[/effect]
		[/object]
	[/case]
	[case]
		value="Giant Spear"
		[object]
			name=_"Giant Spear"
			image=items/spear-fancy.png
			description=_"Wearing this giant spear in battle will increase the units damage by +5."
		[effect]
			apply_to=attack
			type=pierce
			increase_damage=5
			set_description=giant spear
		[/effect]
		[/object]
	[/case]
	[case]
		value="Iron Armor"
		[object]
			name=_"Iron Armor"
			image=items/armor.png
			description=_"Grant +20 hitpoints"
		[effect]
			apply_to=hitpoints
			increase_total=+20
			heal_full=yes
		[/effect]
		[/object]
	[/case]
	[case]
		value="Chain Armor"
		[object]
			name=_"Chain Armor"
			image=icons/armor-chain.png
			description=_"Increases the attack parry bonus by 10%"
		[effect]
			apply_to=attack
			increase_parry=10
		[/effect]
		[/object]
	[/case]
	[case]
		value="Leather Armor"
		[object]
			name=_"Leather Armor"
			image=icons/armor_leather.png
			description=_"Grants +10 hitpoints"
		[effect]
			apply_to=hitpoints
			increase_total=+10
			heal_full=yes
		[/effect]
		[/object]
	[/case]
	[case]
		value="Breastplate"
		[object]
			name=_"Breastplate"
			image=icons/breastplate.png
			description=_"Grants +30 hitpoints"
		[effect]
			apply_to=hitpoints
			increase_total=+30
			heal_full=yes
		[/effect]
		[/object]
	[/case]
	[case]
		value="Longsword"
		[object]
			name=_"Longsword"
			image=items/sword.png
			description=_"Increases the attack damage of blade type attacks by +2"
		[effect]
			apply_to=attack
			type=blade
			increase_damage=+2
		[/effect]
		[/object]
	[/case]
	[case]
		value="Bidhander"
		[object]
			name=_"Bidhander"
			image=items/sword.png
			description=_"Increases the attack damage of blade type attacks by +3"
		[effect]
			apply_to=attack
			type=blade
			increase_damage=+3
		[/effect]
		[/object]
	[/case]
	[case]
		value="Spear of the Gobo"
		[object]
			name=_"Spear of the Gobo"
			image=items/spear-fancy.png
			description=_"Increases the attack damage of pierce type attacks by +1 and grants the leadership ability."
		[effect]
			apply_to=attack
			type=pierce
			increase_damage=+1
		[/effect]
		[effect]
			apply_to=new_ability
			[abilities]
				{ABILITY_LEADERSHIP}
			[/abilities]
		[/effect]
		[/object]
	[/case]
	[case]
		value="Staff of Alduin"
		[object]
			name=_"Staff of Alduin"
			image=items/staff.png
			description=_"Increases the attack damage of arcane type attacks by +2."
		[effect]
			apply_to=attack
			type=arcane
			increase_damage=+1
		[/effect]
		[/object]
	[/case]
	[case]
		value="Staff of Freezing Death"
		[object]
			name=_"Staff of Freezing Death"
			image=items/staff-magic.png
			description=_"Grants a ranged slowing cold attack"
		[effect]
			apply_to=new_attack
			name=Staff of Freezing Death
			description=_"Staff of Freezing Death"
			type=cold
			damage=8
			number=3
			range=ranged
			[specials]
				{WEAPON_SPECIAL_SLOW}
			[/specials]
			icon=attacks/staff-magic.png
		[/effect]
		[/object]
	[/case]
	[case]
		value="Storm Trident"
		[object]
			name=_"Storm Trident"
			image=items/storm-trident.png
			description=_"Grants a ranged fire attack"
		[effect]
			apply_to=new_attack
			name=Strom Trident
			description=_"Storm Trident"
			type=fire
			damage=11
			number=3
			range=ranged
			[specials]
				{WEAPON_SPECIAL_MAGICAL}
			[/specials]
			icon=attacks/trident.png
		[/effect]
		[/object]
	[/case]
	[case]
		value="Bow"
		[object]
			name=_"Bow"
			image=items/bow.png
			description=_"Increases the attack damage of pierce type attacks by +2."
		[effect]
			apply_to=attack
			type=pierce
			increase_damage=+1
		[/effect]
		[/object]
	[/case]
	[case]
		value="A stone"
		[object]
			name=_"A stone"
			image=items/stone-tablet.png
			description=_"The stone grants the heal and regeneration ability.."
		[effect]
			apply_to=halo
			halo=halo/elven/elven-shield-halo-100pct.png
		[/effect]
		[effect]
			apply_to=new_ability
			[abilities]
				{ABILITY_REGENERATES}
				{ABILITY_HEALS}
			[/abilities]
		[/effect]
		[/object]
	[/case]
	[case]
		value="Crystal Bow"
		[object]
			name=_"Crystal Bow"
			image=items/bow-crystal.png
			description=_"Increases the attack damage of pierce type attacks by +2 and grants the slow special."
		[effect]
			apply_to=attack
			type=pierce
			increase_damage=+2
			[set_specials]
				mode=append
				{WEAPON_SPECIAL_SLOW}
			[/set_specials]
		[/effect]
		[/object]
	[/case]
	[case]
		value="Elven Bow"
		[object]
			name=_"Elven Bow"
			image=items/bow-elven.png
			description=_"Increases the attack damage of pierce type attacks by +4 and grants the marksman special."
		[effect]
			apply_to=attack
			type=pierce
			increase_damage=+4
		[/effect]
		[effect]
			apply_to=attack
			range=ranged
			[set_specials]
				mode=append
				{WEAPON_SPECIAL_MARKSMAN}
			[/set_specials]
		[/effect]
		[/object]
	[/case]
	[case]
		value="Axe of the Centaur"
		[object]
			name=_"Axe of the Centaur"
			image=items/axe.png
			description=_"Increases the attack damage of blade type attacks by +4 and grants +15 hitpoints."
		[effect]
			apply_to=attack
			type=blade
			increase_damage=+4
		[/effect]
		[effect]
			apply_to=hitpoints
			increase_total=+15
			heal_full=yes
		[/effect]
		[/object]
	[/case]
	[case]
		value="Lixandryl"
		[object]
			name=_"Lixandryl"
			image=items/sceptre-of-fire.png
			description=_"This mighty sword houses a genie, increases the damage of the bearer by +2, the number of attacks by +1 and sets the attack type to cold."
		[effect]
			apply_to=attack
			type=blade
			increase_damage=2
			increase_attacks=1
			set_description=lixandryl
			set_type=cold
		[/effect]
		[effect]
			apply_to=halo
			halo=scenery/flames01.png:110,scenery/flames02.png:110,scenery/flames03.png:110,scenery/flames04.png:110,scenery/flames05.png:110,scenery/flames06.png:110,scenery/flames07.png:110,scenery/flames08.png:110,scenery/flames09.png:110,scenery/flames10.png:110,scenery/flames11.png:110,scenery/flames12.png:110,scenery/flames13.png:110,scenery/flames14.png:110,scenery/flames15.png:110
		[/effect]
		[/object]
	[/case]
	# End Sale item cases }
							[else]
								{LOOT 50 1}
							[/else]
						[/switch]
						[remove_item]
							x,y=$weapon.x,$weapon.y
							image=items/chest.png
						[/remove_item]
						[remove_event]
							id=moveto_sale_item
						[/remove_event]
						{CLEAR_VARIABLE quota.rnd_sale}
						{CLEAR_VARIABLE quota.rnd_cost}
					[/command]
				[/option]
				[option]
					label=_"No"
					[command]
					[/command]
				[/option]
			[/message]
		[/event]
	[/event]
#enddef
