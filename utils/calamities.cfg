#textdomain wesnoth-Wild_Frontiers
# ----- Calamities! -----
# Calamities are intended to be once-a-year'ish challenges, timing still TBD
# There are several calamity types; which type is selected in the spring (see scenario .cfg file)

# Individual calamity types are separated into their own macros for ease of testing, not because they
# are actually re-used anywhere

#define CALAMITIES_MAY_OCCUR
	{WF_FETCH_NEXT_CALAMITY_EVENT}
	[event]	# this is an event to create the other events
		name=prestart

		[if]
			[and]
			# {VARIABLE_CONDITIONAL season greater_than 1}
			{VARIABLE_CONDITIONAL relations.calamity_type equals "none"}
			{VARIABLE_CONDITIONAL season_str equals "summer"}
			[/and]
		[then]
		# Choose a new calamity for this year
			{WF_FETCH_NEXT_CALAMITY}
		[/then]
		[/if]

		[switch]
			variable=relations.calamity_type
			[case] # ----- Lich ------------------------------------------
				value="lich"
				{CALAMITY_LICH 10}
				# This is hard, no calamity in the winter
				{VARIABLE relations.calamity_type "skip"}
			[/case]
			[case] # ----- Gryphons --------------------------------------
				value="gryphons"
				{CALAMITY_GRYPHONS 10}
				# This is easier, eventually may add a winter calamity
				{RANDOM_VAR relations.calamity_type ("skip","yetis","yetis")}
			[/case]
			[case] # ----- Loyalists -------------------------------------
				value="loyalists"
				{CALAMITY_LOYALISTS 10}
				# This is hard, no calamity in the winter
				{VARIABLE relations.calamity_type "skip"}
			[/case]
			[case] # ----- Saurians --------------------------------------
				value="saurians"
				{CALAMITY_SAURIANS 10}
				# This is easier, may eventually add a winter calamity
				{RANDOM_VAR relations.calamity_type ("skip","skip","yetis")}
			[/case]
			[case] # ----- Drakes ----------------------------------------
				value="drakes"
				{CALAMITY_DRAKES 10}
				# This is hard, no calamity in the winter
				{VARIABLE relations.calamity_type "skip"}
			[/case]
			[case] # ----- Dwarves ---------------------------------------
				value="dwarves"
				{CALAMITY_DWARVES 10}
				# This is hard, no calamity in the winter
				{VARIABLE relations.calamity_type "skip"}
			[/case]
			[case] # ----- Orcs ---------------------------------------
				value="orcs"
				{CALAMITY_ORCS 10}
				# This is hard, no calamity in the winter
				{VARIABLE relations.calamity_type "skip"}
			[/case]
			[case] # ----- Yetis -----------------------------------------
				value="yetis"
				{CALAMITY_YETIS 10}
				# This is easier, may eventually add a winter calamity
				{RANDOM_VAR relations.calamity_type ("skip","none","none")}
			[/case]
			[else] # ----- Skip ------------------------------------------
				[if]
					{VARIABLE_CONDITIONAL season greater_than 1}
				[then]
					{VARIABLE relations.calamity_type "none"}
				[/then]
				[/if]
				[event]
					name=turn 10
					{WF_DEBUG "Skipping calamity"}
				[/event]
			[/else]
		[/switch]
	[/event]
#enddef

# ----- Lich w/ random undead --------------------------------------------
#define CALAMITY_LICH TURN
	[event]
		name=turn {TURN}
		{WF_DEBUG "Creating a lich calamity n: $enemy.num_outlaws"}
		{RANDOM_VAR rnd_dir 0,2,3}	# west or south edge, or east (swamp of dread)
		[store_locations]
			variable=undead_places
			terrain=!,W*,*^Y*,*^V*,K*,C*
			{X_AND_Y_ARE_ON_THE_MAP}
			{NOT_FILTER}
			[and]	# appears near the signpost
				x=$map_signs[$rnd_dir].x
				y=$map_signs[$rnd_dir].y
				radius={BORDER}
			[/and]
		[/store_locations]
		{RANDOM_VAR rnd_i 0.."$($undead_places.length-1)"}
		[unit]
			side=8
			type="Lich"
			role=lich
			x=$undead_places[$rnd_i].x
			y=$undead_places[$rnd_i].y
			generate_name=yes
			random_traits=yes
			canrecruit=no
			placement=map
			passable=yes
			animate=yes
			{OBJECT_LOYAL}
			{IS_HERO}
		[/unit]
		{REPEAT $enemy.num_outlaws (
			{RANDOM_VAR rnd_type ("Shadow","Wraith","Necrophage","Deathblade","Revenant","Bone Shooter","Chocobone","Death Knight","Nightgaunt","Spectre","Ghast","Draug","Banebow")}
			[unit]
				side=8
				type=$rnd_type
				canrecruit=no
				generate_name=yes
				random_traits=yes
				random_gender=yes
				x,y=$undead_places[$rnd_i].x,$undead_places[$rnd_i].y
				placement=map
				passable=yes
				animate=yes
				{OBJECT_LOYAL}
				overlays="misc/loyal-icon.png"
			[/unit] )}
		# Now he "recruits" his army
		{COUNT_VILLAGES num_villages}
		{VARIABLE undead_gold "$(ceil($enemy.raid_mult * ($enemy.raid_base_gold + $enemy.raid_gold_mult*$num_villages)))"}
		#{VARIABLE_OP undead_gold multiply 2}
		{WF_DEBUG "Lich fake recruit gold set to $undead_gold"}
		[set_variables]
			name=undead_list
			mode=replace
			{VALUE2 type "Dark Adept" cost 16}
			{VALUE2 type "Ghost" cost 20}
			{VALUE2 type "Ghoul" cost 16}
			{VALUE2 type "Skeleton" cost 15}
			{VALUE2 type "Skeleton Archer" cost 14}
			{VALUE2 type "Walking Corpse" cost 8}	# walking corpses should appear slightly more often
			{VALUE2 type "Walking Corpse" cost 8}
			{VALUE2 type "Soulless" cost 13}
		[/set_variables]
		[while]
			{VARIABLE_CONDITIONAL undead_gold greater_than 0}	# will go *roughly* to zero
			[do]
				{RANDOM_VAR rnd_i2 0.."$($undead_list.length-1)"}
				[unit]
					side=8
					type=$undead_list[$rnd_i2].type
					x,y=$undead_places[$rnd_i].x,$undead_places[$rnd_i].y
					placement=map
					passable=yes
					generate_name=yes
					random_traits=yes
					{OBJECT_LOYAL}
					random_gender=yes
					animate=yes
				[/unit]
				{VARIABLE_OP undead_gold sub $undead_list[$rnd_i2].cost}
			[/do]
		[/while]
#		{REPEAT $enemy.num_outlaws (
#			[unit]
#				side=8
#				type="Walking Corpse"
#				x,y=$undead_places[$rnd_i].x,$undead_places[$rnd_i].y
#				placement=map
#				passable=yes
#				animate=yes
#				random_traits=yes
#				{OBJECT_LOYAL}
#			[/unit] )}
		{CLEAR_VARIABLE rnd_dir,rnd_type,rnd_i,undead_places,num_villages,undead_gold,undead_list,rnd_i2}
		# Additional units provided by lich raising them every turn -- see event in enemies.cfg
		[modify_side]
			side=8
			team_name=calamity,undead
		[/modify_side]

		# All other enemies stay away for a while
		{VARIABLE_OP relations.outlaws_nice sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE_OP relations.outlaws_mean sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE_OP relations.raids sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE quota.elves 0}

		[event]
			name=sighted
			first_time_only=yes
			[filter]
				side=8
				[not]
					role=lich
				[/not]
			[/filter]
			[filter_second]
				side=1
			[/filter_second]
			[message]
				speaker=second_unit
				message=_"Undead, milord!"
			[/message]
			{HERO_SAYS _"Where are they coming from?"}
			[message]
				speaker=second_unit
				message=_"No idea, milord."
			[/message]
			{ADVISOR_SAYS _"It might behoove us to seek out whatever is raising these creatures before he---or it---has created an army."}
		[/event]
		[event]
			name=sighted
			[filter]
				role=lich
			[/filter]
			[filter_second]
				side=1
			[/filter_second]
			[message]
				role=lich
				message=_"So many fresh bodies for my army!"
			[/message]
			{ADVISOR_SAYS _"I think that means we have a fight on our hands, milord."}
			{FOOL_SAYS _"Unless anyone fancies a bony sort of lifestyle!"}
			{ADVISOR_SAYS _"*shudders*"}
			{TUTORIAL calamity_lich _"A lich has arrived in your territory. It will raise new undead footsoldiers every turn until you hunt it down and destroy it."}
		[/event]
	[/event]

	# ----- Lich raises dead -----
	[event]
		name=new turn
		first_time_only=no
		[if]
			[have_unit]
				side=8	# undead, not calamity
				role=lich
			[/have_unit]
			[then]
				# Raise dead randomly somewhere on the map
				[store_locations]
					variable=undead_places
					{X_AND_Y_ARE_ON_THE_MAP}
					{NOT_FILTER}
					terrain=!,W*,*^Y*,*^V*,K*,C*
					[and]
					[filter]
						side=1
					[/filter]
					radius=10
					[/and]
				[/store_locations]
				{RANDOM_VAR rnd_i 0.."$($undead_places.length-1)"}
				# Type list has some doubled units so they appear more often
				{RANDOM_VAR undead_type ("Dark Adept","Ghost","Ghoul","Skeleton","Skeleton","Skeleton Archer","Skeleton Archer","Walking Corpse","Walking Corpse","Soulless","Shadow","Wraith","Necrophage","Deathblade","Revenant","Bone Shooter")}
				{WF_DEBUG "Lich is raising a random unit somewhere. $undead_type at $undead_places[$rnd_i].x $undead_places[$rnd_i].y"}

				[unit]
					side=8
					type=$undead_type
					x=$undead_places[$rnd_i].x
					y=$undead_places[$rnd_i].y
					generate_name=yes
					random_gender=yes
					random_traits=yes
					{OBJECT_LOYAL}
				[/unit]
				{CLEAR_VARIABLE rnd_i,undead_places,undead_type}
			[/then]
		[/if]
	[/event]
#enddef

# ----- Gryphons nesting -------------------------------------------------
#define CALAMITY_GRYPHONS TURN
	[event]
		name=turn {TURN}
		{WF_DEBUG "Creating a gryphon calamity"}
		# Gryphons now, wolves/goblins in the winter?

		[store_locations]
			variable=keep_loc
			terrain=*^Yk
		[/store_locations]
		{WF_DEBUG "Looking for a good place for a gryphon nest near your keep at $keep_loc.x,$keep_loc.y"}
		{FIND_NEAREST_HEX nest_loc "$($keep_loc.x+10)" "$($keep_loc.y+10)" (
		{NOT_FILTER}
		terrain=M*
		[filter_adjacent_location]
			terrain=M*,H*
			count=2-6
		[/filter_adjacent_location] ) }
		{WF_DEBUG "Placing a gryphon's nest at $nest_loc.x,$nest_loc.y"}

		# Gryphons come from the southeast corner -- near to Gryphon Mt.
		# Gryphons are on the calamity side to avoid animal behavior changing
		[unit]
			side=8
			type=Gryphon
			canrecruit=no
			generate_name=yes
			random_gender=yes
			random_traits=no
			[modifications]
				[object]
					[effect]
						apply_to=loyal
					[/effect]
				[/object]
				{TRAIT_STRONG}
				{TRAIT_INTELLIGENT}
			[/modifications]
			x="$({MAP_WIDTH}-2)"
			y="$({MAP_HEIGHT}-2)"
			placement=map
			passable=yes
			role=gryphon_king
			{IS_HERO}
		[/unit]
		[modify_side]
			side=8
			team_name=calamity,wild_animals
		[/modify_side]
		[modify_ai]
			side=8
			action=delete
			path=goal[target8]
		[/modify_ai]
		[modify_ai]
			side=8
			action=add
			path=goal[]
			[goal]
				id=protect_location8
				name=protect_location
				[criteria]
					x=$nest_loc.x
					y=$nest_loc.y
				[/criteria]
				value=20
				protect_radius=6
			[/goal]
		[/modify_ai]
		{COUNT_VILLAGES num_villages}
		[set_variable]
			name=gryphons
			ipart="$(($enemy.raid_base_gold+$enemy.raid_gold_mult*$num_villages)/40)"
		[/set_variable]
		{WF_DEBUG "Trying to place $gryphons gryphon units"}
		# note: formulaAI should automatically convert result to integer
		{REPEAT $gryphons (
			[unit]
				side=8
				type=Gryphon
				canrecruit=no
				generate_name=yes
				random_gender=yes
				random_traits=yes
				{OBJECT_LOYAL}
				x="$({MAP_WIDTH}-2)"
				y="$({MAP_HEIGHT}-2)"
				placement=map
				passable=yes
			[/unit] ) }
		[move_unit]
			role=gryphon_king
			to_x=$nest_loc.x
			to_y=$nest_loc.y
		[/move_unit]
		{PLACE_IMAGE "scenery/nest-empty.png" $nest_loc.x $nest_loc.y}
		[message]
			role=gryphon_king
			message=_"Kaaaaarrrrrrreeeeeeeeeeeeeeeeee!"
		[/message]
		[message]
			role=gryphon_king
			message=_"Kaarreet! Kaarreet! Kaarreeeeeeeeee!"
		[/message]
		{HERO_SAYS _"What was that!?"}
		{ADVISOR_SAYS _"Sounded like a gryphon, but I did not think they ranged this far north."}
		{CYNIC_SAYS _"Well, that one appears to have set up a nest.

At least there is only one of them. It should not cause too much trouble, and might even keep the bat population down."}
		[move_unit]
			side=8
			type=Gryphon
			canrecruit=no
			to_x=$nest_loc.x
			to_y=$nest_loc.y
		[/move_unit]
		{CLEAR_VARIABLE keep_loc,gryphons,num_villages}
		{CYNIC_SAYS _"Way, way down. . . ."}
		{TUTORIAL gryphon_calamity _"The bevy of gryphons will defend their nest fiercely, and may simply attack your units on sight. Since they are adults you do not have a chance to train them, and there is no benefit to reaching the nest itself."}

		# All other enemies stay away for a while
		#{VARIABLE_OP relations.outlaws_nice sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		#{VARIABLE_OP relations.outlaws_mean sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE_OP relations.raids sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE quota.elves 0}
	[/event]
#enddef

# ----- Evil Loyalists ---------------------------------------------------
#define CALAMITY_LOYALISTS TURN
	[event]
		name=turn {TURN}
		{WF_DEBUG "Starting the loyalist calamity south near $map_signs[3].x,$map_signs[3].y n: $enemy.num_outlaws"}
		[store_locations]
			variable=loyalist_places
			terrain=!,W*,*^Y*,*^V*,K*,C*
			{X_AND_Y_ARE_ON_THE_MAP}
			{NOT_FILTER}
			[and]	# appears near the southern signpost
				x=$map_signs[3].x
				y=$map_signs[3].y
				radius={BORDER}
			[/and]
		[/store_locations]
		{RANDOM_VAR rnd_l 0.."$($loyalist_places.length-1)"}
		{WF_DEBUG "Placing Loyalists at $loyalist_places[$rnd_l].x,$loyalist_places[$rnd_l].y"}
		{FIND_NEAREST_HEX goto_site $loyalist_places[$rnd_l].x $loyalist_places[$rnd_l].y (
			{NOT_FILTER}
			terrain={BUILDABLE_TERRAIN},Ker
			[filter_adjacent_location]
				terrain={BUILDABLE_TERRAIN},Cer
				adjacent=nw,n,ne,se
				count=4
			[/filter_adjacent_location]
			{NOT_MAP_SIGNS}
		) }
		{WF_DEBUG "Trying to have the loyalist build a castle at $goto_site.x,$goto_site.y"}

		# Evil loyalists always come from the south
		{DIFFICULTY_VAR unit_type1 "Horseman Commander" "Mounted General" "Mounted General"}
		[unit]
			side=8
			type=$unit_type1
			canrecruit=yes
			generate_name=yes
			random_traits=no
			[modifications]
				{TRAIT_STRONG}
				{TRAIT_RESILIENT}
			[/modifications]
			x=$loyalist_places[$rnd_l].x
			y=$loyalist_places[$rnd_l].y
			goto_x=$goto_site.x
			goto_y=$goto_site.y
			placement=map
			passable=yes
			profile=portraits/evil_loyalist.png
			role=evil_loyalist
			extra_recruit="Spearman","Pikeman","Bowman","Longbowman","Heavy Infantryman","Shock Trooper","Cavalryman","Dragoon","Fencer","Duelist","Lancer","Javelineer","Red Mage","Junior Commander"
		[/unit]
		{DIFFICULTY_VAR unit_type1 "Shock Trooper" "Iron Mauler" "Iron Mauler"}
		[unit]
			type=$unit_type1
			side=8
			generate_name=yes
			[modifications]
				{TRAIT_LOYAL}
				{TRAIT_QUICK}
			[/modifications]
			placement=leader
			passable=yes
			overlays="misc/loyal-icon.png"
			role=henchman
		[/unit]
		{DIFFICULTY_VAR unit_type1 "Duelist" "Master at Arms" "Master at Arms"}
		[unit]
			type=$unit_type1
			side=8
			generate_name=yes
			[modifications]
				{TRAIT_LOYAL}
				{TRAIT_STRONG}
			[/modifications]
			placement=leader
			passable=yes
			overlays="misc/loyal-icon.png"
		[/unit]
		{DIFFICULTY_VAR unit_type1 "Infantry Lieutenant" "Infantry Commander" "Infantry Commander"}
		[unit]
			type=$unit_type1
			side=8
			generate_name=yes
			[modifications]
				{TRAIT_LOYAL}
				{TRAIT_RESILIENT}
			[/modifications]
			placement=leader
			passable=yes
			overlays="misc/loyal-icon.png"
		[/unit]
		{DIFFICULTY_VAR unit_type1 "Longbowman" "Master Bowman" "Master Bowman"}
		[unit]
			type=$unit_type1
			side=8
			generate_name=yes
			[modifications]
				{TRAIT_LOYAL}
				{TRAIT_RESILIENT}
			[/modifications]
			placement=leader
			passable=yes
			overlays="misc/loyal-icon.png"
		[/unit]
		{REPEAT $enemy.num_outlaws (
			{RANDOM_VAR unit_type1 ("Shock Trooper","Duelist","Swordsman","Pikeman","Lancer","Javelineer","Longbowman","Junior Commander") }
			[unit]
				side=8
				type=$unit_type1
				generate_name=yes
				random_traits=yes
				{OBJECT_LOYAL}
				overlays="misc/loyal-icon.png"
				placement=leader
				passable=yes
			[/unit] )}
		[micro_ai]
			side=8
			ai_type=messenger_escort
			action=add
			[filter]
				side=8
				canrecruit=yes
				role=evil_loyalist
			[/filter]
			waypoint_x=$goto_site.x
			waypoint_y=$goto_site.y
		[/micro_ai]
		{COUNT_VILLAGES num_villages}
		{VARIABLE loyalist_gold "$(ceil($enemy.raid_mult * ($enemy.raid_base_gold+$enemy.raid_gold_mult*$num_villages)))"}
#ifndef EASY
		{VARIABLE_OP loyalist_gold multiply 2}
#endif
		[gold]
			side=8
			amount=$loyalist_gold
		[/gold]
		{WF_DEBUG "Giving evil loyalist $loyalist_gold gold"}
		{CLEAR_VARIABLE unit_type1,loyalist_gold,num_villages}

		[event]
			name=sighted	# sighted events supposedly now work in 1.11.+
			first_time_only=yes
			[filter]	# Primary unit is the one sighted
				side=8
			[/filter]
			[filter_second]
				side=1
			[/filter_second]
			[message]
				speaker=second_unit
				message=_"Ho! Travellers from Wesnoth, welcome to our settlement."
			[/message]
			[message]
				speaker=unit
				message=_"We will indeed make ourselves welcome... to your farms, your houses, and your gold."
			[/message]
			{HERO_SAYS _"You had best recant that statement lest we introduce you to the King's justice."}
			[message]
				speaker=unit
				message=_"The King's justice does not extend to the Northlands. We will be taking control of your little town --- it is so much easier than building our own."
			[/message]
			{FOOL_SAYS _"You and what army?"}
			[message]
				speaker=unit
				message=_"The band of seasoned warriors right behind me."
			[/message]
			[message]
				role=evil_loyalist
				image=portraits/evil_loyalist-mad.png
				message=_"Charge!"
			[/message]
			{TUTORIAL calamity_loyalists _"This band of renegade soldiers will pose quite a challenge to your forces. To fully drive them out of your territory you will have to hunt down their leader and dispose of him."}
		[/event]


		[event]
			# Re-assign goto values each turn
			name=side 8 turn
			first_time_only=no
			delayed_variable_substitution=no
			id=guide_loyalist_leader
			[modify_unit]
				[filter]
					side=8
					role=evil_loyalist
					canrecruit=yes
				[/filter]
				goto_x=$goto_site.x
				goto_y=$goto_site.y
			[/modify_unit]
		[/event]
		# Build a castle when he gets there, or next turn if he's already there
		[if]
			[and]
				{VARIABLE_CONDITIONAL loyalist_places[$rnd_l].x equals $goto_site.x}
				{VARIABLE_CONDITIONAL loyalist_places[$rnd_l].y equals $goto_site.y}
			[/and]
			[then]
				[event]
					name=side 8 turn
					first_time_only=yes
					delayed_variable_substitution=no
					{BUILD_LOYALIST_CAMP $goto_site.x $goto_site.y}
				[/event]
			[/then]
			[else]
				[event]
					name=moveto
					first_time_only=yes
					delayed_variable_substitution=no	# so I can clear variables
					[filter]
						side=8
						role=evil_loyalist
						canrecruit=yes
						x=$goto_site.x
						y=$goto_site.y
					[/filter]
					{BUILD_LOYALIST_CAMP $goto_site.x $goto_site.y}
				[/event]
			[/else]
		[/if]
		{CLEAR_VARIABLE rnd_l,loyalist_places}
		[event]
			name=new turn
			id=store_side8_gold
			first_time_only=no
			[store_gold]
				side=8
				variable=side8_gold
			[/store_gold]
		[/event]
		[event]
			# Once the loyalists have run out of gold, they ditch their encampment
			# and come after you personally
			name=side 8 turn
			first_time_only=yes
			[filter_condition]
				{VARIABLE_CONDITIONAL side8_gold less_than 14}
			[/filter_condition]
			{WF_DEBUG "Loyalists are out of gold, having them tear down the camp $side8_gold < 14"}
			{MODIFY_TERRAIN Rb $goto_site.x $goto_site.y}
			[terrain]
				terrain=Rb
				[filter_adjacent_location]
					adjacent=se,s,sw,nw
					x=$goto_site.x
					y=$goto_site.y
				[/filter_adjacent_location]
			[/terrain]
			{FIRE_ANIMATION $goto_site.x $goto_site.y}
			{PLACE_IMAGE "scenery/rubble.png" $goto_site.x $goto_site.y}
			{CLEAR_VARIABLE goto_site,side8_gold}
			# it seems highly doubtful that it will ever take until
			# the autumn to run out of gold
			[event]
				id=store_side8_gold
				remove=yes
			[/event]
			[message]
				role=evil_loyalist
				message=_"I have had enough of this incompetence. I am coming for you myself!"
			[/message]
			{ADVISOR_SAYS _"He seems angry."}
			{CYNIC_SAYS _"I think he seems desparate."}
			{ADVISOR_SAYS _"Maybe he is running out of gold to hire mercenaries."}
			[modify_unit]
				[filter]
					side=8
					canrecruit=yes
					role=evil_loyalist
				[/filter]
				canrecruit=no
				{IS_HERO}
				[object]
					[effect]
						apply_to=loyal
					[/effect]
				[/object]
				goto_x=0
				goto_y=0
			[/modify_unit]
		[/event]

		# Outlaws stay away for a bit, orcs don't care
		{VARIABLE_OP relations.outlaws_nice sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE_OP relations.outlaws_mean sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE_OP relations.raids sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE quota.elves 0}
	[/event]
#enddef

#define BUILD_LOYALIST_CAMP X Y
	{MODIFY_TERRAIN Ker {X} {Y}}
	[terrain]
		terrain=Cer
		[filter_adjacent_location]
			adjacent=se,s,sw,nw
			x={X}
			y={Y}
		[/filter_adjacent_location]
	[/terrain]
	# leader no longer needs to be guided to campsite
	[modify_unit]
		[filter]
			side=8
			role=evil_loyalist
		[/filter]
		goto_x=0
		goto_y=0
	[/modify_unit]
	[micro_ai]
		side=8
		ai_type=messenger_escort
		action=delete
	[/micro_ai]
	[event]
		id=guide_loyalist_leader
		remove=yes
	[/event]
#enddef

# ----- Saurians ---------------------------------------------------------
#define CALAMITY_SAURIANS TURN
	[event]
		name=turn {TURN}
		{WF_DEBUG "Starting the Saurian calamity n: $enemy.num_outlaws"}
		[store_locations]
			variable=saurian_places
			terrain=!,W*,*^Y*,*^V*,K*,C*
			{X_AND_Y_ARE_ON_THE_MAP}
			{NOT_FILTER}
			[and]	# appears near the western signpost
				x=$map_signs[2].x
				y=$map_signs[2].y
				radius={BORDER}
			[/and]
		[/store_locations]
		{RANDOM_VAR rnd_s 0.."$($saurian_places.length-1)"}
		{WF_DEBUG "Placing Saurians at $saurian_places[$rnd_s].x,$saurian_places[$rnd_s].y"}

		{FIND_NEAREST_HEX goto_site $saurian_places[$rnd_s].x $saurian_places[$rnd_s].y (
			{NOT_FILTER}
			terrain=W*,S*,Khw
			[filter_adjacent_location]
				terrain=W*,S*,Chw
				adjacent=s,se,nw
				count=3
			[/filter_adjacent_location]
			{NOT_MAP_SIGNS}
		) }
		# Saurians come from the west, not for any good reason, just to avoid orcs/necro
		[unit]
			side=8
			type="Saurian Flanker"
			canrecruit=yes
			generate_name=yes
			random_traits=no
			[modifications]
				{TRAIT_RESILIENT}
				{TRAIT_INTELLIGENT}
			[/modifications]
			x=$saurian_places[$rnd_s].x
			y=$saurian_places[$rnd_s].y
			goto_x=$goto_site.x
			goto_y=$goto_site.y
			placement=map
			passable=yes
			role=saurian_leader
			extra_recruit=Saurian Augur,Saurian Skirmisher
		[/unit]
		[unit]
			type="Saurian Oracle"
			side=8
			generate_name=yes
			[modifications]
				{TRAIT_LOYAL}
				{TRAIT_RESILIENT}
			[/modifications]
			placement=leader
			passable=yes
			overlays="misc/loyal-icon.png"
			role=henchsaur
		[/unit]
		[unit]
			type="Saurian Ambusher"
			side=8
			generate_name=yes
			[modifications]
				{TRAIT_LOYAL}
				{TRAIT_STRONG}
			[/modifications]
			placement=leader
			passable=yes
			overlays="misc/loyal-icon.png"
		[/unit]
		[unit]
			type="Saurian Soothsayer"
			side=8
			generate_name=yes
			[modifications]
				{TRAIT_LOYAL}
				{TRAIT_INTELLIGENT}
			[/modifications]
			placement=leader
			passable=yes
			overlays="misc/loyal-icon.png"
		[/unit]

		{REPEAT $enemy.num_outlaws (
			[unit]
				side=8
				type="Saurian Skirmisher"
				generate_name=yes
				random_traits=yes
				{OBJECT_LOYAL}
				placement=leader
				passable=yes
			[/unit] ) }
		{CLEAR_VARIABLE rnd_s,saurian_places}

		[message]
			role=henchsaur
			message=_"I foresssee that thissss new land ssshall yield rich fissshing and hunting."
		[/message]
		[message]
			role=saurian_leader
			message=_"Indeeeed. The treesssss and riverssssss call to me."
		[/message]
		[message]
			role=henchsaur
			message=_"I sssssmell ssssome humans!."
		[/message]
		[message]
			role=saurian_leader
			message=_"They are of little concern. We ssssshall feed them to our ssssspearrrssss!"
		[/message]

		{WF_DEBUG "Saurian leader trying to *find* a castle at $goto_site.x,$goto_site.y"}
#		[modify_side]
#			side=8
#			[ai]
#				#[leader_goal]
#				#	x=$goto_site.x
#				#	y=$goto_site.y
#				#	auto_remove=yes
#				#	id=0
#				#[/leader_goal]
#				[goal]
#					id=protect_unit
#					name=protect_unit
#					[criteria]
#						canrecruit=yes
#						role=saurian_leader
#						side=8
#					[/criteria]
#					protect_radius=6
#					value=20
#				[/goal]
#			[/ai]
#		[/modify_side]
		[micro_ai]
			side=8
			ai_type=messenger_escort
			action=add
			[filter]
				side=8
				canrecruit=yes
				role=saurian_leader
			[/filter]
			waypoint_x=$goto_site.x
			waypoint_y=$goto_site.y
		[/micro_ai]

		# Provide gold to recruit units
		{COUNT_VILLAGES num_villages}
		{VARIABLE saurian_gold "$(ceil($enemy.raid_mult * ($enemy.raid_base_gold+$enemy.raid_gold_mult*$num_villages)))"}
		[gold]
			side=8
			amount=$saurian_gold
		[/gold]
		{WF_DEBUG "Giving saurian $saurian_gold gold"}

		# Move the leader to the site
		[event]
			name=side 8 turn
			first_time_only=no
			delayed_variable_substitution=no
			id=guide_saurian_leader
			[modify_unit]
				[filter]
					side=8
					canrecruit=yes
					role=saurian_leader
				[/filter]
				goto_x=$goto_site.x
				goto_y=$goto_site.y
			[/modify_unit]
		[/event]
		# "Build" a castle when he gets there (no need to worry about already there)
		[event]
			name=moveto
			first_time_only=yes
			delayed_variable_substitution=no	# so I can clear variables
			[filter]
				side=8
				canrecruit=yes
				role=saurian_leader
				x=$goto_site.x
				y=$goto_site.y
			[/filter]
			{MODIFY_TERRAIN Khw $goto_site.x $goto_site.y}
			[terrain]
				terrain=Chw
				[filter_adjacent_location]
					x=$goto_site.x
					y=$goto_site.y
					adjacent=n,nw,se
				[/filter_adjacent_location]
			[/terrain]

			[if]
				[have_location]
					x=$goto_site.x
					y=$goto_site.y
					[filter_vision]
						side=1
						visible=yes
						respect_fog=no
					[/filter_vision]
				[/have_location]
				[then]
					{CYNIC_SAYS _"There was not a castle in that lake previously, was there?"}
					{ADVISOR_SAYS _"It must have been hidden just under the waves, and we did not see it!"}
					{CYNIC_SAYS _"This is what I get for leaving home, I guess. Lizards raising making castles appear out of nowhere."}
					{HERO_SAYS _"Enough chatter. Draw your swords, men!"}
				[/then]
			[/if]

			# leader no longer needs to be guided to campside
			[modify_unit]
				[filter]
					side=8
					canrecruit=yes
					role=saurian_leader
				[/filter]
				goto_x=0
				goto_y=0
			[/modify_unit]
			[micro_ai]
				side=8
				ai_type=messenger_escort
				action=delete
			[/micro_ai]
#			[modify_ai]
#				side=8
#				action=delete
#				path=goal[protect_unit]
#			[/modify_ai]
			[event]
				id=guide_saurian_leader
				remove=yes
			[/event]
		[/event]
		{CLEAR_VARIABLE goto_site,saurian_gold,num_villages}
		# Not as severe an attack, but other enemies don't stay away
		#{VARIABLE_OP relations.outlaws_nice sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		#{VARIABLE_OP relations.outlaws_mean sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE_OP relations.raids sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE quota.elves 0}
	[/event]
#enddef

# ----- Winter Yetis -------------------------------------------------
#define CALAMITY_YETIS TURN
	[event]
		name=turn {TURN}
		{WF_DEBUG "Creating a yeti calamity"}

		[store_locations]
			variable=yeti_places
			terrain=!,W*,*^Y*,*^V*,K*,C*
			{X_AND_Y_ARE_ON_THE_MAP}
			{NOT_FILTER}
			[and]	# appears near the northern signpost
				x=$map_signs[1].x
				y=$map_signs[1].y
				radius={BORDER}
			[/and]
		[/store_locations]
		{RANDOM_VAR rnd_i 0.."$($yeti_places.length-1)"}
		{WF_DEBUG "Placing Yetis at $yeti_places[$rnd_i].x,$yeti_places[$rnd_i].y"}
		[unit]
			side=8
			type=Yeti
			canrecruit=no
			generate_name=yes
			random_gender=yes
			random_traits=no
			x=$yeti_places[$rnd_i].x
			y=$yeti_places[$rnd_i].y
			[modifications]
				[object]
					[effect]
						apply_to=loyal
					[/effect]
				[/object]
				{TRAIT_RESILIENT}
				{TRAIT_STRONG}
			[/modifications]
			placement=map
			passable=yes
			role=yeti_leader
			{IS_HERO}
		[/unit]
		[unit]
			side=8
			type=Yeti
			canrecruit=no
			generate_name=yes
			random_gender=yes
			random_traits=yes
			{OBJECT_LOYAL}
			x=$yeti_places[$rnd_i].x
			y=$yeti_places[$rnd_i].y
			placement=map
			passable=yes
			role=yeti_buddy
		[/unit]
		[modify_side]
			side=8
			team_name=calamity,wild_animals
		[/modify_side]
		[message]
			role=yeti_leader
			message=_"Rarlg - argh, a raul-rarlg!"
		[/message]
		{HERO_SAYS _"What was that!?"}
		{CYNIC_SAYS _"Oh my, this can't be good."}
		[message]
			role=yeti_buddy
			message=_"Garl, arl rarlg!"
		[/message]
		{FOOL_SAYS _"That noise is coming from the north."}
		{ADVISOR_SAYS _"Sounded like two yetis, but I did not think they ranged this far south."}
		{CYNIC_SAYS _"And yet, there they are."}
		{CLEAR_VARIABLE rnd_i,yeti_places}

		# All other enemies stay away for a while
		#{VARIABLE_OP relations.outlaws_nice sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		#{VARIABLE_OP relations.outlaws_mean sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		#{VARIABLE_OP relations.raids sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE quota.elves 0}
	[/event]
#enddef

#define CALAMITY_DRAKES TURN
	[event]
		name=turn {TURN}
		{WF_DEBUG "Creating a drake calamity n: $enemy.num_outlaws"}

		{RANDOM_VAR rnd_dir 0,1,2,3}	# 0=east, 1=north, 2=west, 3=south
		[store_locations]
			variable=drake_places
			terrain=!,W*,*^Y*,*^V*,K*,C*
			{X_AND_Y_ARE_ON_THE_MAP}
			{NOT_FILTER}
			[and]
				x=$map_signs[$rnd_dir].x
				y=$map_signs[$rnd_dir].y
				radius={BORDER}
			[/and]
		[/store_locations]
		{RANDOM_VAR rnd_i 0.."$($drake_places.length-1)"}
		{RANDOM_VAR rnd_type "Inferno Drake","Drake Flameheart","Hurricane Drake","Drake Enforcer","Drake Blademaster","Drake Warden"}
		{WF_DEBUG "Placing $rnd_type at $drake_places[$rnd_i].x,$drake_places[$rnd_i].y"}
		[unit]
			side=8
			type=$rnd_type
			canrecruit=no
			generate_name=yes
			random_gender=yes
			random_traits=yes
			x=$drake_places[$rnd_i].x
			y=$drake_places[$rnd_i].y
			placement=map
			passable=yes
			role=drake_leader
			animate=yes
			{OBJECT_LOYAL}
			{IS_HERO}
		[/unit]
		{REPEAT $enemy.num_outlaws (
			{RANDOM_VAR rnd_type ("Drake Fighter","Drake Burner","Drake Glider","Drake Clasher")}
			[unit]
				side=8
				type=$rnd_type
				canrecruit=no
				generate_name=yes
				random_traits=yes
				random_gender=yes
				x,y=$drake_places[$rnd_i].x,$drake_places[$rnd_i].y
				placement=map
				passable=yes
				animate=yes
				{OBJECT_LOYAL}
			[/unit] ) }
		# Now he "recruits" his army
		{COUNT_VILLAGES num_villages}
		{VARIABLE drake_gold "$(ceil($enemy.raid_mult * ($enemy.raid_base_gold + $enemy.raid_gold_mult*$num_villages)))"}
#ifndef EASY
		{VARIABLE_OP drake_gold multiply 2}
#endif
		{WF_DEBUG "Drake fake recruit gold set to $drake_gold"}
		[set_variables]
			name=drake_list
			mode=replace
			{VALUE2 type "Drake Thrasher" cost 31}
			{VALUE2 type "Fire Drake" cost 35}
			{VALUE2 type "Sky Drake" cost 30}
			{VALUE2 type "Drake Flare" cost 35}
			{VALUE2 type "Drake Arbiter" cost 31}
			{VALUE2 type "Drake Warrior" cost 30}
		[/set_variables]
		[while]
			{VARIABLE_CONDITIONAL drake_gold greater_than 0}	# will go *roughly* to zero
			[do]
				{RANDOM_VAR rnd_i2 0.."$($drake_list.length-1)"}
				[unit]
					side=8
					type=$drake_list[$rnd_i2].type
					canrecruit=no
					generate_name=yes
					random_traits=yes
					random_gender=yes
					x,y=$drake_places[$rnd_i].x,$drake_places[$rnd_i].y
					placement=map
					passable=yes
					animate=yes
					{OBJECT_LOYAL}
					overlays="misc/loyal-icon.png"
				[/unit]
				{VARIABLE_OP drake_gold sub $drake_list[$rnd_i2].cost}
			[/do]
		[/while]
		{CLEAR_VARIABLE drake_places,rnd_i,rnd_i2,rnd_dir,rnd_type,num_villages,drake_list,drake_gold}

		[event]
			name=sighted
			first_time_only=yes
			[filter]	# Primary unit is the one sighted
				side=8
				race=drake
			[/filter]
			[filter_second]
				side=1
			[/filter_second]

			[message]
				race=drake
				message=_"Hunters! Take wing!"
			[/message]

			{ADVISOR_SAYS _"Let us slay these flying lizards."}
			{HERO_SAYS _"Archers, on the ready."}
			# {CYNIC_SAYS _""}
			# {FOOL_SAYS _""}
		[/event]

		# All other enemies stay away for a while
		{VARIABLE_OP relations.outlaws_nice sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE_OP relations.outlaws_mean sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE_OP relations.raids sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE quota.elves 0}
	[/event]
#enddef

#define CALAMITY_DWARVES TURN
	[event]
		name=turn {TURN}
		{WF_DEBUG "Creating a dwarf calamity n: $enemy.num_outlaws"}

		{RANDOM_VAR rnd_dir 0,1,2,3}	# 0=east, 1=north, 2=west, 3=south
		[store_locations]
			variable=dwarf_places
			terrain=!,W*,*^Y*,*^V*,K*,C*
			{X_AND_Y_ARE_ON_THE_MAP}
			{NOT_FILTER}
			[and]
				x=$map_signs[$rnd_dir].x
				y=$map_signs[$rnd_dir].y
				radius={BORDER}
			[/and]
		[/store_locations]
		{RANDOM_VAR rnd_i 0.."$($dwarf_places.length-1)"}
		{RANDOM_VAR rnd_type "Dwarvish Dragonguard","Dwarvish Lord","Dwarvish Sentinel","Dwarvish Explorer","Dwarvish Runemaster"}
		{WF_DEBUG "Placing $rnd_type at $dwarf_places[$rnd_i].x,$dwarf_places[$rnd_i].y"}
		[unit]
			side=8
			type=$rnd_type
			canrecruit=no
			generate_name=yes
			random_gender=yes
			random_traits=yes
			x=$dwarf_places[$rnd_i].x
			y=$dwarf_places[$rnd_i].y
			placement=map
			passable=yes
			role=dwarf_leader
			animate=yes
			{OBJECT_LOYAL}
			{IS_HERO}
		[/unit]
		{REPEAT $enemy.num_outlaws (
			{RANDOM_VAR rnd_type ("Dwarvish Thunderer","Dwarvish Fighter","Dwarvish Guardsman","Dwarvish Ulfserker","Dwarvish Scout")}
			[unit]
				side=8
				type=$rnd_type
				canrecruit=no
				generate_name=yes
				random_traits=yes
				random_gender=yes
				x,y=$dwarf_places[$rnd_i].x,$dwarf_places[$rnd_i].y
				placement=map
				passable=yes
				animate=yes
				{OBJECT_LOYAL}
			[/unit] ) }
		# Now he "recruits" his army
		{COUNT_VILLAGES num_villages}
		{VARIABLE dwarf_gold "$(ceil($enemy.raid_mult * ($enemy.raid_base_gold + $enemy.raid_gold_mult*$num_villages)))"}
#ifndef EASY
		{VARIABLE_OP dwarf_gold multiply 2}
#endif
		{WF_DEBUG "Dwarf fake recruit gold set to $dwarf_gold"}
		[set_variables]
			name=dwarf_list
			mode=replace
			{VALUE2 type "Dwarvish Pathfinder" cost 30}
			{VALUE2 type "Dwarvish Steelclad" cost 32}
			{VALUE2 type "Dwarvish Runesmith" cost 30}
			{VALUE2 type "Dwarvish Stalwart" cost 32}
			{VALUE2 type "Dwarvish Thunderguard" cost 30}
			{VALUE2 type "Dwarvish Berserker" cost 33}
		[/set_variables]
		[while]
			{VARIABLE_CONDITIONAL dwarf_gold greater_than 0}	# will go *roughly* to zero
			[do]
				{RANDOM_VAR rnd_i2 0.."$($dwarf_list.length-1)"}
				[unit]
					side=8
					type=$dwarf_list[$rnd_i2].type
					canrecruit=no
					generate_name=yes
					random_traits=yes
					random_gender=yes
					x,y=$dwarf_places[$rnd_i].x,$dwarf_places[$rnd_i].y
					placement=map
					passable=yes
					animate=yes
					{OBJECT_LOYAL}
					overlays="misc/loyal-icon.png"
				[/unit]
				{VARIABLE_OP dwarf_gold sub $dwarf_list[$rnd_i2].cost}
			[/do]
		[/while]
		{CLEAR_VARIABLE dwarf_places,rnd_i,rnd_i2,rnd_dir,rnd_type,num_villages,dwarf_list,dwarf_gold}

		[event]
			name=sighted
			first_time_only=yes
			[filter]	# Primary unit is the one sighted
				side=8
				race=dwarf
			[/filter]
			[filter_second]
				side=1
			[/filter_second]

			[message]
				race=dwarf
				message=_"What do we have here?! Let us ransack this town."
			[/message]

			{ADVISOR_SAYS _"Beware, rogue dwarves."}
			{HERO_SAYS _"Send them back to their holes where they belong."}
			# {CYNIC_SAYS _""}
			# {FOOL_SAYS _""}
		[/event]

		# All other enemies stay away for a while
		{VARIABLE_OP relations.outlaws_nice sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE_OP relations.outlaws_mean sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE_OP relations.raids sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE quota.elves 0}
	[/event]
#enddef

#define CALAMITY_ORCS TURN
	[event]
		name=turn {TURN}
		{WF_DEBUG "Creating a orcs calamity n: $enemy.num_outlaws"}
		[sound]	# warn the player who is paying attention (and has the sound on)
			name="ambient/wardrums.ogg"
		[/sound]
		{CALAMITY_ORCS_DIR 0}
		{CALAMITY_ORCS_DIR 1}
		{CALAMITY_ORCS_DIR 2}
		{CALAMITY_ORCS_DIR 3}

		[event]
			name=sighted
			first_time_only=yes
			[filter]	# Primary unit is the one sighted
				side=8
				[and]
					race=orc
					[or]
						race=troll
					[/or]
					[or]
						race=goblin
					[/or]
				[/and]
			[/filter]
			[filter_second]
				side=1
			[/filter_second]

			[message]
				speaker=unit
				message=_"Spare no one!"
			[/message]

			{ADVISOR_SAYS _"We're being raided from all sides, milord."}
			{HERO_SAYS _"Man all posts."}
			# {CYNIC_SAYS _""}
			# {FOOL_SAYS _""}
		[/event]

		# All other enemies stay away for a while
		{VARIABLE_OP relations.outlaws_nice sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE_OP relations.outlaws_mean sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE_OP relations.raids sub "$(ceil(({SEASON_LENGTH}/3)*{ENEMY_STEP}))"}
		{VARIABLE quota.elves 0}
	[/event]
#enddef

#define CALAMITY_ORCS_DIR DIR
		{VARIABLE rnd_dir {DIR}}
		#{RANDOM_VAR rnd_dir 0,1,2,3}	# 0=east, 1=north, 2=west, 3=south
		[store_locations]
			variable=orc_calamity_places
			terrain=!,W*,*^Y*,*^V*,K*,C*
			{X_AND_Y_ARE_ON_THE_MAP}
			{NOT_FILTER}
			[and]
				x=$map_signs[$rnd_dir].x
				y=$map_signs[$rnd_dir].y
				radius={BORDER}
			[/and]
		[/store_locations]
		{RANDOM_VAR rnd_i 0.."$($orc_calamity_places.length-1)"}
		{RANDOM_VAR rnd_type ("Orcish Slurbow,Orcish Warlord,Great Troll,Troll Warrior,Orcish Sovereign,Orcish Nightblade,Direwolf Rider")}
		{WF_DEBUG "Placing $rnd_type at $orc_calamity_places[$rnd_i].x,$orc_calamity_places[$rnd_i].y"}
		[unit]
			side=8
			type=$rnd_type
			canrecruit=no
			generate_name=yes
			random_gender=yes
			random_traits=yes
			x=$orc_calamity_places[$rnd_i].x
			y=$orc_calamity_places[$rnd_i].y
			placement=map
			passable=yes
			role=orc_calamity_leader
			animate=yes
			{OBJECT_LOYAL}
			{IS_HERO}
		[/unit]
		{REPEAT $enemy.num_outlaws (
			{RANDOM_VAR rnd_type "Orcish Archer,Orcish Assassin,Orcish Grunt,Orcish Leader,Troll Whelp,Goblin Spearman,Goblin Impaler,Goblin Rouser,Wolf Rider"}
			[unit]
				side=8
				type=$rnd_type
				canrecruit=no
				generate_name=yes
				random_traits=yes
				random_gender=yes
				x,y=$orc_calamity_places[$rnd_i].x,$orc_calamity_places[$rnd_i].y
				placement=map
				passable=yes
				animate=yes
				{OBJECT_LOYAL}
			[/unit] ) }
		# Now he "recruits" his army
		{COUNT_VILLAGES num_villages}
		{VARIABLE orc_calamity_gold "$(ceil($enemy.raid_mult * ($enemy.raid_base_gold + $enemy.raid_gold_mult*$num_villages)))"}
		#{VARIABLE_OP orc_calamity_gold multiply 2}
		{WF_DEBUG "Orcs calamity fake recruit gold set to $orc_calamity_gold"}
		[set_variables]
			name=orc_calamity_list
			mode=replace
			{VALUE2 type "Orcish Crossbowman" cost 26}
			{VALUE2 type "Orcish Slayer" cost 33}
			{VALUE2 type "Orcish Warrior" cost 26}
			{VALUE2 type "Troll" cost 29}
			{VALUE2 type "Troll Rocklobber" cost 29}
			{VALUE2 type "Orcish Ruler" cost 35}
			{VALUE2 type "Goblin Knight" cost 32}
			{VALUE2 type "Goblin Pillager" cost 32}
			{VALUE2 type "Troll Hero" cost 30}
			{VALUE2 type "Troll Shaman" cost 32}
		[/set_variables]
		[while]
			{VARIABLE_CONDITIONAL orc_calamity_gold greater_than 0}	# will go *roughly* to zero
			[do]
				{RANDOM_VAR rnd_i2 0.."$($orc_calamity_list.length-1)"}
				[unit]
					side=8
					type=$orc_calamity_list[$rnd_i2].type
					canrecruit=no
					generate_name=yes
					random_traits=yes
					random_gender=yes
					x,y=$orc_calamity_places[$rnd_i].x,$orc_calamity_places[$rnd_i].y
					placement=map
					passable=yes
					animate=yes
					{OBJECT_LOYAL}
					overlays="misc/loyal-icon.png"
				[/unit]
				{VARIABLE_OP orc_calamity_gold sub $orc_calamity_list[$rnd_i2].cost}
			[/do]
		[/while]
		{CLEAR_VARIABLE orc_calamity_places,rnd_i,rnd_i2,rnd_dir,rnd_type,num_villages,orc_calamity_list,orc_calamity_gold}
#enddef
