#textdomain wesnoth-Wild_Frontiers

#define WF_DIPLOMACY
	[event]
		name=prestart
		[set_menu_item]
		id=start_diplomacy
		description=_ "Hire mercenaries"
		[show_if]
			[have_unit]
				id=Hero
				x,y=$x1,$y1
			[/have_unit]
			[have_location]
				x,y=$x1,$y1
				terrain=*^Yu*
			[/have_location]
		[/show_if]
		[command]
			[fire_event]
				name=diplomacy_refresh
			[/fire_event]
			[message]
				speaker=unit
				message=_"Initiate talks with ..."
				[option]
					label=_"The loyalists"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_LOYALISTS}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"The outlaws"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_OUTLAWS}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"The elves"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_ELVES}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"The dwarves"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_DWARVES}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"The drakes"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_DRAKES}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"The undead"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_UNDEAD}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"The orcs"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_ORCS}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"Nevermind"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
					[/command]
				[/option]
				[option]
					label=_"Negotiation status with the $diplomacy.faction"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction not_equals "none"}
						{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
					[/show_if]
					[command]
						[message]
							speaker=narrator
							image="wesnoth-icon.png"
							message="$diplomacy.action|
Your current standing is $diplomacy.current|.
The required standing is $diplomacy.required|.
The fee for their services is $diplomacy.fee|."
						[/message]
					[/command]
				[/option]
				[option]
					label=_"Negotiation status with the $diplomacy.faction"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction not_equals "none"}
						{VARIABLE_CONDITIONAL diplomacy.fee numerical_equals 0}
					[/show_if]
					[command]
						[message]
							speaker=narrator
							image="wesnoth-icon.png"
							message="You are on good standings with the $diplomacy.faction|.
The mercenaries will arrive in $diplomacy.turns| turns."
						[/message]
					[/command]
				[/option]
				[option]
					label=_"Cancel negotiations with the $diplomacy.faction"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction not_equals "none"}
						{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
					[/show_if]
					[command]
						{VARIABLE diplomacy.faction "none"}
						{VARIABLE diplomacy.required 0}
						{VARIABLE diplomacy.current 0}
						{VARIABLE diplomacy.fee 0}
						{VARIABLE diplomacy.turns 0}
					[/command]
				[/option]
			[/message]
		[/command]
	[/set_menu_item]
	[/event]

	[event]
		name=action_hills
		first_time_only=no
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "dwarves"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
		[/filter_condition]

		[if]
			{VARIABLE_CONDITIONAL diplomacy.dwarves_mission numerical_equals 1}
		[then]
			{VARIABLE diplomacy.dwarves $relations.hills}
		[/then]
		[/if]

		[if]
			{VARIABLE_CONDITIONAL weapon.action equals "burn"}
		[then]
			{UNIT_SAYS _"My lord, for some reasons, I feel like someone is watching me..."}
		[/then]
		[/if]
	[/event]

	[event]
		name=action_trees
		first_time_only=no
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "elves"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
		[/filter_condition]

		[if]
			{VARIABLE_CONDITIONAL diplomacy.elves_mission numerical_equals 1}
			[or]
				{VARIABLE_CONDITIONAL diplomacy.elves_mission numerical_equals 2}
			[/or]
		[then]
			{VARIABLE diplomacy.elves $relations.trees}
		[/then]
		[/if]

		[if]
			{VARIABLE_CONDITIONAL weapon.action equals "burn"}
		[then]
			{UNIT_SAYS _"My lord, for some reasons, I feel like someone is watching me..."}
		[/then]
		[/if]
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			type_adv_tree=Poacher
			[or]
				type_adv_tree=Thief
			[/or]
			[or]
				type_adv_tree=Thug
			[/or]
			[or]
				type_adv_tree=Footpad
			[/or]
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "loyalists"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
		[/filter_condition]

		{VARIABLE_OP diplomacy.loyalists sub $unit.level}
	[/event]

	[event]
		name=last breath
		first_time_only=no
		[filter]
			role=outlaw_leader
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "elves"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
			{VARIABLE_CONDITIONAL diplomacy.elves_mission numerical_equals 3}
		[/filter_condition]

		{VARIABLE_OP diplomacy.elves sub 1}
		[switch]
			variable=diplomacy.elves
			[case]
				# First outlaw leader
				value=-1
				{SECOND_UNIT_SAYS _"End of the line, criminal scum. You’re coming with us."}
				{UNIT_SAYS _"<i>*spitting on the ground*</i> What do you want? Putting me in jail until I die of boredom?"}
				{UNIT_SAYS _"<i>*laugh*</i> Good luck with that, dogs of the crown!!!"}
				{SECOND_UNIT_SAYS _"None of such. The elves will deal with you later."}
				{UNIT_SAYS _"Elves? Why would you… No… NO!!! Kill me now, dogs!!!"}
				{SECOND_UNIT_SAYS _"<i>*knock the outlaw unconscious*</i> Take him away, lads."}
			[/case]
			[case]
				# Second outlaw leader
				value=-2
				{UNIT_SAYS _"<i>*panting heavily*</i> So the house dogs are now working with the forest hounds..."}
				{UNIT_SAYS _"<i>*grimace*</i> One day, we will make sure you regret this decision..."}
				{SECOND_UNIT_SAYS _"Strange. The band of outlaws this fellow controls has no connection with the previous one, yet he has already heard about our deal with the elves."}
				{FOOL_SAYS _"Perhaps a survivor that clashed with us managed to escape and spread the news?"}
				{ADVISOR_SAYS _"They shouldn’t be able to confirm it that quickly..."}
			[/case]
			[case]
				# Third outlaw leader
				value=-3
			[/case]
			[case]
				# Fourth outlaw leader
				value=-4
			[/case]
			[case]
				# Fifth outlaw leader
				value=-5
				{SECOND_UNIT_SAYS _"Soldiers move quickly, and pin him to the ground."}
				{SECOND_UNIT_SAYS _"Finally... You are coming with us, scum!"}

				#FIXME: Too much text here 7
				{NARRATOR_SAYS _"Suddenly, black smoke rises from beneath, forming sinister lumps of floating masses."}
				{NARRATOR_SAYS _"Everyone was distracted. No one notices when a man covered with a black cloak appears, plunging his glowing knife into the outlaw leader’s heart."}
				{NARRATOR_SAYS _"Outraged, the guards surround the assassin, determined not to let him escape. However, the man in black easily slips past them with lighting dexterity, leaving behind the black smoke to deter any pursuers."}
				{NARRATOR_SAYS _"These balls of darkness nimbly avoid any sword or arrow that comes their way, moving around the guards as if they weren’t there. Every time the black smoke is obliterated by a mage, another one would rise out of the fleeing assassin."}
				{NARRATOR_SAYS _"Out of desperation, the remaining guards try to cut off the possible escape routes. The assassin then lunges towards the direction of the forest, dodging any attack the entire time."}
				{NARRATOR_SAYS _"You grin, knowing that his speed will soon drop, allowing your horsemen to catch up and surround him. Even if he manages to evade your pursuit, the arrows from elven sentries will certainly pierce him without fail."}
				{NARRATOR_SAYS _"However, the moment the assassin reaches the wood, his entire body seemingly vanishes into thin air, leaving you and the soldiers in shock..."}
			[/case]
		[/switch]
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			race=undead
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "elves"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
			{VARIABLE_CONDITIONAL diplomacy.elves_mission numerical_equals 4}
		[/filter_condition]

		{VARIABLE_OP diplomacy.elves sub 1}
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			race=orc,troll,goblin
			[or]
				type=Direwolf Rider,Goblin Knight,Goblin Pillager,Wolf Rider
			[/or]
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "elves"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
			{VARIABLE_CONDITIONAL diplomacy.elves_mission numerical_equals 5}
		[/filter_condition]

		{VARIABLE_OP diplomacy.elves sub 1}
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			race=undead
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "outlaws"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
		[/filter_condition]

		{VARIABLE_OP diplomacy.outlaws sub $unit.level}
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			race=wose
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "drakes"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
		[/filter_condition]

		{VARIABLE_OP diplomacy.drakes sub $unit.level}
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_second_attack]
			special=plague
		[/filter_second_attack]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "undead"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
		[/filter_condition]

		{VARIABLE_OP diplomacy.undead sub $unit.level}
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			race=elf
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "orcs"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
		[/filter_condition]

		{VARIABLE_OP diplomacy.orcs sub $unit.level}
	[/event]

	[event]
		name=side 1 turn refresh
		first_time_only=no

		[fire_event]
			name=diplomacy_refresh
		[/fire_event]
	[/event]

	[event]
		name=diplomacy_refresh
		first_time_only=no
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction not_equals "none"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
		[/filter_condition]

		[switch]
			variable=diplomacy.faction
			[case]
				value="loyalists"
				{VARIABLE diplomacy.current $diplomacy.loyalists}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
			[case]
				value="outlaws"
				{VARIABLE diplomacy.current $diplomacy.outlaws}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
			[case]
				value="dwarves"
				{VARIABLE diplomacy.current $diplomacy.dwarves}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
			[case]
				value="drakes"
				{VARIABLE diplomacy.current $diplomacy.drakes}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
			[case]
				value="undead"
				{VARIABLE diplomacy.current $diplomacy.undead}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
			[case]
				value="elves"
				{VARIABLE diplomacy.current $diplomacy.elves}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
			[case]
				value="orcs"
				{VARIABLE diplomacy.current $diplomacy.orcs}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
		[/switch]

		[if]
			{VARIABLE_CONDITIONAL diplomacy.current greater_than_equal_to $diplomacy.required}
		[then]
			[store_gold]
				side=1
				variable=wf_vars.side1_gold
			[/store_gold]
			[if]
				{VARIABLE_CONDITIONAL wf_vars.side1_gold greater_than_equal_to $diplomacy.fee}
			[then]
			[message]
				role=advisor
				message=_"We have fulfilled our end of the bargain for the $diplomacy.faction|. May I suggest, we pay $diplomacy.fee and seal the deal, milord?"
				[option]
					label=_"Yes"
					[command]
						{PAY_GOLD $diplomacy.fee}
						{VARIABLE diplomacy.fee 0}
						{VARIABLE diplomacy.required 0}
						{VARIABLE diplomacy.current 0}
						[switch]
							variable=diplomacy.faction
							[case]
								value="loyalists"
								{VARIABLE diplomacy.loyalists 0}
							[/case]
							[case]
								value="outlaws"
								{VARIABLE diplomacy.outlaws 0}
							[/case]
							[case]
								value="dwarves"
								{VARIABLE diplomacy.dwarves 0}
							[/case]
							[case]
								value="drakes"
								{VARIABLE diplomacy.drakes 0}
							[/case]
							[case]
								value="undead"
								{VARIABLE diplomacy.undead 0}
							[/case]
							[case]
								value="elves"
								{VARIABLE diplomacy.elves 0}
							[/case]
							[case]
								value="orcs"
								{VARIABLE diplomacy.orcs 0}
							[/case]
						[/switch]
						{RANDOM_VAR diplomacy.turns 1..4}
					[/command]
				[/option]
				[option]
					label=_"No"
					[command] [/command]
				[/option]
			[/message]
			[/then]
			[/if]
		[/then]
		[/if]
	[/event]

	[event]
		name=side 1 turn end
		first_time_only=no
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction not_equals "none"}
			{VARIABLE_CONDITIONAL diplomacy.fee numerical_equals 0}
		[/filter_condition]

		[if]
			{VARIABLE_CONDITIONAL diplomacy.turns greater_than 0}
		[then]
			{VARIABLE_OP diplomacy.turns sub 1}
		[/then]
		[else]
			[switch]
				variable=diplomacy.faction
				[case]
					value=loyalists
					[fire_event]
						name=diplomacy_loyalists
					[/fire_event]
				[/case]
				[case]
					value=outlaws
					[fire_event]
						name=diplomacy_outlaws
					[/fire_event]
				[/case]
				[case]
					value=dwarves
					[fire_event]
						name=diplomacy_dwarves
					[/fire_event]
				[/case]
				[case]
					value=drakes
					[fire_event]
						name=diplomacy_drakes
					[/fire_event]
				[/case]
				[case]
					value=elves
					[fire_event]
						name=diplomacy_elves
					[/fire_event]
				[/case]
				[case]
					value=undead
					[fire_event]
						name=diplomacy_undead
					[/fire_event]
				[/case]
				[case]
					value=orcs
					[fire_event]
						name=diplomacy_orcs
					[/fire_event]
				[/case]
			[/switch]

			{VARIABLE diplomacy.faction "none"}
			{VARIABLE diplomacy.required 0}
			{VARIABLE diplomacy.current 0}
			{VARIABLE diplomacy.fee 0}
			{VARIABLE diplomacy.turns 0}
		[/else]
		[/if]
	[/event]

	[event]
		name=diplomacy_loyalists
		first_time_only=no
		{WF_DIPLOMACY_SPAWN 3 loyalists (Spearman,Cavalryman,Mage,Horseman,Fencer,Heavy Infantryman,Sergeant,Bowman,Junior Commander,Infantry Lieutenant)}
	[/event]

	[event]
		name=diplomacy_outlaws
		first_time_only=no
		{WF_DIPLOMACY_SPAWN 2 outlaws (Poacher,Thief,Thug,Footpad)}
	[/event]

	[event]
		name=diplomacy_orcs
		first_time_only=no
		{WF_DIPLOMACY_SPAWN 1 orcs (Orcish Archer,Orcish Assassin,Orcish Grunt,Orcish Leader,Troll Whelp,Goblin Spearman,Goblin Impaler,Goblin Rouser,Wolf Rider)}
	[/event]
	[event]
		name=diplomacy_dwarves
		first_time_only=no
		{WF_DIPLOMACY_SPAWN 0 dwarves (Dwarvish Thunderer,Dwarvish Fighter,Dwarvish Guardsman,Dwarvish Ulfserker,Dwarvish Scout,Gryphon Rider)}
	[/event]
	[event]
		name=diplomacy_drakes
		first_time_only=no
		{WF_DIPLOMACY_SPAWN 0 drakes (Drake Fighter,Drake Burner,Drake Glider,Drake Clasher,Saurian Skirmisher,Saurian Augur)}
	[/event]
	[event]
		name=diplomacy_elves
		first_time_only=no
		{WF_DIPLOMACY_ELVES_POST}
		{WF_DIPLOMACY_SPAWN 2 elves (Elvish Fighter,Elvish Archer,Elvish Shaman,Elvish Scout)}
	[/event]
	[event]
		name=diplomacy_undead
		first_time_only=no
		{WF_DIPLOMACY_SPAWN 1 undead (Skeleton,Skeleton Archer,Ghost,Ghoul,Dark Adept,Soulless,Blood Bat)}
	[/event]
#enddef

#define WF_SPAWN_ALLY DIR TYPE PROFILE
		# 0=east, 1=north, 2=west, 3=south
		{FIND_NEAREST_HEX diplomacy_start $map_signs[{DIR}].x $map_signs[{DIR}].y (
			{NOT_FILTER}
			terrain=!,W*,*^Y*,*^V*,K*,C*
		) }
		[unit]
			side=1
			type={TYPE}
			{PROFILE}
			x=$diplomacy_start.x
			y=$diplomacy_start.y
			role=ally
			canrecruit=no
			placement=map
			passable=yes
			animate=yes
			to_variable=diplomacy_unit
		[/unit]
		[scroll_to]
			x,y=$diplomacy_start.x,$diplomacy_start.y
		[/scroll_to]
		[unstore_unit]
			variable=diplomacy_unit
			find_vacant=yes
			check_passability=yes
			animate=yes
			text=_"Ambassador"
			# fire_event=yes
		[/unstore_unit]
		[redraw]
			side=1
			clear_shroud=yes
		[/redraw]
		[delay]
			time=500
		[/delay]
#enddef

#define WF_CLEANUP_ALLY
		[kill]
			id=$diplomacy_unit.id
			animate=no
			fire_event=no
		[/kill]
		[redraw]
			side=1
			clear_shroud=yes
		[/redraw]
		{CLEAR_VARIABLE diplomacy_unit}
		{CLEAR_VARIABLE diplomacy_start}
#enddef

#define	WF_DIPLOMACY_ELVES_PRE
		[switch]
			variable=diplomacy.elves_mission

		# Dialog by toannghe1997
		#Pre Mission 1
			[case]
				value=1
		{ADVISOR_SAYS _"Those are quite the exotic gifts, my lord. Have you decided on a potential ally?"}
		{HERO_SAYS _"Indeed. Mage, prepare connections with the elvish ambassador."}
		{MAGE_SAYS _"As you wish, my lord."}
		{NARRATOR_SAYS _"A bright glow emits from the staff of the mage, lighting up the luxurious room that was built specifically to communicate with the representatives of different races."}
		{NARRATOR_SAYS _"You wait with baited breath, knowing that the history of your town will be determined by your actions."}
		{NARRATOR_SAYS _"Its allies, as well as its enemies, are yours to decide."}

		{WF_SPAWN_ALLY 2 (Elvish Lady) (profile=portraits/cleodil.png)}

		{ALLY_SAYS _"Greetings, human lord. The elves have heard of your hospitality, and I am here to listen to your offer of friendship."}
		{HERO_SAYS _"I thank you for answering our call, my lady. Elves and humans have long been cordial with one another, ever since the great king Haldric was granted the right to build his kingdom from the Council of the Elven Lords. Today, I wish to once again display my people’s sincerity and further strengthen the bond between our kingdoms."}
		{ALLY_SAYS _"Your words are poetic, young lord, yet you seem to have forgotten about how your people broke the treaty, time and time again..."}
		{ALLY_SAYS _"<i>*sigh*</i> And yet, it is no secret that the actions of those who live so short can’t be comprehended, just like how an oak will not understand the actions of the grasshopper swarm."}
		{CYNIC_SAYS _"<i>*whisper*</i> This entire conversation makes me feel glad that I was a soldier, not a noble."}
		{HERO_SAYS _"The actions of the few can’t represent the will of the kingdom, my lady. However, if there is a way to gain your trust and redeem ourselves, I would be glad to hear."}
		{ALLY_SAYS _"Very well, young lord. There are many enemies of the forest, yet your actions might prove that your people aren't one of them..."}
		{NARRATOR_SAYS _"You can now do missions that improve your relation with the elves. Keep in mind that you can only do a mission from a single faction at a time, though you can abort the mission whenever you want."}
		{WF_CLEANUP_ALLY}
			[/case]

		#Pre Mission 2
			[case]
				value=2
		{HERO_SAYS _"Mage, prepare connections with the elvish ambassador."}
		{MAGE_SAYS _"As you wish, my lord."}
		{NARRATOR_SAYS _"A bright glow emits from the staff of the mage, lighting up the luxurious room that was built specifically to communicate with the representatives of different races."}
		{NARRATOR_SAYS _"No matter how many times you witness this scene, a sense of unease and responsibility still weigh over your shoulder."}
		{NARRATOR_SAYS _"The prosperity of your town, as well as the allies that will come to its aid, depends on your actions. "}
		{WF_SPAWN_ALLY 2 (Elvish Lady) (profile=portraits/cleodil.png)}
		{ALLY_SAYS _"Young lord, the land that was given to your people was once looked after by my ancestors."}
		{ALLY_SAYS _"My people would never give up a single branch of our sacred glade, yet we are not so greedy as to lay claim to every tree in the forest. When we gave your first king the right to rule over the plain, we chose the plot of land where humans could thrive and prosper."}
		{ALLY_SAYS _"However, it pained us to see how your people continue to exploit wildlife without giving anything back to it..."}
		{ALLY_SAYS _"Your actions speak louder than your words, young lord. Rebuild the forest that was given to you and prove that you are worthy of our friendship."}
		{NARRATOR_SAYS _"To improve your relation with the elves, you need to build 20 trees. Each normal tree counts as 1 tree while a rare ancient tree counts as 5 trees. You can check your progress by clicking on ‘Mission’ when talking to the elvish ambassador again."}
		{WF_CLEANUP_ALLY}
			[/case]

		#Pre Mission 3
			[case]
				value=3
		{HERO_SAYS _"Mage, prepare connections with the elvish ambassador."}
		{MAGE_SAYS _"As you wish, my lord."}
		{NARRATOR_SAYS _"A bright glow emits from the staff of the mage, lighting up the luxurious room that was built specifically to communicate with the representatives of different races."}
		{WF_SPAWN_ALLY 2 (Elvish Lady) (profile=portraits/cleodil.png)}
		{ALLY_SAYS _"I ask you this, young lord. We elves rarely wander outside our forest, yet why do outsiders keep on trespassing our land? "}
		{ALLY_SAYS _"Strangely enough, most of them happen to be the people of your kingdom..."}
		{ALLY_SAYS _"I shall overlook the faults of your woodcutters, hunters and the like. Yet there are those whose sins must not be tolerated."}
		{ALLY_SAYS _"Fow now, I want you to focus on the criminals of your kingdom, the outlaws."}
		{ALLY_SAYS _"Capture a few leaders of any band of outlaws. My aide shall come to collect them once you succeed."}
		{HERO_SAYS _"May I ask of what will become of them, my lady?"}
		{ALLY_SAYS _"I have my reasons, young lord. You need not concern yourself with them…"}
		{CYNIC_SAYS _"<i>*quitely*</i> Her tone turned rather cold back there. Is there more to this matter than we thought?"}
		{NARRATOR_SAYS _"You have been tasked with capturing a few outlaw leaders, they are the strongest unit of any outlaw raiding band (the ones with a crown symbol). After dealing with 5 of them, the mission will be completed."}
		{WF_CLEANUP_ALLY}
			[/case]

		#Pre Mission 4
			[case]
				value=4
		{HERO_SAYS _"Mage, prepare connections with the elvish ambassador."}
		{MAGE_SAYS _"As you wish, my lord."}
		{NARRATOR_SAYS _"A bright glow emits from the staff of the mage, lighting up the luxurious room that was built specifically to communicate with the representatives of different races."}
		{WF_SPAWN_ALLY 2 (Elvish Lady) (profile=portraits/cleodil.png)}
		{ALLY_SAYS _"You have done well thus far, young lord. Your dedication will not go unnoticed."}
		{ALLY_SAYS _"This time, I would like you to strike at the hated enemy of the living: the undead itself!"}
		{ALLY_SAYS _"These villains have been getting bolder each year, and the wildlife suffers as a result..."}
		{ALLY_SAYS _"Sooner or later, some of these fools will undoubtedly turn their attention towards your town. Bring me proof of your victories against their dark horde and prove that you are a friend of the forest!"}
		{NARRATOR_SAYS _"You have been tasked with killing some undead. After slaying 20 units of the undead faction, the mission will be completed."}
		{WF_CLEANUP_ALLY}
			[/case]

		#Pre Mission 5
			[case]
				value=5
		{HERO_SAYS _"Mage, prepare connections with the elvish ambassador."}
		{MAGE_SAYS _"As you wish, my lord."}
		{NARRATOR_SAYS _"A bright glow emits from the staff of the mage, lighting up the luxurious room that was built specifically to communicate with the representatives of different races."}
		{WF_SPAWN_ALLY 2 (Elvish Lady) (profile=portraits/cleodil.png)}
		{ALLY_SAYS _"The elves have seen your sincerity, young lord. Now I only have one final task to entrust you with."}
		{ALLY_SAYS _"The nature of races who could only witness a few dozen moons in their lifetime changes as fast as the wind. Some for the better, some for the worse..."}
		{ALLY_SAYS _"Your actions have proven that your people are indeed worthy of the land granted by the Elven Council. So I must ask you to cut down the lives of those most hated by the forest."}
		{ALLY_SAYS _"The orcs and their ilk have long been mortal enemies of us elves. They pillage and plunder the riches of our beloved glade just to satisfy their primal urges for carnage and destruction."}
		{ALLY_SAYS _"Once a raiding party of theirs descends upon your land, I want you to send out a message that even the barbaric mind of those brutes could understand."}
		{ALLY_SAYS _"Do this, and you shall earn our eternal gratitude."}
		#{NARRATOR_SAYS _""}
		{WF_CLEANUP_ALLY}
			[/case]
		[/switch]
#enddef

#define	WF_DIPLOMACY_ELVES_POST
		[switch]
			variable=diplomacy.elves_mission

		#Post Mission 1
			[case]
				value=1
		{WF_SPAWN_ALLY 2 (Elvish Lady) (profile=portraits/cleodil.png)}
		{ALLY_SAYS _"The forest thank you, young lord."}
		{WF_CLEANUP_ALLY}
			[/case]

		#Post Mission 2
			[case]
				value=2
		{WF_SPAWN_ALLY 2 (Elvish Lady) (profile=portraits/cleodil.png)}
		{ALLY_SAYS _"I can see that you are wise beyond your years, young lord. It seems that there is yet hope for your people."}
		{ALLY_SAYS _"The forest thank you, and so do I."}
		{WF_CLEANUP_ALLY}
			[/case]

		#Post Mission 3
			[case]
				value=3
		{WF_SPAWN_ALLY 2 (Elvish Lady) (profile=portraits/cleodil.png)}
		{ALLY_SAYS _"I have heard about your accomplishments, young lord. These pests are trickier to deal with than I thought."}
		[delay]
			time=500
		[/delay]
		[unit]
			side=1
			id=temp_rider
			type=Elvish Outrider
			canrecruit=no
			x=$diplomacy_start.x
			y=$diplomacy_start.y
			placement=map
			passable=yes
			animate=yes
			random_traits=yes
		[/unit]
		[message]
			speaker=temp_rider
			message=_"We shall take over from here. You have our thanks, human lord."
		[/message]
		{HERO_SAYS _"We are happy to help. Travel safely, friend."}
		{WF_CLEANUP_ALLY}
		[kill]
			id=temp_rider
			animate=no
			fire_event=no
		[/kill]
		{FOOL_SAYS _"Are we really going to ignore what just happened..."}
			[/case]

		#Post Mission 4
			[case]
				value=4
		{WF_SPAWN_ALLY 2 (Elvish Lady) (profile=portraits/cleodil.png)}
		{NARRATOR_SAYS _"Various swords, staffs and shields engraved with sinister symbols lay scattered on the floor. Opposite you, the elvish shyde smiles gently."}
		{ALLY_SAYS _"You have done well, young lord. The forest will be able to sleep easier at night, knowing that a friend will watch over their rest."}
		{NARRATOR_SAYS _"Your deeds are renowned throughout the elvish kingdom, attracting many adventurous veterans to your town."}
		{WF_CLEANUP_ALLY}
			[/case]

		#Post Mission 5
			[case]
				value=5
		{WF_SPAWN_ALLY 2 (Elvish Lady) (profile=portraits/cleodil.png)}
		{ALLY_SAYS _"<i>*smiles warmly*</i> Ever since I first laid my eyes upon you, I had already known that you are a shining example of your people."}
		{ALLY_SAYS _"The trees may surrender to time, their branches wither as the seasons pass..."}
		{ALLY_SAYS _"Yet the deeds they witness shall never be forgotten, and so is their friend."}
		{ALLY_SAYS _"Whenever you need our help, warriors of the wood will answer your call."}
		#{NARRATOR_SAYS _""}
		{WF_CLEANUP_ALLY}
			[/case]
		[/switch]

		#{HERO_SAYS _""}
		#{ADVISOR_SAYS _""}
		#{CYNIC_SAYS _""}
		#{FOOL_SAYS _""}
		#{ALLY_SAYS _""}
		#{MAGE_SAYS _""}
		#{NARRATOR_SAYS _""}

		{WF_CLEANUP_ALLY}
#enddef

#define	WF_DIPLOMACY_SPAWN DIR FACTION UNIT_LIST
		#{RANDOM_VAR rnd_dir 0,1,2,3}	# 0=east, 1=north, 2=west, 3=south
		{RANDOM_VAR rnd_type {UNIT_LIST}}
		{FIND_NEAREST_HEX diplomacy_start $map_signs[{DIR}].x $map_signs[{DIR}].y (
			{NOT_FILTER}
			terrain=!,W*,*^Y*,*^V*,K*,C*
		) }
		[unit]
			side=1
			type=$rnd_type
			x=$diplomacy_start.x
			y=$diplomacy_start.y
			canrecruit=no
			placement=map
			passable=yes
			animate=yes
			to_variable=diplomacy_unit
		[/unit]
		[scroll_to]
			x,y=$diplomacy_start.x,$diplomacy_start.y
		[/scroll_to]
		[unstore_unit]
			variable=diplomacy_unit
			find_vacant=yes
			check_passability=yes
			animate=yes
			text=_"Ally"
			# fire_event=yes
		[/unstore_unit]
		{CLEAR_VARIABLE rnd_type}
		[redraw]
			side=1
			clear_shroud=yes
		[/redraw]
		{VARIABLE repeat_count $enemy.num_outlaws}
		{VARIABLE_OP repeat_count add $diplomacy.{FACTION}_mission}
		{REPEAT $repeat_count (
		{RANDOM_VAR rnd_type {UNIT_LIST}}
		[unit]
			side=1
			type=$rnd_type
			canrecruit=no
			x=$diplomacy_start.x
			y=$diplomacy_start.y
			placement=map
			passable=yes
			animate=yes
			random_traits=yes
		[/unit]
		)}
		[redraw]
			side=1
			clear_shroud=yes
		[/redraw]
		[message]
			speaker=$diplomacy_unit.id
			message=_"As per our agreement, we are to serve at your pleasure, milord"
		[/message]
		{VARIABLE diplomacy.ally {FACTION}}
		{VARIABLE_OP diplomacy.{FACTION}_mission add 1}
		{CLEAR_VARIABLE repeat_count}
		{CLEAR_VARIABLE diplomacy_unit}
		{CLEAR_VARIABLE diplomacy_start}
		{CLEAR_VARIABLE rnd_type}
#enddef

#define ACTION_MESSAGE
		[message]
			speaker=narrator
			image="wesnoth-icon.png"
			message="$diplomacy.action|
Your current standing is $diplomacy.current|.
The required standing is $diplomacy.required|.
The fee for their services is $diplomacy.fee|."
		[/message]
#enddef

#define ACTION_LOYALISTS
		{VARIABLE diplomacy.faction "loyalists"}
		[switch]
			variable=diplomacy.loyalists_mission
			# mission 1 is the else
			[case]
				value=2
				{VARIABLE diplomacy.action "Loyalists require that you hunt down more bandits to improve your standings with them."}
				{VARIABLE diplomacy.fee 200}
				{VARIABLE diplomacy.required 20}
			[/case]
			[else]
				{VARIABLE diplomacy.loyalists_mission 1}
				{VARIABLE diplomacy.action "Loyalists require that you hunt down bandits to improve your standings with them."}
				{VARIABLE diplomacy.fee 100}
				{VARIABLE diplomacy.required 10}
			[/else]
		[/switch]
		{VARIABLE diplomacy.current $diplomacy.loyalists}
		{VARIABLE_OP diplomacy.current multiply -1}
		{VARIABLE diplomacy.turns 0}
#enddef

#define ACTION_OUTLAWS
		{VARIABLE diplomacy.faction "outlaws"}
		[switch]
			variable=diplomacy.outlaws_mission
			# mission 1 is the else
			[case]
				value=2
				{VARIABLE diplomacy.action "Outlaws require that you exorcise more undead to improve your standings with them."}
				{VARIABLE diplomacy.fee 200}
				{VARIABLE diplomacy.required 20}
			[/case]
			[else]
				{VARIABLE diplomacy.outlaws_mission 1}
				{VARIABLE diplomacy.action "Outlaws require that you exorcise the undead to improve your standings with them."}
				{VARIABLE diplomacy.fee 100}
				{VARIABLE diplomacy.required 10}
			[/else]
		[/switch]
		{VARIABLE diplomacy.current $diplomacy.outlaws}
		{VARIABLE_OP diplomacy.current multiply -1}
		{VARIABLE diplomacy.turns 0}
#enddef

#define ACTION_ELVES
		{VARIABLE diplomacy.faction "elves"}
		[switch]
			variable=diplomacy.elves_mission
			# mission 1 is the else
			[case]
				#Elves Mission 2
				value=2
				{VARIABLE diplomacy.action "Elves require that you plant more trees to improve your standings with them."}
				{VARIABLE diplomacy.fee 200}
				{VARIABLE diplomacy.required 20}
			[/case]
			[case]
				#Elves Mission 3
				value=3
				{VARIABLE diplomacy.action "Elves require that you capture bandits to improve your standings with them."}
				{VARIABLE diplomacy.fee 100}
				{VARIABLE diplomacy.required 5}
			[/case]
			[case]
				#Elves Mission 4
				value=4
				{VARIABLE diplomacy.action "Elves require that you terminate the undead to improve your standings with them."}
				{VARIABLE diplomacy.fee 200}
				{VARIABLE diplomacy.required 20}
			[/case]
			[case]
				#Elves Mission 5
				value=5
				{VARIABLE diplomacy.action "Elves require that you fight the orcs and trolls to improve your standings with them."}
				{VARIABLE diplomacy.fee 200}
				{VARIABLE diplomacy.required 20}
			[/case]
			[else]
				{VARIABLE diplomacy.elves_mission 1}
				{VARIABLE diplomacy.action "Elves require that you plant trees to improve your standings with them."}
				{VARIABLE diplomacy.fee 100}
				{VARIABLE diplomacy.required 10}
			[/else]
		[/switch]
		{VARIABLE diplomacy.current $diplomacy.elves}
		{VARIABLE_OP diplomacy.current multiply -1}
		{VARIABLE diplomacy.turns 0}
		{WF_DIPLOMACY_ELVES_PRE}
#enddef

#define ACTION_DWARVES
		{VARIABLE diplomacy.faction "dwarves"}
		[switch]
			variable=diplomacy.dwarves_mission
			# mission 1 is the else
			[case]
				value=2
				{VARIABLE diplomacy.action "Dwarves require that you create more hills or raise mountain to improve your standings with them."}
				{VARIABLE diplomacy.fee 200}
				{VARIABLE diplomacy.required 20}
			[/case]
			[else]
				{VARIABLE diplomacy.dwarves_mission 1}
				{VARIABLE diplomacy.action "Dwarves require that you create hills or raise mountain to improve your standings with them."}
				{VARIABLE diplomacy.fee 100}
				{VARIABLE diplomacy.required 10}
			[/else]
		[/switch]
		{VARIABLE diplomacy.current $diplomacy.dwarves}
		{VARIABLE_OP diplomacy.current multiply -1}
		{VARIABLE diplomacy.turns 0}
#enddef

#define ACTION_DRAKES
		{VARIABLE diplomacy.faction "drakes"}
		[switch]
			variable=diplomacy.drakes_mission
			# mission 1 is the else
			[case]
				value=2
				{VARIABLE diplomacy.action "Drakes require that you take down more Woses to improve your standings with them."}
				{VARIABLE diplomacy.fee 200}
				{VARIABLE diplomacy.required 20}
			[/case]
			[else]
				{VARIABLE diplomacy.drakes_mission 1}
				{VARIABLE diplomacy.action "Drakes require that you take down Woses to improve your standings with them."}
				{VARIABLE diplomacy.fee 100}
				{VARIABLE diplomacy.required 10}
			[/else]
		[/switch]
		{VARIABLE diplomacy.current $diplomacy.drakes}
		{VARIABLE_OP diplomacy.current multiply -1}
		{VARIABLE diplomacy.turns 0}
#enddef

#define ACTION_UNDEAD
		{VARIABLE diplomacy.faction "undead"}
		[switch]
			variable=diplomacy.undead_mission
			# mission 1 is the else
			[case]
				value=2
				{VARIABLE diplomacy.action "Undead require that you plague more beings to improve your standings with them."}
				{VARIABLE diplomacy.fee 200}
				{VARIABLE diplomacy.required 20}
			[/case]
			[else]
				{VARIABLE diplomacy.undead_mission 1}
				{VARIABLE diplomacy.action "Undead require that you plague beings to improve your standings with them."}
				{VARIABLE diplomacy.fee 100}
				{VARIABLE diplomacy.required 10}
			[/else]
		[/switch]
		{VARIABLE diplomacy.current $diplomacy.undead}
		{VARIABLE_OP diplomacy.current multiply -1}
		{VARIABLE diplomacy.turns 0}
#enddef

#define ACTION_ORCS
		{VARIABLE diplomacy.faction "orcs"}
		[switch]
			variable=diplomacy.orcs_mission
			# mission 1 is the else
			[case]
				value=2
				{VARIABLE diplomacy.action "Orcs require that you hunt down more elves to improve your standings with them."}
				{VARIABLE diplomacy.fee 200}
				{VARIABLE diplomacy.required 20}
			[/case]
			[else]
				{VARIABLE diplomacy.orcs_mission 1}
				{VARIABLE diplomacy.action "Orcs require that you hunt down elves to improve your standings with them."}
				{VARIABLE diplomacy.fee 100}
				{VARIABLE diplomacy.required 10}
			[/else]
		[/switch]
		{VARIABLE diplomacy.current $diplomacy.orcs}
		{VARIABLE_OP diplomacy.current multiply -1}
		{VARIABLE diplomacy.turns 0}
#enddef
