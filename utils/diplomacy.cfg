#textdomain wesnoth-Wild_Frontiers

#define WF_DIPLOMACY
	[event]
		name=prestart
		[set_menu_item]
		id=start_diplomacy
		description=_"Hire mercenaries"
		[show_if]
			[have_unit]
				id=Hero
				x,y=$x1,$y1
			[/have_unit]
			[have_location]
				x,y=$x1,$y1
				terrain=*^Yu*
			[/have_location]
		[/show_if]
		[command]
			[fire_event]
				name=diplomacy_refresh
			[/fire_event]
			[message]
				speaker=unit
				message=_"Initiate talks with ..."
				[option]
					label=_"The drakes"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_DRAKES}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"The dwarves"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_DWARVES}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"The elves"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_ELVES}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"The loyalists"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_LOYALISTS}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"The orcs"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_ORCS}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"The outlaws"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_OUTLAWS}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"The undead"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
						{ACTION_UNDEAD}
						{ACTION_MESSAGE}
					[/command]
				[/option]
				[option]
					label=_"Nevermind"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction equals "none"}
					[/show_if]
					[command]
					[/command]
				[/option]
				[option]
					label=_"Negotiation status with the $diplomacy.faction"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction not_equals "none"}
						{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
					[/show_if]
					[command]
						[message]
							speaker=narrator
							image="wesnoth-icon.png"
							message="$diplomacy.action|
Your current standing is $diplomacy.current|.
The required standing is $diplomacy.required|.
The fee for their services is $diplomacy.fee|."
						[/message]
					[/command]
				[/option]
				[option]
					label=_"Negotiation status with the $diplomacy.faction"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction not_equals "none"}
						{VARIABLE_CONDITIONAL diplomacy.fee numerical_equals 0}
					[/show_if]
					[command]
						[message]
							speaker=narrator
							image="wesnoth-icon.png"
							message="You are on good standings with the $diplomacy.faction|.
The mercenaries will arrive in $diplomacy.turns| turns."
						[/message]
					[/command]
				[/option]
				[option]
					label=_"Cancel negotiations with the $diplomacy.faction"
					[show_if]
						{VARIABLE_CONDITIONAL diplomacy.faction not_equals "none"}
						{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
					[/show_if]
					[command]
						{VARIABLE diplomacy.faction "none"}
						{VARIABLE diplomacy.required 0}
						{VARIABLE diplomacy.current 0}
						{VARIABLE diplomacy.fee 0}
						{VARIABLE diplomacy.turns 0}
					[/command]
				[/option]
			[/message]
		[/command]
	[/set_menu_item]
	[/event]

	[event]
		name=action_hills
		first_time_only=no
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "dwarves"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
			[and]
			{VARIABLE_CONDITIONAL diplomacy.dwarves_mission numerical_equals 1}
			[or]
				{VARIABLE_CONDITIONAL diplomacy.dwarves_mission numerical_equals 2}
			[/or]
			[/and]
		[/filter_condition]

		{VARIABLE_OP diplomacy.dwarves add $weapon.hills}

		[if]
			{VARIABLE_CONDITIONAL weapon.action equals "burn"}
		[then]
			[scroll_to_unit]
				id=$unit.id
			[/scroll_to_unit]
			{UNIT_SAYS _"My lord, for some reason, I feel like the dwarves won't be happy with this..."}
		[/then]
		[/if]
	[/event]

	[event]
		name=action_trees
		first_time_only=no
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "elves"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
			[and]
			{VARIABLE_CONDITIONAL diplomacy.elves_mission numerical_equals 1}
			[or]
				{VARIABLE_CONDITIONAL diplomacy.elves_mission numerical_equals 2}
			[/or]
			[/and]
		[/filter_condition]

		{VARIABLE_OP diplomacy.elves add $weapon.trees}

		[if]
			{VARIABLE_CONDITIONAL weapon.action equals "burn"}
		[then]
			[scroll_to_unit]
				id=$unit.id
			[/scroll_to_unit]
			{UNIT_SAYS _"My lord, for some reason, I feel like someone is watching me..."}
		[/then]
		[/if]
	[/event]

	[event]
		name=action_trees
		first_time_only=no
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "orcs"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
			{VARIABLE_CONDITIONAL diplomacy.orcs_mission numerical_equals 1}
		[/filter_condition]

		{VARIABLE_OP diplomacy.orcs sub $weapon.trees}

		[if]
			{VARIABLE_CONDITIONAL weapon.action equals "build"}
		[then]
			[scroll_to_unit]
				id=$unit.id
			[/scroll_to_unit]
			{UNIT_SAYS _"My lord, for some reason, I feel like the orcs are getting angry..."}
		[/then]
		[/if]
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			side=3,4
			#type_adv_tree=Poacher,Thief,Thug,Footpad
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "loyalists"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
			[and]
			{VARIABLE_CONDITIONAL diplomacy.loyalists_mission numerical_equals 1}
			[or]
				{VARIABLE_CONDITIONAL diplomacy.loyalists_mission numerical_equals 2}
			[/or]
			[/and]
		[/filter_condition]

		[if]
			{VARIABLE_CONDITIONAL unit.level numerical_equals 0}
		[then]
			{VARIABLE_OP diplomacy.loyalists sub 1}
		[/then]
		[/if]
		{VARIABLE_OP diplomacy.loyalists sub $unit.level}
	[/event]

	[event]
		name=last breath
		first_time_only=no
		[filter]
			side=3,4
			role=outlaw_leader
			type_adv_tree=Poacher,Thief,Thug,Footpad
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "elves"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
			{VARIABLE_CONDITIONAL diplomacy.elves_mission numerical_equals 3}
		[/filter_condition]

		{VARIABLE_OP diplomacy.elves sub 1}
		[switch]
			variable=diplomacy.elves
			[case]
				# First outlaw leader
				value=-1
				{SECOND_UNIT_SAYS _"End of the line, criminal scum. You're coming with us."}
				{UNIT_SAYS _"<i>*spitting on the ground*</i> What do you want? Putting me in jail until I die of boredom?"}
				{UNIT_SAYS _"<i>*laugh*</i> Good luck with that, dogs of the crown!!!"}
				{SECOND_UNIT_SAYS _"None of such. The elves will deal with you later."}
				{UNIT_SAYS _"Elves? Why would you... No... NO!!! Kill me now, dogs!!!"}
				{SECOND_UNIT_SAYS _"<i>*knock the outlaw unconscious*</i> Take him away, lads."}
			[/case]
			[case]
				# Second outlaw leader
				value=-2
				{UNIT_SAYS _"<i>*panting heavily*</i> So the house dogs are now working with the forest hounds..."}
				{UNIT_SAYS _"<i>*grimace*</i> One day, we will make sure you regret this decision..."}
				{SECOND_UNIT_SAYS _"Strange. The band of outlaws this fellow controls has no connection with the previous one, yet he has already heard about our deal with the elves."}
				{FOOL_SAYS _"Perhaps a survivor that clashed with us managed to escape and spread the news?"}
				{ADVISOR_SAYS _"They shouldn't be able to confirm it that quickly..."}
			[/case]
			[case]
				# Third outlaw leader
				value=-3
				{NARRATOR_SAYS _"Before you could capture the outlaw leader, two thugs rushed out, brandishing hidden knives. With a grim and determined expression, they decided to stay behind and prevent you from reaching their leader, allowing him to escape."}
				{SECOND_UNIT_SAYS _"Curses!!!"}
			[/case]
			[case]
				# Fourth outlaw leader
				value=-4
				{SECOND_UNIT_SAYS _"Quickly! Capture him before-"}
				{NARRATOR_SAYS _"There was a look of horror on the outlaw leader's face. The moment he saw your guards, orders were thrown out for them to buy him time to escape. Amidst the clashing of steel and knives, no one knew when the bandit boss had slipped away."}
				{SECOND_UNIT_SAYS _"Damn it!!!"}
			[/case]
			[case]
				# Fifth outlaw leader
				value=-5
				{SECOND_UNIT_SAYS _"Soldiers move quickly, and pin him to the ground."}
				{SECOND_UNIT_SAYS _"Finally... You are coming with us, scum!"}

				#FIXME: Too much text here 7
				#{NARRATOR_SAYS _"Suddenly, black smoke rises from beneath, forming sinister lumps of floating masses."}
				#{NARRATOR_SAYS _"Everyone was distracted. No one notices when a man covered with a black cloak appears, plunging his glowing knife into the outlaw leader's heart."}
				#{NARRATOR_SAYS _"Outraged, the guards surround the assassin, determined not to let him escape. However, the man in black easily slips past them with lighting dexterity, leaving behind the black smoke to deter any pursuers."}
				#{NARRATOR_SAYS _"These balls of darkness nimbly avoid any sword or arrow that comes their way, moving around the guards as if they weren't there. Every time the black smoke is obliterated by a mage, another one would rise out of the fleeing assassin."}
				#{NARRATOR_SAYS _"Out of desperation, the remaining guards try to cut off the possible escape routes. The assassin then lunges towards the direction of the forest, dodging any attack the entire time."}
				#{NARRATOR_SAYS _"You grin, knowing that his speed will soon drop, allowing your horsemen to catch up and surround him. Even if he manages to evade your pursuit, the arrows from elven sentries will certainly pierce him without fail."}
				#{NARRATOR_SAYS _"However, the moment the assassin reaches the wood, his entire body seemingly vanishes into thin air, leaving you and the soldiers in shock..."}
			[/case]
		[/switch]
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			race=undead
			[or]
				type_adv_tree=Dark Adept
			[/or]
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "elves"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
			{VARIABLE_CONDITIONAL diplomacy.elves_mission numerical_equals 4}
		[/filter_condition]

		[if]
			{VARIABLE_CONDITIONAL unit.level numerical_equals 0}
		[then]
			{VARIABLE_OP diplomacy.elves sub 1}
		[/then]
		[/if]
		{VARIABLE_OP diplomacy.elves sub $unit.level}
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			race=orc,troll,goblin
			[or]
				type_adv_tree=Wolf Rider
			[/or]
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "elves"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
			{VARIABLE_CONDITIONAL diplomacy.elves_mission numerical_equals 5}
		[/filter_condition]

		[if]
			{VARIABLE_CONDITIONAL unit.level numerical_equals 0}
		[then]
			{VARIABLE_OP diplomacy.elves sub 1}
		[/then]
		[/if]
		{VARIABLE_OP diplomacy.elves sub $unit.level}
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			race=undead
			[or]
				type_adv_tree=Dark Adept
			[/or]
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "outlaws"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
			[and]
			{VARIABLE_CONDITIONAL diplomacy.outlaws_mission numerical_equals 1}
			[or]
				{VARIABLE_CONDITIONAL diplomacy.outlaws_mission numerical_equals 2}
			[/or]
			[/and]
		[/filter_condition]

		[if]
			{VARIABLE_CONDITIONAL unit.level numerical_equals 0}
		[then]
			{VARIABLE_OP diplomacy.outlaws sub 1}
		[/then]
		[/if]
		{VARIABLE_OP diplomacy.outlaws sub $unit.level}
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			race=wose
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "drakes"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
			[and]
			{VARIABLE_CONDITIONAL diplomacy.drakes_mission numerical_equals 1}
			[or]
				{VARIABLE_CONDITIONAL diplomacy.drakes_mission numerical_equals 2}
			[/or]
			[/and]
		[/filter_condition]

		[if]
			{VARIABLE_CONDITIONAL unit.level numerical_equals 0}
		[then]
			{VARIABLE_OP diplomacy.drakes sub 1}
		[/then]
		[/if]
		{VARIABLE_OP diplomacy.drakes sub $unit.level}
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_second_attack]
			special=plague
		[/filter_second_attack]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "undead"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
			[and]
			{VARIABLE_CONDITIONAL diplomacy.undead_mission numerical_equals 1}
			[or]
				{VARIABLE_CONDITIONAL diplomacy.undead_mission numerical_equals 2}
			[/or]
			[or]
				{VARIABLE_CONDITIONAL diplomacy.undead_mission numerical_equals 3}
			[/or]
			[or]
				{VARIABLE_CONDITIONAL diplomacy.undead_mission numerical_equals 4}
			[/or]
			[or]
				{VARIABLE_CONDITIONAL diplomacy.undead_mission numerical_equals 5}
			[/or]
			[/and]
		[/filter_condition]

		[if]
			{VARIABLE_CONDITIONAL unit.level numerical_equals 0}
		[then]
			{VARIABLE_OP diplomacy.undead sub 1}
		[/then]
		[/if]
		{VARIABLE_OP diplomacy.undead sub $unit.level}
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			race=elf
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction equals "orcs"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
		[/filter_condition]

		[if]
			{VARIABLE_CONDITIONAL unit.level numerical_equals 0}
		[then]
			{VARIABLE_OP diplomacy.orcs sub 1}
		[/then]
		[/if]
		{VARIABLE_OP diplomacy.orcs sub $unit.level}
	[/event]

	[event]
		name=side 1 turn refresh
		first_time_only=no

		[fire_event]
			name=diplomacy_refresh
		[/fire_event]
	[/event]

	[event]
		name=diplomacy_refresh
		first_time_only=no
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction not_equals "none"}
			{VARIABLE_CONDITIONAL diplomacy.fee greater_than 0}
		[/filter_condition]

		[switch]
			variable=diplomacy.faction
			[case]
				value="loyalists"
				{VARIABLE diplomacy.current $diplomacy.loyalists}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
			[case]
				value="outlaws"
				{VARIABLE diplomacy.current $diplomacy.outlaws}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
			[case]
				value="dwarves"
				{VARIABLE diplomacy.current $diplomacy.dwarves}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
			[case]
				value="drakes"
				{VARIABLE diplomacy.current $diplomacy.drakes}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
			[case]
				value="undead"
				{VARIABLE diplomacy.current $diplomacy.undead}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
			[case]
				value="elves"
				{VARIABLE diplomacy.current $diplomacy.elves}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
			[case]
				value="orcs"
				{VARIABLE diplomacy.current $diplomacy.orcs}
				{VARIABLE_OP diplomacy.current multiply -1}
			[/case]
		[/switch]

		[if]
			{VARIABLE_CONDITIONAL diplomacy.current greater_than_equal_to $diplomacy.required}
		[then]
			[store_gold]
				side=1
				variable=wf_vars.side1_gold
			[/store_gold]
			[if]
				{VARIABLE_CONDITIONAL wf_vars.side1_gold greater_than_equal_to $diplomacy.fee}
			[then]
			[message]
				role=advisor
				message=_"We have fulfilled our end of the bargain for the $diplomacy.faction|. May I suggest, we pay $diplomacy.fee and seal the deal, milord?"
				[option]
					label=_"Yes"
					[command]
						{PAY_GOLD $diplomacy.fee}
						{VARIABLE diplomacy.fee 0}
						{VARIABLE diplomacy.required 0}
						{VARIABLE diplomacy.current 0}
						[switch]
							variable=diplomacy.faction
							[case]
								value="loyalists"
								{VARIABLE diplomacy.loyalists 0}
							[/case]
							[case]
								value="outlaws"
								{VARIABLE diplomacy.outlaws 0}
							[/case]
							[case]
								value="dwarves"
								{VARIABLE diplomacy.dwarves 0}
							[/case]
							[case]
								value="drakes"
								{VARIABLE diplomacy.drakes 0}
							[/case]
							[case]
								value="undead"
								{VARIABLE diplomacy.undead 0}
							[/case]
							[case]
								value="elves"
								{VARIABLE diplomacy.elves 0}
							[/case]
							[case]
								value="orcs"
								{VARIABLE diplomacy.orcs 0}
							[/case]
						[/switch]
						{RANDOM_VAR diplomacy.turns 1..3}
					[/command]
				[/option]
				[option]
					label=_"No"
					[command] [/command]
				[/option]
			[/message]
			[/then]
			[/if]
		[/then]
		[/if]
	[/event]

	[event]
		name=side 1 turn end
		first_time_only=no
		[filter_condition]
			{VARIABLE_CONDITIONAL diplomacy.faction not_equals "none"}
			{VARIABLE_CONDITIONAL diplomacy.fee numerical_equals 0}
		[/filter_condition]

		[if]
			{VARIABLE_CONDITIONAL diplomacy.turns greater_than 1}
		[then]
			{VARIABLE_OP diplomacy.turns sub 1}
		[/then]
		[else]
			[switch]
				variable=diplomacy.faction
				[case]
					value=loyalists
					[fire_event]
						name=diplomacy_loyalists
					[/fire_event]
				[/case]
				[case]
					value=outlaws
					[fire_event]
						name=diplomacy_outlaws
					[/fire_event]
				[/case]
				[case]
					value=dwarves
					[fire_event]
						name=diplomacy_dwarves
					[/fire_event]
				[/case]
				[case]
					value=drakes
					[fire_event]
						name=diplomacy_drakes
					[/fire_event]
				[/case]
				[case]
					value=elves
					[fire_event]
						name=diplomacy_elves
					[/fire_event]
				[/case]
				[case]
					value=undead
					[fire_event]
						name=diplomacy_undead
					[/fire_event]
				[/case]
				[case]
					value=orcs
					[fire_event]
						name=diplomacy_orcs
					[/fire_event]
				[/case]
			[/switch]

			{VARIABLE diplomacy.faction "none"}
			{VARIABLE diplomacy.required 0}
			{VARIABLE diplomacy.current 0}
			{VARIABLE diplomacy.fee 0}
			{VARIABLE diplomacy.turns 0}
		[/else]
		[/if]
	[/event]

	[event]
		name=diplomacy_loyalists
		first_time_only=no
		{WF_DIPLOMACY_LOYALISTS_POST}
		{WF_DIPLOMACY_SPAWN 3 loyalists (Spearman,Cavalryman,Mage,Horseman,Fencer,Heavy Infantryman,Sergeant,Bowman,Junior Commander,Infantry Lieutenant)}
	[/event]

	[event]
		name=diplomacy_outlaws
		first_time_only=no
		{WF_DIPLOMACY_OUTLAWS_POST}
		{WF_DIPLOMACY_SPAWN 2 outlaws (Poacher,Thief,Thug,Footpad)}
	[/event]

	[event]
		name=diplomacy_orcs
		first_time_only=no
		{WF_DIPLOMACY_ORCS_POST}
		{WF_DIPLOMACY_SPAWN 1 orcs (Orcish Archer,Orcish Assassin,Orcish Grunt,Orcish Leader,Troll Whelp,Goblin Spearman,Goblin Impaler,Goblin Rouser,Wolf Rider)}
	[/event]
	[event]
		name=diplomacy_dwarves
		first_time_only=no
		{WF_DIPLOMACY_DWARVES_POST}
		{WF_DIPLOMACY_SPAWN 0 dwarves (Dwarvish Thunderer,Dwarvish Fighter,Dwarvish Guardsman,Dwarvish Ulfserker,Dwarvish Scout,Gryphon Rider)}
	[/event]
	[event]
		name=diplomacy_drakes
		first_time_only=no
		{WF_DIPLOMACY_DRAKES_POST}
		{WF_DIPLOMACY_SPAWN 0 drakes (Drake Fighter,Drake Burner,Drake Glider,Drake Clasher,Saurian Skirmisher,Saurian Augur)}
	[/event]
	[event]
		name=diplomacy_elves
		first_time_only=no
		{WF_DIPLOMACY_ELVES_POST}
		{WF_DIPLOMACY_SPAWN 2 elves (Elvish Fighter,Elvish Archer,Elvish Shaman,Elvish Scout)}
	[/event]
	[event]
		name=diplomacy_undead
		first_time_only=no
		{WF_DIPLOMACY_UNDEAD_POST}
		{WF_DIPLOMACY_SPAWN 1 undead (Skeleton,Skeleton Archer,Ghost,Ghoul,Dark Adept,Soulless,Blood Bat)}
	[/event]
#enddef

#define WF_SPAWN_ALLY DIR TYPE PROFILE
		# 0=east, 1=north, 2=west, 3=south
		{FIND_NEAREST_HEX diplomacy_start $map_signs[{DIR}].x $map_signs[{DIR}].y (
			{NOT_FILTER}
			terrain=!,W*,*^Y*,*^V*,K*,C*
		) }
		[unit]
			side=1
			type={TYPE}
			{PROFILE}
			x=$diplomacy_start.x
			y=$diplomacy_start.y
			role=ally
			canrecruit=no
			placement=map
			passable=yes
			animate=yes
			to_variable=diplomacy_unit
		[/unit]
		[scroll_to]
			x,y=$diplomacy_start.x,$diplomacy_start.y
		[/scroll_to]
		[unstore_unit]
			variable=diplomacy_unit
			find_vacant=yes
			check_passability=yes
			animate=yes
			text=_"Ambassador"
			# fire_event=yes
		[/unstore_unit]
		[redraw]
			side=1
			clear_shroud=yes
		[/redraw]
		[delay]
			time=500
		[/delay]
#enddef

#define WF_CLEANUP_ALLY
		[kill]
			id=$diplomacy_unit.id
			animate=no
			fire_event=no
		[/kill]
		[redraw]
			side=1
			clear_shroud=yes
		[/redraw]
		{CLEAR_VARIABLE diplomacy_unit}
		{CLEAR_VARIABLE diplomacy_start}
#enddef

#define	WF_DIPLOMACY_SPAWN DIR FACTION UNIT_LIST
		#{RANDOM_VAR rnd_dir 0,1,2,3}	# 0=east, 1=north, 2=west, 3=south
		{FIND_NEAREST_HEX diplomacy_start $map_signs[{DIR}].x $map_signs[{DIR}].y (
			{NOT_FILTER}
			terrain=!,W*,*^Y*,*^V*,K*,C*
		) }

		{WF_RAND_CHOICE {UNIT_LIST}}
		[unit]
			side=1
			type=$random_choice
			x=$diplomacy_start.x
			y=$diplomacy_start.y
			canrecruit=no
			placement=map
			passable=yes
			animate=yes
			to_variable=diplomacy_unit
		[/unit]
		{CLEAR_VARIABLE random_choice}
		[scroll_to]
			x,y=$diplomacy_start.x,$diplomacy_start.y
		[/scroll_to]
		[unstore_unit]
			variable=diplomacy_unit
			find_vacant=yes
			check_passability=yes
			animate=yes
			text=_"Ally"
			# fire_event=yes
		[/unstore_unit]
		[redraw]
			side=1
			clear_shroud=yes
		[/redraw]
		{VARIABLE repeat_count $enemy.num_outlaws}
		{VARIABLE_OP repeat_count add $diplomacy.{FACTION}_mission}
		{REPEAT $repeat_count (
		{WF_RAND_CHOICE {UNIT_LIST}}
		[unit]
			side=1
			type=$random_choice
			canrecruit=no
			x=$diplomacy_start.x
			y=$diplomacy_start.y
			placement=map
			passable=yes
			animate=yes
			random_traits=yes
		[/unit]
		{CLEAR_VARIABLE random_choice}
		)}
		{CLEAR_VARIABLE random_choice_arr}

		[redraw]
			side=1
			clear_shroud=yes
		[/redraw]
		[message]
			speaker=$diplomacy_unit.id
			message=_"As per our agreement, we are to serve at your pleasure, milord"
		[/message]
		{VARIABLE diplomacy.ally {FACTION}}
		{VARIABLE_OP diplomacy.{FACTION}_mission add 1}
		{CLEAR_VARIABLE repeat_count}
		{CLEAR_VARIABLE diplomacy_unit}
		{CLEAR_VARIABLE diplomacy_start}
#enddef

#define ACTION_MESSAGE
		[message]
			speaker=narrator
			image="wesnoth-icon.png"
			message="$diplomacy.action|
Your current standing is $diplomacy.current|.
The required standing is $diplomacy.required|.
The fee for their services is $diplomacy.fee|."
		[/message]
#enddef
